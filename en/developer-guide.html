<!DOCTYPE HTML>
<html lang="en">
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta property="og:image" content="https://bitcoin.org/img/opengraph.png" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Developer Guide - Bitcoin</title>
<link rel="stylesheet" type="text/css" href="/a029ec6be4a42b1ffb2e134cb4040f2f.css" />
<!--[if lt IE 8]><link rel="stylesheet" type="text/css" href="/efc702a0aa79a2cda69eebe4befd4c11.css" /><script type="text/javascript" src="/js/ie.js"></script><![endif]-->


<script type="text/javascript" src="/js/main.js?1400954556"></script>
<link rel="shortcut icon" href="/favicon.png">
<link rel="apple-touch-icon-precomposed" href="/img/logo_ios.png"/>
</head>
<body>
<div id="detectmobile" class="detectmobile"></div>


  <div class="head"><div>
    <ul class="lang">
      <li><a href="#" onclick="return false;">English</a>
      <ul>
        <li><ul>
        
        
        
          <li><a href="/id/">Bahasa Indonesia‬</a></li>
        
        
          <li><a href="/da/">Dansk</a></li>
        
        
          <li><a href="/de/">Deutsch</a></li>
        
        
          <li><a href="/en/" class="active">English</a></li>
        
        
          <li><a href="/es/">Español</a></li>
        
        
          <li><a href="/fr/">Français</a></li>
        
        
          <li><a href="/it/">Italiano</a></li>
        
        
          <li><a href="/hu/">magyar</a></li>
        
        
          <li><a href="/nl/">Nederlands</a></li>
        
        
          <li><a href="/pl/">polski</a></li>
        
        
          <li><a href="/pt_BR/">Português Brasil</a></li>
        
        
          <li><a href="/ro/">română</a></li>
        
        
          <li><a href="/sl/">slovenščina</a></li>
        
        </ul></li><li><ul>
          <li><a href="/sv/">Svenska</a></li>
        
        
          <li><a href="/tr/">Türkçe</a></li>
        
        
          <li><a href="/bg/">български</a></li>
        
        
          <li><a href="/ru/">Русский</a></li>
        
        
          <li><a href="/ar/">العربية</a></li>
        
        
          <li><a href="/fa/">فارسی</a></li>
        
        
          <li><a href="/hi/">हिन्दी</a></li>
        
        
          <li><a href="/ko/">한국의</a></li>
        
        
          <li><a href="/ja/">日本語</a></li>
        
        
          <li><a href="/zh_CN/">‪简体中文‬</a></li>
        
        
          <li><a href="/zh_TW/">‪繁體中文‬</a></li>
        
        </ul></li>
      </ul>
      </li>
    </ul>
    <a class="logo" href="/en/"><img src="/img/logotop.svg" alt="Bitcoin"></a>
    <a id="menumobile" class="menumobile" onclick="mobileMenuShow(event);" href="#"></a>
    <div id="langselect" class="langselect"><select onchange="window.location=this.value;">
    
          <option value="/id/">Bahasa Indonesia‬</option>
    
          <option value="/da/">Dansk</option>
    
          <option value="/de/">Deutsch</option>
    
          <option value="/en/" selected="selected">English</option>
    
          <option value="/es/">Español</option>
    
          <option value="/fr/">Français</option>
    
          <option value="/it/">Italiano</option>
    
          <option value="/hu/">magyar</option>
    
          <option value="/nl/">Nederlands</option>
    
          <option value="/pl/">polski</option>
    
          <option value="/pt_BR/">Português Brasil</option>
    
          <option value="/ro/">română</option>
    
          <option value="/sl/">slovenščina</option>
    
          <option value="/sv/">Svenska</option>
    
          <option value="/tr/">Türkçe</option>
    
          <option value="/bg/">български</option>
    
          <option value="/ru/">Русский</option>
    
          <option value="/ar/">العربية</option>
    
          <option value="/fa/">فارسی</option>
    
          <option value="/hi/">हिन्दी</option>
    
          <option value="/ko/">한국의</option>
    
          <option value="/ja/">日本語</option>
    
          <option value="/zh_CN/">‪简体中文‬</option>
    
          <option value="/zh_TW/">‪繁體中文‬</option>
    
    </select></div>
    <ul id="menusimple" class="menusimple" onclick="mobileMenuHover(event);">
      <li><a href="#" onclick="return false;">Introduction</a>
        <ul>
          <li><a href="/en/bitcoin-for-individuals">Individuals</a></li>
          <li><a href="/en/bitcoin-for-businesses">Businesses</a></li>
          <li><a href="/en/bitcoin-for-developers">Developers</a></li>
          
          <li><a href="/en/getting-started">Getting started</a></li>
          
          <li><a href="/en/how-it-works">How it works</a></li>
          <li><a href="/en/you-need-to-know">You need to know</a></li>
        </ul>
      </li>
      <li><a href="#" onclick="return false;">Resources</a>
        <ul>
          <li><a href="/en/resources">Resources</a></li>
          <li><a href="/en/community">Community</a></li>
          <li><a href="/en/developer-documentation">Documentation</a></li>
          <li><a href="/en/development">Development</a></li>
          <li><a href="/en/vocabulary">Vocabulary</a></li>
          
          <li><a href="/en/events">Events</a></li>
          
          <li><a href="/en/press">Press</a></li>
        </ul>
      </li>
      <li><a href="/en/innovation">Innovation</a></li>
      <li><a href="/en/support-bitcoin">Participate</a></li>
      
      <li><a href="/en/faq">FAQ</a></li>
      
    </ul>
  </div></div>
  <div class="body">
    <div id="content" class="content">
    <h1 id="bitcoin-developer-guide">Bitcoin Developer Guide</h1>

<p class="summary">Find detailed information about the Bitcoin protocol and related specifications.</p>

<div id="toc" class="toc">
  <div>

<ul id="markdown-toc">
  <li><a href="#block-chain">Block Chain</a>    <ul>
      <li><a href="#block-chain-overview">Block Chain Overview</a></li>
      <li><a href="#proof-of-work">Proof Of Work</a></li>
      <li><a href="#block-height-and-forking">Block Height And Forking</a></li>
      <li><a href="#transaction-data">Transaction Data</a></li>
    </ul>
  </li>
  <li><a href="#transactions">Transactions</a>    <ul>
      <li><a href="#p2pkh-script-validation">P2PKH Script Validation</a></li>
      <li><a href="#p2sh-scripts">P2SH Scripts</a></li>
      <li><a href="#standard-transactions">Standard Transactions</a>        <ul>
          <li><a href="#non-standard-transactions">Non-Standard Transactions</a></li>
        </ul>
      </li>
      <li><a href="#signature-hash-types">Signature Hash Types</a></li>
      <li><a href="#locktime-and-sequence-number">Locktime And Sequence Number</a></li>
      <li><a href="#transaction-fees-and-change">Transaction Fees And Change</a></li>
      <li><a href="#avoiding-key-reuse">Avoiding Key Reuse</a></li>
      <li><a href="#transaction-malleability">Transaction Malleability</a></li>
    </ul>
  </li>
  <li><a href="#contracts">Contracts</a>    <ul>
      <li><a href="#escrow-and-arbitration">Escrow And Arbitration</a></li>
      <li><a href="#micropayment-channel">Micropayment Channel</a></li>
      <li><a href="#coinjoin">CoinJoin</a></li>
    </ul>
  </li>
  <li><a href="#wallets">Wallets</a>    <ul>
      <li><a href="#wallet-programs">Wallet Programs</a>        <ul>
          <li><a href="#full-service-wallets">Full-Service Wallets</a></li>
          <li><a href="#signing-only-wallets">Signing-Only Wallets</a>            <ul>
              <li><a href="#offline-wallets">Offline Wallets</a></li>
              <li><a href="#hardware-wallets">Hardware Wallets</a></li>
            </ul>
          </li>
          <li><a href="#distributing-only-wallets">Distributing-Only Wallets</a></li>
        </ul>
      </li>
      <li><a href="#wallet-files">Wallet Files</a>        <ul>
          <li><a href="#private-key-formats">Private Key Formats</a>            <ul>
              <li><a href="#wallet-import-format-wif">Wallet Import Format (WIF)</a></li>
              <li><a href="#mini-private-key-format">Mini Private Key Format</a></li>
            </ul>
          </li>
          <li><a href="#public-key-formats">Public Key Formats</a></li>
          <li><a href="#hierarchical-deterministic-key-creation">Hierarchical Deterministic Key Creation</a>            <ul>
              <li><a href="#hardened-keys">Hardened Keys</a></li>
              <li><a href="#storing-root-seeds">Storing Root Seeds</a></li>
            </ul>
          </li>
          <li><a href="#loose-key-wallets">Loose-Key Wallets</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#payment-processing">Payment Processing</a>    <ul>
      <li><a href="#pricing-orders">Pricing Orders</a></li>
      <li><a href="#requesting-payments">Requesting Payments</a>        <ul>
          <li><a href="#plain-text">Plain Text</a></li>
          <li><a href="#bitcoin-uri">bitcoin: URI</a></li>
          <li><a href="#qr-codes">QR Codes</a></li>
          <li><a href="#payment-protocol">Payment Protocol</a></li>
        </ul>
      </li>
      <li><a href="#verifying-payment">Verifying Payment</a></li>
      <li><a href="#issuing-refunds">Issuing Refunds</a></li>
      <li><a href="#disbursing-income-limiting-forex-risk">Disbursing Income (Limiting Forex Risk)</a>        <ul>
          <li><a href="#merge-avoidance">Merge Avoidance</a></li>
          <li><a href="#last-in-first-out-lifo">Last In, First Out (LIFO)</a></li>
          <li><a href="#first-in-first-out-fifo">First In, First Out (FIFO)</a></li>
        </ul>
      </li>
      <li><a href="#rebilling-recurring-payments">Rebilling Recurring Payments</a></li>
    </ul>
  </li>
  <li><a href="#operating-modes">Operating Modes</a>    <ul>
      <li><a href="#full-node">Full Node</a></li>
      <li><a href="#simplified-payment-verification-spv">Simplified Payment Verification (SPV)</a>        <ul>
          <li><a href="#potential-spv-weaknesses">Potential SPV Weaknesses</a></li>
          <li><a href="#bloom-filters">Bloom Filters</a></li>
          <li><a href="#application-of-bloom-filters">Application Of Bloom Filters</a></li>
        </ul>
      </li>
      <li><a href="#future-proposals">Future Proposals</a></li>
    </ul>
  </li>
  <li><a href="#p2p-network">P2P Network</a>    <ul>
      <li><a href="#peer-discovery">Peer Discovery</a></li>
      <li><a href="#connecting-to-peers">Connecting To Peers</a></li>
      <li><a href="#block-broadcasting">Block Broadcasting</a></li>
      <li><a href="#transaction-broadcasting">Transaction Broadcasting</a>        <ul>
          <li><a href="#memory-pool">Memory Pool</a></li>
        </ul>
      </li>
      <li><a href="#misbehaving-nodes">Misbehaving Nodes</a></li>
      <li><a href="#alerts">Alerts</a></li>
    </ul>
  </li>
  <li><a href="#mining">Mining</a>    <ul>
      <li><a href="#solo-mining">Solo Mining</a></li>
      <li><a href="#pool-mining">Pool Mining</a></li>
      <li><a href="#block-prototypes">Block Prototypes</a>        <ul>
          <li><a href="#getwork-rpc">getwork RPC</a></li>
          <li><a href="#getblocktemplate-rpc">getblocktemplate RPC</a></li>
          <li><a href="#stratum">Stratum</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

    <ul class="goback"><li><a href="/en/developer-documentation">Return To Overview</a></li></ul>
    <ul class="reportissue"><li><a href="https://github.com/bitcoin/bitcoin.org/issues/new" onmouseover="updateIssue(event);">Report An Issue</a></li></ul>

  </div>
</div>

<div class="toccontent">

  <!-- includes should be separated by an empty line to prevent a
paragraph at the end of one file from breaking the heading at the start
of the following file. -->

  <!--Temporary disclaimer BEGIN-->
  <div id="develdocdisclaimer" class="develdocdisclaimer"><div>
<b>BETA</b>: This documentation has been written recently and still needs more reviews to ensure all content is covered correctly and accurately; if you find a mistake, please <a href="https://github.com/bitcoin/bitcoin.org/issues/new" onmouseover="updateIssue(event);">report an issue</a> on GitHub. <a href="#" onclick="disclaimerClose(event);">Click here</a> to close this disclaimer.
<a class="develdocdisclaimerclose" href="#" onclick="disclaimerClose(event);">X</a>
</div></div>
  <script>disclaimerAutoClose();</script>

  <!--Temporary disclaimer END-->

  <p>The Developer Guide aims to provide the information you need to understand
Bitcoin and start building Bitcoin-based applications. To make the best use of
this documentation, you may want to install the current version of Bitcoin
Core, either from <a href="https://github.com/bitcoin/bitcoin">source</a> or from a <a href="/en/download">pre-compiled executable</a>.</p>

  <p>Questions about Bitcoin development are best sent to the Bitcoin <a href="https://bitcointalk.org/index.php?board=4.0">Forum</a> and <a href="https://en.bitcoin.it/wiki/IRC_channels">IRC channels</a>. Errors or suggestions related to
documentation on Bitcoin.org can be <a href="https://github.com/bitcoin/bitcoin.org/issues">submitted as an issue</a>
or posted to the <a href="https://groups.google.com/forum/#!forum/bitcoin-documentation">bitcoin-documentation mailing list</a>.</p>

  <p>In the following documentation, some strings have been shortened or wrapped: “[…]”
indicates extra data was removed, and lines ending in a single backslash “\”
are continued below. If you hover your mouse over a paragraph, cross-reference
links will be shown in blue.  If you hover over a cross-reference link, a brief
definition of the term will be displayed in a tooltip.</p>

  <h2 id="block-chain">Block Chain</h2>

  <p>The <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> provides Bitcoin’s public ledger, a timestamped record
of all <a href="/en/developer-guide#term-confirmation" title="Transactions included in a block currently on the block chain" class="auto-link">confirmed transactions</a>. This system is used to protect against <a href="/en/developer-guide#term-double-spend" title="Attempting to spend the same satoshis which were spent in a previous transaction" class="auto-link">double spending</a>
and modification of previous transaction records, using <a href="/en/developer-guide#term-proof-of-work" title="Proof that computationally-difficult work was performed which helps secure blocks against modification, protecting transaction history" class="auto-link">proof of
work</a> verified by the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">peer-to-peer network</a> to maintain a global consensus.</p>

  <h3 id="block-chain-overview">Block Chain Overview</h3>

  <p><img src="/img/dev/en-blockchain-overview.svg" alt="Block Chain Overview" /></p>

  <p>The illustration above shows a simplified version of a <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>.
A <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" id="term-block" class="term">block</a> of one or more new transactions 
is collected into the transaction data part of a <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>.
Copies of each transaction are hashed, and the hashes are then paired,
hashed, paired again, and hashed again until a single hash remains, the
<a href="/en/developer-guide#term-merkle-root" title="The root node of a Merkle tree descended from all the hashed pairs in the tree" id="term-merkle-root" class="term">Merkle root</a> of a <a href="/en/developer-guide#term-merkle-tree" title="A tree constructed by hashing paired data, then pairing and hashing the results until a single hash remains, the Merkle root" class="auto-link">Merkle tree</a>.</p>

  <p>The <a href="/en/developer-guide#term-merkle-root" title="The root node of a Merkle tree descended from all the hashed pairs in the tree" class="auto-link">Merkle root</a> is stored in the <a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a>. Each <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> also
stores the hash of the previous <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block’s</a> header, chaining the <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>
together. This ensures a transaction cannot be modified without
modifying the <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> that records it and all following <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>.</p>

  <p>Transactions are also chained together. Bitcoin <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> software gives
the impression that <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> are sent from and to <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a>, but
<a href="/en/developer-guide#term-bitcoins" title="A primary accounting unit used in Bitcoin; 100 million satoshis" class="auto-link">bitcoins</a> really move from transaction to transaction. Each <a href="/en/developer-guide#standard-transactions" title="An output script which matches the isStandard() patterns specified in Bitcoin Core---or a transaction containing only standard outputs. Only standard transactions are mined or broadcast by peers running the default Bitcoin Core software" class="auto-link">standard
transaction</a> spends the <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> previously spent in one or more earlier
transactions, so the <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> of one transaction is the <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> of a
previous transaction.</p>

  <p><img src="/img/dev/en-transaction-propagation.svg" alt="Transaction Propagation" /></p>

  <p>A single transaction can spend <a href="/en/developer-guide#term-bitcoins" title="A primary accounting unit used in Bitcoin; 100 million satoshis" class="auto-link">bitcoins</a> to multiple <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a>, as would be
the case when sending <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> to multiple <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a>, but each <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> of
a particular transaction can only be used as an <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> once in the
<a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>. Any subsequent reference is a forbidden <a href="/en/developer-guide#term-double-spend" title="Attempting to spend the same satoshis which were spent in a previous transaction" class="auto-link">double
spend</a>—an attempt to spend the same <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> twice.</p>

  <p><a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">Outputs</a> are not the same as Bitcoin <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a>. You can use the same
<a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a> in multiple transactions, but you can only use each <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> once.
<a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">Outputs</a> are tied to <a href="/en/developer-guide#term-txid" title="A hash of a completed transaction which allows other transactions to spend its outputs" id="term-txid" class="term">transaction identifiers (TXIDs)</a>, which are the hashes
of signed transactions.</p>

  <p>Because each <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> of a particular transaction can only be spent once,
all transactions included in the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> can be categorized as either
<a href="/en/developer-guide#term-utxo" title="Unspent Transaction Output (UTXO) holding satoshis which have not yet been spent" id="term-utxo" class="term">Unspent Transaction Outputs (UTXOs)</a> or spent transaction <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a>. For a
payment to be valid, it must only use <a href="/en/developer-guide#term-utxo" title="Unspent Transaction Output (UTXO) holding satoshis which have not yet been spent" class="auto-link">UTXOs</a> as <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">inputs</a>.</p>

  <p><a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">Satoshis</a> cannot be left in a <a href="/en/developer-guide#term-utxo" title="Unspent Transaction Output (UTXO) holding satoshis which have not yet been spent" class="auto-link">UTXO</a> after a transaction or they will be
irretrievably lost, so any difference between the number of <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> in a
transaction’s <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">inputs</a> and <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a> is given as a <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" id="term-transaction-fee" class="term">transaction fee</a> to 
the Bitcoin <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" id="term-miner" class="term">miner</a> who creates the <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> containing that transaction. 
For example, in the illustration above, each transaction spends 10,000 <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>
fewer than it receives from its combined <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">inputs</a>, effectively paying a 10,000
<a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshi</a> <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fee</a>.</p>

  <h3 id="proof-of-work">Proof Of Work</h3>

  <p>The <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> is collaboratively maintained on a <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">peer-to-peer network</a>, so
Bitcoin requires each <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> prove a significant amount of work was invested in
its creation to ensure that untrustworthy <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peers</a> who want to modify past <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> have
to work harder than trustworthy <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peers</a> who only want to add new <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> to the
<a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>.</p>

  <p>Chaining <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> together makes it impossible to modify transactions included
in any <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> without modifying all following <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>. As a
result, the cost to modify a particular <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> increases with every new <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>
added to the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>, magnifying the effect of the <a href="/en/developer-guide#term-proof-of-work" title="Proof that computationally-difficult work was performed which helps secure blocks against modification, protecting transaction history" class="auto-link">proof of work</a>.</p>

  <p>The <a href="/en/developer-guide#term-proof-of-work" title="Proof that computationally-difficult work was performed which helps secure blocks against modification, protecting transaction history" id="term-proof-of-work" class="term">proof of work</a> used in Bitcoin
takes advantage of the apparently random nature of cryptographic hashes.
A good cryptographic hash algorithm converts arbitrary data into a
seemingly-random number. If the data is modified in any way and
the hash re-run, a new seemingly-random number is produced, so there is
no way to modify the data to make the hash number predictable.</p>

  <p>To prove you did some extra work to create a <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>, you must create a
hash of the <a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a> which does not exceed a certain value. For
example, if the maximum possible hash value is <span class="math">2<sup>256</sup> − 1</span>, you can prove that you
tried up to two combinations by producing a hash value less than <span class="math">2<sup>256</sup> − 1</span>.</p>

  <p>In the example given above, you will almost certainly produce a
successful hash on your first try. You can even estimate the probability
that a given hash attempt will generate a number below the <a href="/en/developer-guide#term-target" title="The threshold below which a block header hash must be in order for the block to be added to the block chain" id="term-target" class="term">target</a>
threshold. Bitcoin itself does not track probabilities but instead
simply assumes that the lower it makes the <a href="/en/developer-guide#term-target" title="The threshold below which a block header hash must be in order for the block to be added to the block chain" class="auto-link">target</a> threshold, the more
hash attempts, on average, will need to be tried.</p>

  <p>New <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> will only be added to the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> if their hash is at
least as challenging as a <a href="/en/developer-guide#term-difficulty" title="A number corresponding to the target threshold which indicates how difficult it will be to find the next block" id="term-difficulty" class="term">difficulty</a> value expected by the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">peer-to-peer
network</a>. Every 2,016 <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>, the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> uses timestamps stored in each
<a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a> to calculate the number of seconds elapsed between generation
of the first and last of those last 2,016 <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>. The ideal value is
1,209,600 seconds (two weeks).</p>

  <ul>
    <li>
      <p>If it took fewer than two weeks to generate the 2,016 <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>,
the expected <a href="/en/developer-guide#term-difficulty" title="A number corresponding to the target threshold which indicates how difficult it will be to find the next block" class="auto-link">difficulty</a> value is increased proportionally (by as much
as 300%) so that the next 2,016 <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> should take exactly two weeks
to generate if hashes are checked at the same rate.</p>
    </li>
    <li>
      <p>If it took more than two weeks to generate the <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>, the expected
<a href="/en/developer-guide#term-difficulty" title="A number corresponding to the target threshold which indicates how difficult it will be to find the next block" class="auto-link">difficulty</a> value is decreased proportionally (by as much as 75%) for
the same reason.</p>
    </li>
  </ul>

  <p>(Note: an off-by-one error in the Bitcoin Core implementation causes the
<a href="/en/developer-guide#term-difficulty" title="A number corresponding to the target threshold which indicates how difficult it will be to find the next block" class="auto-link">difficulty</a> to be updated every 2,01<em>6</em> <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> using timestamps from only
2,01<em>5</em> <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>, creating a slight skew.)</p>

  <p>Because each <a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a> must hash to a value below the <a href="/en/developer-guide#term-target" title="The threshold below which a block header hash must be in order for the block to be added to the block chain" class="auto-link">target</a>
threshold, and because each <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> is linked to the <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> that
preceded it, it requires (on average) as much hashing power to
propagate a modified <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> as the entire Bitcoin <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> expended
between the time the original <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> was created and the present time.
Only if you acquired a majority of the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network’s</a> hashing power
could you reliably execute such a <a href="/en/developer-guide#term-51-attack" title="The ability of someone controlling a majority of hashing power to revise transactions history and prevent new transactions from confirming" id="term-51-attack" class="term">51 percent attack</a> against
transaction history.</p>

  <p>The <a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a> provides several easy-to-modify fields, such as a
dedicated nonce field, so obtaining new hashes doesn’t require waiting
for new transactions. Also, only the 80-byte <a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a> is hashed for
<a href="/en/developer-guide#term-proof-of-work" title="Proof that computationally-difficult work was performed which helps secure blocks against modification, protecting transaction history" class="auto-link">proof-of-work</a>, so adding more bytes of transaction data to
a <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> does not slow down hashing with extra I/O.</p>

  <h3 id="block-height-and-forking">Block Height And Forking</h3>

  <p>Any Bitcoin <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miner</a> who successfully hashes a <a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a> to a value
below the <a href="/en/developer-guide#term-target" title="The threshold below which a block header hash must be in order for the block to be added to the block chain" class="auto-link">target</a> threshold can add the entire <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> to the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>.
(Assuming the <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> is otherwise valid.) These <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> are commonly addressed
by their <a href="/en/developer-guide#term-block-height" title="The number of chained blocks preceding this block" id="term-block-height" class="term">block height</a>—the number of <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> between them and the first Bitcoin
<a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> (<a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> 0, most commonly known as the <a href="/en/developer-guide#term-genesis-block" title="The first block created; also called block 0" id="term-genesis-block" class="term">genesis block</a>). For example,
<a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> 2016 is where <a href="/en/developer-guide#term-difficulty" title="A number corresponding to the target threshold which indicates how difficult it will be to find the next block" class="auto-link">difficulty</a> could have been first adjusted.</p>

  <p><img src="/img/dev/en-blockchain-fork.svg" alt="Common And Uncommon Block Chain Forks" /></p>

  <p>Multiple <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> can all have the same <a href="/en/developer-guide#term-block-height" title="The number of chained blocks preceding this block" class="auto-link">block height</a>, as is common when
two or more <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> each produce a <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> at roughly the same time. This
creates an apparent <a href="/en/developer-guide#term-accidental-fork" title="When two or more blocks have the same block height, forking the block chain.  Happens occasionally by accident" id="term-accidental-fork" class="term">fork</a> in the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>, as shown in the
illustration above.</p>

  <p>When <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> produce simultaneous <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> at the end of the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>, each
<a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a> individually chooses which <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> to trust. (In the absence of
other considerations, discussed below, <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peers</a> usually trust the first
<a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> they see.)</p>

  <p>Eventually a <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miner</a> produces another <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> which attaches to only one of
the competing simultaneously-mined <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>. This makes that side of
the <a href="/en/developer-guide#term-accidental-fork" title="When two or more blocks have the same block height, forking the block chain.  Happens occasionally by accident" class="auto-link">fork</a> longer than the other side. Assuming a <a href="/en/developer-guide#term-accidental-fork" title="When two or more blocks have the same block height, forking the block chain.  Happens occasionally by accident" class="auto-link">fork</a> only contains valid
<a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>, normal <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peers</a> always follow the longest <a href="/en/developer-guide#term-accidental-fork" title="When two or more blocks have the same block height, forking the block chain.  Happens occasionally by accident" class="auto-link">fork</a> (the most difficult chain
to recreate) and throw away (<a href="/en/developer-guide#term-orphan" title="Blocks which were successfully mined but which aren't included on the current valid block chain" id="term-orphan" class="term">orphan</a>) <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> belonging to shorter forks.</p>

  <p><a href="/en/developer-guide#term-long-term-fork" title="When a series of blocks have corresponding block heights, indicating a possibly serious problem" id="term-long-term-fork" class="term">Long-term forks</a> are possible if different <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> work at cross-purposes,
such as some <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> diligently working to extend the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> at the
same time other <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> are attempting a <a href="/en/developer-guide#term-51-attack" title="The ability of someone controlling a majority of hashing power to revise transactions history and prevent new transactions from confirming" class="auto-link">51 percent attack</a> to revise
transaction history.</p>

  <p>Since multiple <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> can have the same height during a <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> <a href="/en/developer-guide#term-accidental-fork" title="When two or more blocks have the same block height, forking the block chain.  Happens occasionally by accident" class="auto-link">fork</a>, <a href="/en/developer-guide#term-block-height" title="The number of chained blocks preceding this block" class="auto-link">block
height</a> should not be used as a globally unique identifier. Instead, <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>
are usually referenced by the SHA256(SHA256()) hash of their header.</p>

  <h3 id="transaction-data">Transaction Data</h3>

  <p>Every <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> must include one or more transactions. The first one of these
transactions must be a <a href="/en/developer-reference#term-coinbase-tx" title="A special transaction which miners must create when they generate a block" class="auto-link">coinbase transaction</a> which should collect and
spend the <a href="/en/developer-reference#term-block-reward" title="New satoshis given to a miner for creating one of the first 6,929,999 blocks" class="auto-link">block reward</a> and any <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fees</a> paid by transactions included in this <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>.</p>

  <p>The <a href="/en/developer-guide#term-utxo" title="Unspent Transaction Output (UTXO) holding satoshis which have not yet been spent" class="auto-link">UTXO</a> of a <a href="/en/developer-reference#term-coinbase-tx" title="A special transaction which miners must create when they generate a block" class="auto-link">coinbase transaction</a> has the special condition that
it cannot be spent (used as an <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a>) for at least 100 <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>. This temporarily
prevents a <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miner</a> from spending the <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fees</a> and <a href="/en/developer-reference#term-block-reward" title="New satoshis given to a miner for creating one of the first 6,929,999 blocks" class="auto-link">block reward</a> from a
<a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> that may later be <a href="/en/developer-guide#term-orphan" title="Blocks which were successfully mined but which aren't included on the current valid block chain" class="auto-link">orphaned</a> (destroyed) after a <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> <a href="/en/developer-guide#term-accidental-fork" title="When two or more blocks have the same block height, forking the block chain.  Happens occasionally by accident" class="auto-link">fork</a>.</p>

  <p><a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">Blocks</a> are not required to include any non-<a href="/en/developer-reference#term-coinbase-tx" title="A special transaction which miners must create when they generate a block" class="auto-link">coinbase transactions</a>, but
<a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> almost always do include additional transactions in order to
collect their <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fees</a>.</p>

  <p>All transactions, including the <a href="/en/developer-reference#term-coinbase-tx" title="A special transaction which miners must create when they generate a block" class="auto-link">coinbase transaction</a>, are encoded into
<a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> in binary <a href="/en/developer-reference#term-raw-format" title="Complete transactions in their binary format; often represented using hexidecimal" class="auto-link">rawtransaction format</a> prefixed by a <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> transaction
<a href="/en/developer-guide#term-sequence-number" title="A number intended to allow time locked transactions to be updated before being finalized; not currently used except to disable locktime in a transaction" class="auto-link">sequence number</a>.</p>

  <p>The <a href="/en/developer-reference#term-raw-format" title="Complete transactions in their binary format; often represented using hexidecimal" class="auto-link">rawtransaction format</a> is hashed to create the transaction
identifier (<a href="/en/developer-guide#term-txid" title="A hash of a completed transaction which allows other transactions to spend its outputs" class="auto-link">txid</a>). From these <a href="/en/developer-guide#term-txid" title="A hash of a completed transaction which allows other transactions to spend its outputs" class="auto-link">txids</a>, the <a href="/en/developer-guide#term-merkle-tree" title="A tree constructed by hashing paired data, then pairing and hashing the results until a single hash remains, the Merkle root" id="term-merkle-tree" class="term">Merkle tree</a> is constructed by pairing each
<a href="/en/developer-guide#term-txid" title="A hash of a completed transaction which allows other transactions to spend its outputs" class="auto-link">txid</a> with one other <a href="/en/developer-guide#term-txid" title="A hash of a completed transaction which allows other transactions to spend its outputs" class="auto-link">txid</a> and then hashing them together. If there are
an odd number of <a href="/en/developer-guide#term-txid" title="A hash of a completed transaction which allows other transactions to spend its outputs" class="auto-link">txids</a>, the <a href="/en/developer-guide#term-txid" title="A hash of a completed transaction which allows other transactions to spend its outputs" class="auto-link">txid</a> without a partner is hashed with a
copy of itself.</p>

  <p>The resulting hashes themselves are each paired with one other hash and
hashed together. Any hash without a partner is hashed with itself. The
process repeats until only one hash remains, the <a href="/en/developer-guide#term-merkle-root" title="The root node of a Merkle tree descended from all the hashed pairs in the tree" class="auto-link">Merkle root</a>.</p>

  <p>For example, if transactions were merely joined (not hashed), a
five-transaction <a href="/en/developer-guide#term-merkle-tree" title="A tree constructed by hashing paired data, then pairing and hashing the results until a single hash remains, the Merkle root" class="auto-link">Merkle tree</a> would look like the following text diagram:</p>

  <pre><code>       ABCDEEEE .......Merkle root
      /        \
   ABCD        EEEE
  /    \      /
 AB    CD    EE .......E is paired with itself
/  \  /  \  /
A  B  C  D  E .........Transactions
</code></pre>

  <p>As discussed in the Simplified Payment Verification (<a href="/en/developer-guide#simplified-payment-verification-spv" title="A method for verifying particular transactions were included in blocks without downloading the entire contents of the block chain" class="auto-link">SPV</a>) subsection,
the <a href="/en/developer-guide#term-merkle-tree" title="A tree constructed by hashing paired data, then pairing and hashing the results until a single hash remains, the Merkle root" class="auto-link">Merkle tree</a> allows clients to verify for
themselves that a transaction was included in a <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> by obtaining the
<a href="/en/developer-guide#term-merkle-root" title="The root node of a Merkle tree descended from all the hashed pairs in the tree" class="auto-link">Merkle root</a> from a <a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a> and a list of the intermediate hashes
from a full <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a>. The full <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a> does not need to be trusted: it is
expensive to fake <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> headers and the intermediate hashes cannot be faked or
the verification will fail.</p>

  <p>For example, to verify transaction D was added to the
<a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>, an <a href="/en/developer-guide#simplified-payment-verification-spv" title="A method for verifying particular transactions were included in blocks without downloading the entire contents of the block chain" class="auto-link">SPV</a> client only needs a copy of the C, AB, and EEEE hashes in addition to the
<a href="/en/developer-guide#term-merkle-root" title="The root node of a Merkle tree descended from all the hashed pairs in the tree" class="auto-link">Merkle root</a>; the client doesn’t need to know anything about any of the
other transactions. If the five transactions in this <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> were all at
the maximum size, downloading the entire <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> would require over
500,000 bytes—but downloading three hashes plus the <a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a>
requires only 140 bytes.</p>

  <h2 id="transactions">Transactions</h2>

  <p>Transactions let users spend <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>. Each transaction is constructed
out of several parts which enable both simple direct payments and complex
transactions. This section will describe each part and
demonstrate how to use them together to build complete transactions.</p>

  <p>To keep things simple, this section pretends <a href="/en/developer-reference#term-coinbase-tx" title="A special transaction which miners must create when they generate a block" class="auto-link">coinbase transactions</a> do
not exist. <a href="/en/developer-reference#term-coinbase-tx" title="A special transaction which miners must create when they generate a block" class="auto-link">Coinbase transactions</a> can only be created by Bitcoin <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a>
and they’re an exception to many of the rules listed below. Instead of
pointing out the <a href="/en/developer-reference#term-coinbase-tx" title="A special transaction which miners must create when they generate a block" class="auto-link">coinbase</a> exception to each rule, we invite you to read
about <a href="/en/developer-reference#term-coinbase-tx" title="A special transaction which miners must create when they generate a block" class="auto-link">coinbase transactions</a> in the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> section of this guide.</p>

  <p><img src="/img/dev/en-tx-overview.svg" alt="The Parts Of A Transaction" /></p>

  <p>The figure above shows the core parts of a Bitcoin transaction. Each
transaction has at least one <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> and one <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a>. Each <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" id="term-input" class="term">input</a> spends the
<a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> paid to a previous <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a>. Each <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" id="term-output" class="term">output</a> then waits as an Unspent
Transaction <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">Output</a> (<a href="/en/developer-guide#term-utxo" title="Unspent Transaction Output (UTXO) holding satoshis which have not yet been spent" class="auto-link">UTXO</a>) until a later <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> spends it. When your
Bitcoin <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> tells you that you have a 10,000 <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshi</a> balance, it really
means that you have 10,000 <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> waiting in one or more <a href="/en/developer-guide#term-utxo" title="Unspent Transaction Output (UTXO) holding satoshis which have not yet been spent" class="auto-link">UTXOs</a>.</p>

  <p>Each transaction is prefixed by a four-byte <a href="/en/developer-guide#term-transaction-version-number" title="A version number prefixed to transactions to allow upgrading&quot;" id="term-transaction-version-number" class="term">transaction version number</a> which tells
Bitcoin <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peers</a> and <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> which set of rules to use to validate it.  This
lets developers create new rules for future transactions without
invalidating previous transactions.</p>

  <p>The figures below help illustrate the other transaction features by
showing the workflow Alice uses to send Bob a transaction and which Bob
later uses to spend that transaction. Both Alice and Bob will use the
most common form of the standard Pay-To-Public-Key-Hash (<a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a>) transaction
type. <a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" id="term-p2pkh" class="term">P2PKH</a> lets Alice spend <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> to a typical Bitcoin <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a>,
and then lets Bob further spend those <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> using a simple
cryptographic <a href="/en/developer-guide#term-key-pair" title="A private key and its derived public key" class="auto-link">key pair</a>.</p>

  <p><img src="/img/dev/en-creating-p2pkh-output.svg" alt="Creating A P2PKH Public Key Hash To Receive Payment" /></p>

  <p>Bob must first generate a private/public <a href="/en/developer-guide#term-key-pair" title="A private key and its derived public key" id="term-key-pair" class="term">key pair</a> before Alice can create the
first transaction. Standard Bitcoin <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" id="term-private-key" class="term">private keys</a> are 256 bits of random
data. A copy of that data is deterministically transformed into a <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" id="term-public-key" class="term">public
key</a>. Because the transformation can be reliably repeated later, the
<a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> does not need to be stored.</p>

  <p>The <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> is then cryptographically hashed. This <a href="/en/developer-guide#term-pubkey-hash" title="The hash of a public key which can be included in a P2PKH output" class="auto-link">pubkey hash</a> can
also be reliably repeated later, so it also does not need to be stored.
The hash shortens and obfuscates the <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a>, making manual
transcription easier and providing security against
unanticipated problems which might allow reconstruction of <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a>
from <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> data at some later point.</p>

  <p>Bob provides the <a href="/en/developer-guide#term-pubkey-hash" title="The hash of a public key which can be included in a P2PKH output" id="term-pubkey-hash" class="term">pubkey hash</a> to Alice. <a href="/en/developer-guide#term-pubkey-hash" title="The hash of a public key which can be included in a P2PKH output" class="auto-link">Pubkey hashes</a> are almost always
sent encoded as Bitcoin <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" id="term-address" class="term">addresses</a>, which are <a href="/en/developer-reference#term-base58check" title="The method used in Bitcoin for converting 160-bit hashes into Bitcoin addresses" class="auto-link">base58</a>-encoded strings
containing an <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a> version number, the hash, and an error-detection
checksum to catch typos. The <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a> can be transmitted
through any medium, including one-way mediums which prevent the spender
from communicating with the receiver, and it can be further encoded
into another format, such as a QR code containing a <a href="/en/developer-guide#term-bitcoin-uri" title="A URI which allows receivers to encode payment details so spenders don't have to manually enter addresses and other details" class="auto-link"><code>bitcoin:</code>
URI</a>.</p>

  <p>Once Alice has the <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a> and decodes it back into a standard hash, she
can create the first transaction. She creates a standard <a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a>
transaction <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> containing instructions which allow anyone to spend that
<a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> if they can prove they control the <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a> corresponding to
Bob’s hashed <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a>. These instructions are called the <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" id="term-script" class="term">script</a>.</p>

  <p>Alice <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcasts</a> the transaction and it is added to the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>.
The <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> categorizes it as an Unspent Transaction <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">Output</a> (<a href="/en/developer-guide#term-utxo" title="Unspent Transaction Output (UTXO) holding satoshis which have not yet been spent" class="auto-link">UTXO</a>), and Bob’s
<a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> software displays it as a spendable balance.</p>

  <p>When, some time later, Bob decides to spend the <a href="/en/developer-guide#term-utxo" title="Unspent Transaction Output (UTXO) holding satoshis which have not yet been spent" class="auto-link">UTXO</a>, he must create an
<a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> which references the transaction Alice created by its hash, called
a Transaction Identifier (<a href="/en/developer-guide#term-txid" title="A hash of a completed transaction which allows other transactions to spend its outputs" class="auto-link">txid</a>), and the specific <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> she used by its
index number (<a href="/en/developer-guide#term-output-index" title="The sequentially-numbered index of outputs in a single transaction starting from 0" id="term-output-index" class="term">output index</a>). He must then create a <a href="/en/developer-guide#term-scriptsig" title="Data generated by a spender which is almost always used as variables to satisfy an output script" id="term-scriptsig" class="term">scriptSig</a>—a
collection of data parameters which satisfy the conditions Alice placed
in the previous <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output’s</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a>.</p>

  <p><img src="/img/dev/en-unlocking-p2pkh-output.svg" alt="Unlocking A P2PKH Output For Spending" /></p>

  <p>Bob does not need to communicate with Alice to do this; he must simply
prove to the Bitcoin <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">peer-to-peer network</a> that he can satisfy the
<a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script’s</a> conditions.  For a <a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a>-style <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a>, Bob’s <a href="/en/developer-guide#term-scriptsig" title="Data generated by a spender which is almost always used as variables to satisfy an output script" class="auto-link">scriptSig</a> will
contain the following two pieces of data:</p>

  <ol>
    <li>
      <p>His full (unhashed) <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a>, so the <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> can check that it
hashes to the same value as the <a href="/en/developer-guide#term-pubkey-hash" title="The hash of a public key which can be included in a P2PKH output" class="auto-link">pubkey hash</a> provided by Alice.</p>
    </li>
    <li>
      <p>A <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" id="term-signature" class="term">signature</a> made by using the <a href="https://en.wikipedia.org/wiki/Elliptic_Curve_DSA" class="auto-link">ECDSA</a> cryptographic formula to combine
certain transaction data (described below) with Bob’s <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a>.
This lets the <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> verify that Bob owns the <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a> which
created the <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a>.</p>
    </li>
  </ol>

  <p>Bob’s <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signature</a> doesn’t just prove Bob controls his <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a>; it also
makes the rest of his transaction tamper-proof so Bob can safely
<a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcast</a> it over the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">peer-to-peer network</a>.</p>

  <p><img src="/img/dev/en-signing-output-to-spend.svg" alt="Some Things Signed When Spending An Output" /></p>

  <p>As illustrated in the figure above, the data Bob signs includes the
<a href="/en/developer-guide#term-txid" title="A hash of a completed transaction which allows other transactions to spend its outputs" class="auto-link">txid</a> and <a href="/en/developer-guide#term-output-index" title="The sequentially-numbered index of outputs in a single transaction starting from 0" class="auto-link">output index</a> of the previous transaction, the previous
<a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output’s</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a>, the <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> Bob creates which will let the next
recipient spend this transaction’s <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a>, and the amount of <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> to
spend to the next recipient. In essence, the entire transaction is
signed except for any <a href="/en/developer-guide#term-scriptsig" title="Data generated by a spender which is almost always used as variables to satisfy an output script" class="auto-link">scriptSigs</a>, which hold the full <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> and
<a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signatures</a>.</p>

  <p>After putting his <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signature</a> and <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> in the <a href="/en/developer-guide#term-scriptsig" title="Data generated by a spender which is almost always used as variables to satisfy an output script" class="auto-link">scriptSig</a>, Bob
<a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcasts</a> the transaction to Bitcoin <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> through the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">peer-to-peer
network</a>. Each <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a> and <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miner</a> independently validates the transaction
before <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner)" class="auto-link">broadcasting</a> it further or attempting to include it in a new <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> of
transactions.</p>

  <h3 id="p2pkh-script-validation">P2PKH Script Validation</h3>

  <p>The validation procedure requires evaluation of the <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a>.  In a <a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a>
<a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a>, the <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> is:</p>

  <pre><code>OP_DUP OP_HASH160 &lt;PubkeyHash&gt; OP_EQUALVERIFY OP_CHECKSIG
</code></pre>

  <p>The spender’s <a href="/en/developer-guide#term-scriptsig" title="Data generated by a spender which is almost always used as variables to satisfy an output script" class="auto-link">scriptSig</a> is evaluated and prefixed to the beginning of the
<a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a>. In a <a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a> transaction, the <a href="/en/developer-guide#term-scriptsig" title="Data generated by a spender which is almost always used as variables to satisfy an output script" class="auto-link">scriptSig</a> contains a <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signature</a> (sig)
and full <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> (pubkey), creating the following concatenation:</p>

  <pre><code>&lt;Sig&gt; &lt;PubKey&gt; OP_DUP OP_HASH160 &lt;PubkeyHash&gt; OP_EQUALVERIFY OP_CHECKSIG
</code></pre>

  <p>The <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> language is a
<a href="https://en.wikipedia.org/wiki/Forth_%28programming_language%29">Forth-like</a>
<a href="/en/developer-guide#term-stack" title="An evaluation stack used in Bitcoin's script language" id="term-stack" class="term">stack</a>-based language deliberately designed to be stateless and not
Turing complete. Statelessness ensures that once a transaction is added
to the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>, there is no condition which renders it permanently
unspendable. Turing-incompleteness (specifically, a lack of loops or
gotos) makes the <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> language less flexible and more predictable,
greatly simplifying the security model.</p>

  <p>To test whether the transaction is valid, <a href="/en/developer-guide#term-scriptsig" title="Data generated by a spender which is almost always used as variables to satisfy an output script" class="auto-link">scriptSig</a> and <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> arguments
are pushed to the <a href="/en/developer-guide#term-stack" title="An evaluation stack used in Bitcoin's script language" class="auto-link">stack</a> one item at a time, starting with Bob’s <a href="/en/developer-guide#term-scriptsig" title="Data generated by a spender which is almost always used as variables to satisfy an output script" class="auto-link">scriptSig</a>
and continuing to the end of Alice’s <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a>. The figure below shows the
evaluation of a standard <a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a>; below the figure is a description
of the process.</p>

  <p><img src="/img/dev/en-p2pkh-stack.svg" alt="P2PKH Stack Evaluation" /></p>

  <ul>
    <li>
      <p>The <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signature</a> (from Bob’s <a href="/en/developer-guide#term-scriptsig" title="Data generated by a spender which is almost always used as variables to satisfy an output script" class="auto-link">scriptSig</a>) is added (pushed) to an empty <a href="/en/developer-guide#term-stack" title="An evaluation stack used in Bitcoin's script language" class="auto-link">stack</a>.
Because it’s just data, nothing is done except adding it to the <a href="/en/developer-guide#term-stack" title="An evaluation stack used in Bitcoin's script language" class="auto-link">stack</a>.
The <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> (also from the <a href="/en/developer-guide#term-scriptsig" title="Data generated by a spender which is almost always used as variables to satisfy an output script" class="auto-link">scriptSig</a>) is pushed on top of the <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signature</a>.</p>
    </li>
    <li>
      <p>From Alice’s <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a>, the <a href="/en/developer-reference#term-op-dup" title="Operation which duplicates the entry below it on the stack" class="auto-link"><code>OP_DUP</code></a> operation is pushed. <a href="/en/developer-reference#term-op-dup" title="Operation which duplicates the entry below it on the stack" class="auto-link"><code>OP_DUP</code></a> replaces
itself with a copy of the data from one level below it—in this
case creating a copy of the <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> Bob provided.</p>
    </li>
    <li>
      <p>The operation pushed next, <a href="/en/developer-reference#term-op-hash160" title="Operation which converts the entry below it on the stack into a RIPEMD(SHA256()) hashed version of itself" class="auto-link"><code>OP_HASH160</code></a>, replaces itself with a hash
of the data from one level below it—in this case, Bob’s <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a>.
This creates a hash of Bob’s <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a>.</p>
    </li>
    <li>
      <p>Alice’s <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> then pushes the <a href="/en/developer-guide#term-pubkey-hash" title="The hash of a public key which can be included in a P2PKH output" class="auto-link">pubkey hash</a> that Bob gave her for the
first transaction.  At this point, there should be two copies of Bob’s
<a href="/en/developer-guide#term-pubkey-hash" title="The hash of a public key which can be included in a P2PKH output" class="auto-link">pubkey hash</a> at the top of the <a href="/en/developer-guide#term-stack" title="An evaluation stack used in Bitcoin's script language" class="auto-link">stack</a>.</p>
    </li>
    <li>
      <p>Now it gets interesting: Alice’s <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> adds <a href="/en/developer-reference#term-op-equalverify" title="Operation which terminates the script in failure unless the two entries below it on the stack are equivalent" class="auto-link"><code>OP_EQUALVERIFY</code></a> to the
<a href="/en/developer-guide#term-stack" title="An evaluation stack used in Bitcoin's script language" class="auto-link">stack</a>. <a href="/en/developer-reference#term-op-equalverify" title="Operation which terminates the script in failure unless the two entries below it on the stack are equivalent" class="auto-link"><code>OP_EQUALVERIFY</code></a> expands to <a href="/en/developer-reference#term-op-equal" title="Operation which returns true if the two entries below it on the stack are equivalent" class="auto-link"><code>OP_EQUAL</code></a> and <a href="/en/developer-reference#term-op-verify" title="Operation which terminates the script if the entry below it on the stack is non-true (zero)" class="auto-link"><code>OP_VERIFY</code></a> (not shown).</p>

      <p><a href="/en/developer-reference#term-op-equal" title="Operation which returns true if the two entries below it on the stack are equivalent" class="auto-link"><code>OP_EQUAL</code></a> (not shown) checks the two values below it; in this
  case, it checks whether the <a href="/en/developer-guide#term-pubkey-hash" title="The hash of a public key which can be included in a P2PKH output" class="auto-link">pubkey hash</a> generated from the full
  <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> Bob provided equals the <a href="/en/developer-guide#term-pubkey-hash" title="The hash of a public key which can be included in a P2PKH output" class="auto-link">pubkey hash</a> Alice provided when
  she created transaction #1. <a href="/en/developer-reference#term-op-equal" title="Operation which returns true if the two entries below it on the stack are equivalent" class="auto-link"><code>OP_EQUAL</code></a> then replaces itself and
  the two values it compared with the result of that comparison:
  zero (<em>false</em>) or one (<em>true</em>).</p>

      <p><a href="/en/developer-reference#term-op-verify" title="Operation which terminates the script if the entry below it on the stack is non-true (zero)" class="auto-link"><code>OP_VERIFY</code></a> (not shown) checks the value immediately below it. If
  the value is <em>false</em> it immediately terminates <a href="/en/developer-guide#term-stack" title="An evaluation stack used in Bitcoin's script language" class="auto-link">stack</a> evaluation and
  the transaction validation fails. Otherwise it pops both itself and
  the <em>true</em> value off the <a href="/en/developer-guide#term-stack" title="An evaluation stack used in Bitcoin's script language" class="auto-link">stack</a>.</p>
    </li>
    <li>
      <p>Finally, Alice’s <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> pushes <a href="/en/developer-reference#term-op-checksig" title="Op code which returns true if a signature signs the correct parts of a transaction and matches a provided public key" class="auto-link"><code>OP_CHECKSIG</code></a>, which checks the
<a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signature</a> Bob provided against the now-authenticated <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> he
also provided. If the <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signature</a> matches the <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> and was
generated using all of the data required to be signed, <a href="/en/developer-reference#term-op-checksig" title="Op code which returns true if a signature signs the correct parts of a transaction and matches a provided public key" class="auto-link"><code>OP_CHECKSIG</code></a>
replaces itself with <em>true.</em></p>
    </li>
  </ul>

  <p>If <em>true</em> is at the top of the <a href="/en/developer-guide#term-stack" title="An evaluation stack used in Bitcoin's script language" class="auto-link">stack</a> after the <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> has been
evaluated, the transaction is valid (provided there are no other
problems with it).</p>

  <h3 id="p2sh-scripts">P2SH Scripts</h3>

  <p><a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">Output</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">scripts</a> are created by spenders who have little interest in the
long-term security or usefulness of the particular <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> they’re
currently spending. Receivers do care about the conditions imposed on
the <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> by the <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> and, if they want, they can ask
spenders to use a particular <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a>. Unfortunately, custom <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">scripts</a> are
less convenient than short Bitcoin <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a> and more difficult to
secure than <a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a> <a href="/en/developer-guide#term-pubkey-hash" title="The hash of a public key which can be included in a P2PKH output" class="auto-link">pubkey hashes</a>.</p>

  <p>To solve these problems, pay-to-<a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a>-hash
(<a href="/en/developer-guide#term-p2sh" title="A script which Pays To Script Hashes (P2SH), allowing convenient spending of satoshis to an address referencing a script" id="term-p2sh" class="term">P2SH</a>) transactions were created in 2012 to let
a spender create an <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> containing a <a href="/en/developer-guide#term-script-hash" title="The hash of a redeemScript used to create a P2SH output" id="term-script-hash" class="term">hash of a second
script</a>, the
<a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" id="term-redeemscript" class="term">redeemScript</a>.</p>

  <p>The basic <a href="/en/developer-guide#term-p2sh" title="A script which Pays To Script Hashes (P2SH), allowing convenient spending of satoshis to an address referencing a script" class="auto-link">P2SH</a> workflow, illustrated below, looks almost identical to
the <a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a> workflow. Bob creates a <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a> with whatever <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> he
wants, hashes the <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a>, and provides the <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a>
hash to Alice. Alice creates a <a href="/en/developer-guide#term-p2sh" title="A script which Pays To Script Hashes (P2SH), allowing convenient spending of satoshis to an address referencing a script" class="auto-link">P2SH</a>-style <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> containing
Bob’s <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a> hash.</p>

  <p><img src="/img/dev/en-creating-p2sh-output.svg" alt="Creating A P2SH RedeemScript And Hash" /></p>

  <p>When Bob wants to spend the <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a>, he provides his <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signature</a> along with
the full (serialized) <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a> in the <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> <a href="/en/developer-guide#term-scriptsig" title="Data generated by a spender which is almost always used as variables to satisfy an output script" class="auto-link">scriptSig</a>. The
<a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">peer-to-peer network</a> ensures the full <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a> hashes to the same
value as the <a href="/en/developer-guide#term-script-hash" title="The hash of a redeemScript used to create a P2SH output" class="auto-link">script hash</a> Alice put in her <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a>; it then processes the
<a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a> exactly as it would if it were the primary <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a>, letting
Bob spend the <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> if the <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a> returns true.</p>

  <p><img src="/img/dev/en-unlocking-p2sh-output.svg" alt="Unlocking A P2SH Output For Spending" /></p>

  <p>The hash of the <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a> has the same properties as a <a href="/en/developer-guide#term-pubkey-hash" title="The hash of a public key which can be included in a P2PKH output" class="auto-link">pubkey
hash</a>—so it can be transformed into the standard Bitcoin <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a> format
with only one small change to differentiate it from a standard <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a>.
This makes collecting a <a href="/en/developer-guide#term-p2sh" title="A script which Pays To Script Hashes (P2SH), allowing convenient spending of satoshis to an address referencing a script" class="auto-link">P2SH</a>-style <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a> as simple as collecting a
<a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a>-style <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a>. The hash also obfuscates any <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> in the
<a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a>, so <a href="/en/developer-guide#term-p2sh" title="A script which Pays To Script Hashes (P2SH), allowing convenient spending of satoshis to an address referencing a script" class="auto-link">P2SH</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">scripts</a> are as secure as <a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a> <a href="/en/developer-guide#term-pubkey-hash" title="The hash of a public key which can be included in a P2PKH output" class="auto-link">pubkey hashes</a>.</p>

  <h3 id="standard-transactions">Standard Transactions</h3>

  <p>After the discovery of several dangerous bugs in early versions of
Bitcoin, a test was added which only accepted transactions from the
<a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> if they had an <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> which matched a small set of
believed-to-be-safe templates and if the rest of the transaction didn’t
violate another small set of rules enforcing good <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> behavior. This
is the <code>isStandard()</code> test, and transactions which pass it are called
<a href="/en/developer-guide#standard-transactions" title="An output script which matches the isStandard() patterns specified in Bitcoin Core---or a transaction containing only standard outputs. Only standard transactions are mined or broadcast by peers running the default Bitcoin Core software" class="auto-link">standard transactions</a>.</p>

  <p>Non-<a href="/en/developer-guide#standard-transactions" title="An output script which matches the isStandard() patterns specified in Bitcoin Core---or a transaction containing only standard outputs. Only standard transactions are mined or broadcast by peers running the default Bitcoin Core software" class="auto-link">standard transactions</a>—those that fail the test—may be accepted
by nodes not using the default Bitcoin Core settings. If they are
included in <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>, they will also avoid the isStandard test and be
processed.</p>

  <p>Besides making it more difficult for someone to attack Bitcoin for
free by <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner)" class="auto-link">broadcasting</a> harmful transactions, the <a href="/en/developer-guide#standard-transactions" title="An output script which matches the isStandard() patterns specified in Bitcoin Core---or a transaction containing only standard outputs. Only standard transactions are mined or broadcast by peers running the default Bitcoin Core software" class="auto-link">standard transaction</a>
test also helps prevent users from creating transactions today that
would make adding new transaction features in the future more
difficult. For example, as described above, each transaction includes
a version number—if users started arbitrarily changing the version
number, it would become useless as a tool for introducing
backwards-incompatible features.</p>

  <p>As of Bitcoin Core 0.9, the <a href="/en/developer-guide#standard-transactions" title="An output script which matches the isStandard() patterns specified in Bitcoin Core---or a transaction containing only standard outputs. Only standard transactions are mined or broadcast by peers running the default Bitcoin Core software" class="auto-link">standard script</a> types are:</p>

  <p><strong><a href="/en/developer-guide#term-pubkey-hash" title="The hash of a public key which can be included in a P2PKH output" class="auto-link">Pubkey Hash</a> (<a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a>)</strong></p>

  <p><a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a> is the most common form of <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> used to send a transaction to one
or multiple Bitcoin <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a>.</p>

  <pre><code>script: OP_DUP OP_HASH160 &lt;PubKeyHash&gt; OP_EQUALVERIFY OP_CHECKSIG
scriptSig: &lt;sig&gt; &lt;pubkey&gt; 
</code></pre>

  <p><strong><a href="/en/developer-guide#term-script-hash" title="The hash of a redeemScript used to create a P2SH output" class="auto-link">Script Hash</a> (<a href="/en/developer-guide#term-p2sh" title="A script which Pays To Script Hashes (P2SH), allowing convenient spending of satoshis to an address referencing a script" class="auto-link">P2SH</a>)</strong></p>

  <p><a href="/en/developer-guide#term-p2sh" title="A script which Pays To Script Hashes (P2SH), allowing convenient spending of satoshis to an address referencing a script" class="auto-link">P2SH</a> is used to send a transaction to a <a href="/en/developer-guide#term-script-hash" title="The hash of a redeemScript used to create a P2SH output" class="auto-link">script hash</a>. Each of the <a href="/en/developer-guide#standard-transactions" title="An output script which matches the isStandard() patterns specified in Bitcoin Core---or a transaction containing only standard outputs. Only standard transactions are mined or broadcast by peers running the default Bitcoin Core software" class="auto-link">standard
scripts</a> can be used inside a <a href="/en/developer-guide#term-p2sh" title="A script which Pays To Script Hashes (P2SH), allowing convenient spending of satoshis to an address referencing a script" class="auto-link">P2SH</a> <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a>, but in practice only the
<a href="/en/developer-guide#term-multisig" title="An output script using OP_CHECKMULTISIG to check for multiple signatures" class="auto-link">multisig</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> makes sense until more transaction types are made standard.</p>

  <pre><code>script: OP_HASH160 &lt;redeemscripthash&gt; OP_EQUAL
scriptSig: &lt;sig&gt; [sig] [sig...] &lt;redeemscript&gt;
</code></pre>

  <p><strong><a href="/en/developer-guide#term-multisig" title="An output script using OP_CHECKMULTISIG to check for multiple signatures" class="auto-link">Multisig</a></strong></p>

  <p>Although <a href="/en/developer-guide#term-p2sh-multisig" title="A multisig script embedded in the redeemScript of a pay-to-script-hash (P2SH) transaction" class="auto-link">P2SH multisig</a> is now generally used for <a href="/en/developer-guide#term-multisig" title="An output script using OP_CHECKMULTISIG to check for multiple signatures" class="auto-link">multisig</a> transactions, this base <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a>
can be used to require multiple <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signatures</a> before a <a href="/en/developer-guide#term-utxo" title="Unspent Transaction Output (UTXO) holding satoshis which have not yet been spent" class="auto-link">UTXO</a> can be spent.</p>

  <p>In <a href="/en/developer-guide#term-multisig" title="An output script using OP_CHECKMULTISIG to check for multiple signatures" class="auto-link">multisig</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">scripts</a>, called m-of-n, <em>m</em> is the <em>minimum</em> number of <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signatures</a>
which must match a <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a>; <em>n</em> is the <em>number</em> of <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> being
provided. Both <em>m</em> and <em>n</em> should be <a href="/en/developer-reference#op-codes" title="Operation codes which run functions within a script" class="auto-link">op codes</a> <code>OP_1</code> through <code>OP_16</code>,
corresponding to the number desired.</p>

  <p>Because of an off-by-one error in the original Bitcoin implementation
which must be preserved for compatibility, <a href="/en/developer-reference#term-op-checkmultisig" title="Op code which returns true if one or more provided signatures (m) sign the correct parts of a transaction and match one or more provided public keys (n)" class="auto-link"><code>OP_CHECKMULTISIG</code></a>
consumes one more value from the <a href="/en/developer-guide#term-stack" title="An evaluation stack used in Bitcoin's script language" class="auto-link">stack</a> than indicated by <em>m</em>, so the
list of <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signatures</a> in the <a href="/en/developer-guide#term-scriptsig" title="Data generated by a spender which is almost always used as variables to satisfy an output script" class="auto-link">scriptSig</a> must be prefaced with an extra value
(<code>OP_0</code>) which will be consumed but not used.</p>

  <pre><code>script: &lt;m&gt; &lt;pubkey&gt; [pubkey] [pubkey...] &lt;n&gt; OP_CHECKMULTISIG
scriptSig: OP_0 &lt;sig&gt; [sig] [sig...]
</code></pre>

  <p>Although it’s not a separate transaction type, this is a <a href="/en/developer-guide#term-p2sh-multisig" title="A multisig script embedded in the redeemScript of a pay-to-script-hash (P2SH) transaction" class="auto-link">P2SH multisig</a> with 2-of-3:</p>

  <pre><code>script: OP_HASH160 &lt;redeemscripthash&gt; OP_EQUAL
redeemScript: &lt;OP_2&gt; &lt;pubkey&gt; &lt;pubkey&gt; &lt;pubkey&gt; &lt;OP_3&gt; OP_CHECKMULTISIG
scriptSig: OP_0 &lt;sig&gt; &lt;sig&gt; &lt;redeemscript&gt;
</code></pre>

  <p><strong>Pubkey</strong></p>

  <p><a href="/en/developer-guide#term-pubkey" title="A standard output script which specifies the full public key to match a signature; used in coinbase transactions" id="term-pubkey" class="term">Pubkey</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">scripts</a> are a simplified form of the <a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a>,
but they aren’t as
secure as <a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a>, so they generally
aren’t used in new transactions anymore.</p>

  <pre><code>script: &lt;pubkey&gt; OP_CHECKSIG
scriptSig: &lt;sig&gt;
</code></pre>

  <p><strong><a href="/en/developer-guide#term-null-data" title="A standard transaction type which allows adding 40 bytes of arbitrary data to the block chain up to once per transaction" class="auto-link">Null Data</a></strong></p>

  <p><a href="/en/developer-guide#term-null-data" title="A standard transaction type which allows adding 40 bytes of arbitrary data to the block chain up to once per transaction" id="term-null-data" class="term">Null data</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">scripts</a> let you add a small amount of arbitrary data to the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block
chain</a> in exchange for paying a <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fee</a>, but doing so is discouraged.
(<a href="/en/developer-guide#term-null-data" title="A standard transaction type which allows adding 40 bytes of arbitrary data to the block chain up to once per transaction" class="auto-link">Null data</a> is a <a href="/en/developer-guide#standard-transactions" title="An output script which matches the isStandard() patterns specified in Bitcoin Core---or a transaction containing only standard outputs. Only standard transactions are mined or broadcast by peers running the default Bitcoin Core software" class="auto-link">standard script</a> type only because some people were adding data
to the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> in more harmful ways.)</p>

  <pre><code>script: OP_RETURN &lt;data&gt;
(Null data scripts cannot be spent, so there's no scriptSig)
</code></pre>

  <h4 id="non-standard-transactions">Non-Standard Transactions</h4>

  <p>If you use anything besides a <a href="/en/developer-guide#standard-transactions" title="An output script which matches the isStandard() patterns specified in Bitcoin Core---or a transaction containing only standard outputs. Only standard transactions are mined or broadcast by peers running the default Bitcoin Core software" class="auto-link">standard script</a> in an <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a>, <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peers</a>
and <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> using the default Bitcoin Core settings will neither
accept, <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcast</a>, nor <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mine</a> your transaction. When you try to <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcast</a>
your transaction to a <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a> running the default settings, you will
receive an error.</p>

  <p>If you create a <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a>, hash it, and use the hash
in a <a href="/en/developer-guide#term-p2sh" title="A script which Pays To Script Hashes (P2SH), allowing convenient spending of satoshis to an address referencing a script" class="auto-link">P2SH</a> <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a>, the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> sees only the hash, so it will accept the
<a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> as valid no matter what the <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a> says.
This allows
payment to non-standard <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">scripts</a> almost as easily as payment to
standard <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">scripts</a>. However, when you go to
spend that <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a>, <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peers</a> and <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> using the default settings will
check the <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a> to see whether or not it’s a standard <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a>
<a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a>. If it isn’t, they won’t process it further—so it will be
impossible to spend that <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> until you find a <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miner</a> who disables the
default settings.</p>

  <p>Note: <a href="/en/developer-guide#standard-transactions" title="An output script which matches the isStandard() patterns specified in Bitcoin Core---or a transaction containing only standard outputs. Only standard transactions are mined or broadcast by peers running the default Bitcoin Core software" class="auto-link">standard transactions</a> are designed to protect and help the
<a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a>, not prevent you from making mistakes. It’s easy to create
<a href="/en/developer-guide#standard-transactions" title="An output script which matches the isStandard() patterns specified in Bitcoin Core---or a transaction containing only standard outputs. Only standard transactions are mined or broadcast by peers running the default Bitcoin Core software" class="auto-link">standard transactions</a> which make the <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> sent to them unspendable.</p>

  <p>As of Bitcoin Core 0.9, <a href="/en/developer-guide#standard-transactions" title="An output script which matches the isStandard() patterns specified in Bitcoin Core---or a transaction containing only standard outputs. Only standard transactions are mined or broadcast by peers running the default Bitcoin Core software" class="auto-link">standard transactions</a> must also meet the following
conditions:</p>

  <ul>
    <li>
      <p>The transaction must be finalized: either its <a href="/en/developer-guide#term-locktime" title="Part of a transaction which indicates the earliest time or earliest block when that transaction can be added to the block chain" class="auto-link">locktime</a> must be in the
past (or less than or equal to the current <a href="/en/developer-guide#term-block-height" title="The number of chained blocks preceding this block" class="auto-link">block height</a>), or all of its <a href="/en/developer-guide#term-sequence-number" title="A number intended to allow time locked transactions to be updated before being finalized; not currently used except to disable locktime in a transaction" class="auto-link">sequence
numbers</a> must be 0xffffffff.</p>
    </li>
    <li>
      <p>The transaction must be smaller than 100,000 bytes. That’s around 200
times larger than a typical single-<a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a>, single-<a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> <a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a>
transaction.</p>
    </li>
    <li>
      <p>Each of the transaction’s <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">inputs</a> must be smaller than 500 bytes.
That’s large enough to allow 3-of-3 <a href="/en/developer-guide#term-multisig" title="An output script using OP_CHECKMULTISIG to check for multiple signatures" class="auto-link">multisig</a> transactions in <a href="/en/developer-guide#term-p2sh" title="A script which Pays To Script Hashes (P2SH), allowing convenient spending of satoshis to an address referencing a script" class="auto-link">P2SH</a>.
<a href="/en/developer-guide#term-multisig" title="An output script using OP_CHECKMULTISIG to check for multiple signatures" class="auto-link">Multisig</a> transactions which require more than 3 <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> are
currently non-standard.</p>
    </li>
    <li>
      <p>The transaction’s <a href="/en/developer-guide#term-scriptsig" title="Data generated by a spender which is almost always used as variables to satisfy an output script" class="auto-link">scriptSig</a> must only push data to the <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a>
evaluation <a href="/en/developer-guide#term-stack" title="An evaluation stack used in Bitcoin's script language" class="auto-link">stack</a>. It cannot push new <a href="/en/developer-reference#op-codes" title="Operation codes which run functions within a script" class="auto-link">OP codes</a>, with the exception of
<a href="/en/developer-reference#op-codes" title="Operation codes which run functions within a script" class="auto-link">OP codes</a> which solely push data to the <a href="/en/developer-guide#term-stack" title="An evaluation stack used in Bitcoin's script language" class="auto-link">stack</a>.</p>
    </li>
    <li>
      <p>The transaction must not include any <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a> which receive fewer than
the defined minimum number of <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>, currently 546.</p>
    </li>
  </ul>

  <h3 id="signature-hash-types">Signature Hash Types</h3>

  <p><a href="/en/developer-reference#term-op-checksig" title="Op code which returns true if a signature signs the correct parts of a transaction and matches a provided public key" class="auto-link"><code>OP_CHECKSIG</code></a> extracts a non-<a href="/en/developer-guide#term-stack" title="An evaluation stack used in Bitcoin's script language" class="auto-link">stack</a> argument from each <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signature</a> it
evaluates, allowing the signer to decide which parts of the transaction
to sign. Since the <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signature</a> protects those parts of the transaction
from modification, this lets signers selectively choose to let other
people modify their transactions.</p>

  <p>The various options for what to sign are
called <a href="/en/developer-guide#term-signature-hash" title="A byte appended onto signatures generated in Bitcoin which allows the signer to specify what data was signed, allowing modification of the unsigned data" id="term-signature-hash" class="term">signature hash</a> types. There are three base <a href="/en/developer-guide#term-signature-hash" title="A byte appended onto signatures generated in Bitcoin which allows the signer to specify what data was signed, allowing modification of the unsigned data" class="auto-link">SIGHASH</a> types
currently available:</p>

  <ul>
    <li>
      <p><a href="/en/developer-guide#term-sighash-all" title="Default signature hash type which signs the entire transaction except any scriptSigs, preventing modification of the signed parts" id="term-sighash-all" class="term"><code>SIGHASH_ALL</code></a>, the default, signs all the <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">inputs</a> and <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a>,
protecting everything except the <a href="/en/developer-guide#term-scriptsig" title="Data generated by a spender which is almost always used as variables to satisfy an output script" class="auto-link">scriptSigs</a> against modification.</p>
    </li>
    <li>
      <p><a href="/en/developer-guide#term-sighash-none" title="Signature hash type which only signs the inputs, allowing anyone to change the outputs however they'd like" id="term-sighash-none" class="term"><code>SIGHASH_NONE</code></a> signs all of the <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">inputs</a> but none of the <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a>,
allowing anyone to change where the <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> are going unless other
<a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signatures</a> using other <a href="/en/developer-guide#term-signature-hash" title="A byte appended onto signatures generated in Bitcoin which allows the signer to specify what data was signed, allowing modification of the unsigned data" class="auto-link">signature hash</a> flags protect the <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a>.</p>
    </li>
    <li>
      <p><a href="/en/developer-guide#term-sighash-single" title="Signature hash type which only signs its input and the output with the same index value, allowing modification of other inputs and outputs" id="term-sighash-single" class="term"><code>SIGHASH_SINGLE</code></a> signs only this <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> and only one corresponding
<a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> (the <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> with the same <a href="/en/developer-guide#term-output-index" title="The sequentially-numbered index of outputs in a single transaction starting from 0" class="auto-link">output index</a> number as the <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a>), ensuring
nobody can change your part of the transaction but allowing other
signers to change their part of the transaction. The corresponding
<a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> must exist or the value “1” will be signed, breaking the security
scheme.</p>
    </li>
  </ul>

  <p>The base types can be modified with the <a href="/en/developer-guide#term-sighash-anyonecanpay" title="A signature hash type which modifies the behavior of other signature hash types" id="term-sighash-anyonecanpay" class="term"><code>SIGHASH_ANYONECANPAY</code></a> (anyone can
pay) flag, creating three new combined types:</p>

  <ul>
    <li>
      <p><a href="/en/developer-guide#term-sighash-all-sighash-anyonecanpay" title="Signature hash type which allows other people to contribute satoshis without changing the number of satoshis sent nor where they go" id="term-sighash-all-sighash-anyonecanpay" class="term"><code>SIGHASH_ALL|SIGHASH_ANYONECANPAY</code></a> signs all of the <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a> but only
this one <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a>, and it also allows anyone to add or remove other
<a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">inputs</a>, so anyone can contribute additional <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> but they cannot
change how many <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> are sent nor where they go.</p>
    </li>
    <li>
      <p><a href="/en/developer-guide#term-sighash-none-sighash-anyonecanpay" title="Signature hash type which allows unfettered modification of a transaction" id="term-sighash-none-sighash-anyonecanpay" class="term"><code>SIGHASH_NONE|SIGHASH_ANYONECANPAY</code></a> signs only this one <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> and
allows anyone to add or remove other <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">inputs</a> or <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a>, so anyone who
gets a copy of this <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> can spend it however they’d like.</p>
    </li>
    <li>
      <p><a href="/en/developer-guide#term-sighash-single-sighash-anyonecanpay" title="Signature hash type which allows modification of the entire transaction except the signed input and the output with the same index number" id="term-sighash-single-sighash-anyonecanpay" class="term"><code>SIGHASH_SINGLE|SIGHASH_ANYONECANPAY</code></a> signs only this <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> and only
one corresponding <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a>, but it also allows anyone to add or remove
other <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">inputs</a>.</p>
    </li>
  </ul>

  <p>Because each <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> is signed, a transaction with multiple <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">inputs</a> can
have multiple <a href="/en/developer-guide#term-signature-hash" title="A byte appended onto signatures generated in Bitcoin which allows the signer to specify what data was signed, allowing modification of the unsigned data" class="auto-link">signature hash</a> types signing different parts of the transaction. For
example, a single-<a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> transaction signed with <code>NONE</code> could have its
<a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> changed by the <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miner</a> who adds it to the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>. On the other
hand, if a two-<a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> transaction has one <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> signed with <code>NONE</code> and
one <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> signed with <code>ALL</code>, the <code>ALL</code> signer can choose where to spend
the <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> without consulting the <code>NONE</code> signer—but nobody else can
modify the transaction.</p>

  <h3 id="locktime-and-sequence-number">Locktime And Sequence Number</h3>

  <p>One thing all <a href="/en/developer-guide#term-signature-hash" title="A byte appended onto signatures generated in Bitcoin which allows the signer to specify what data was signed, allowing modification of the unsigned data" class="auto-link">signature hash</a> types sign is the transaction’s <a href="/en/developer-guide#term-locktime" title="Part of a transaction which indicates the earliest time or earliest block when that transaction can be added to the block chain" id="term-locktime" class="term">locktime</a>.
(Called nLockTime in the Bitcoin Core source code.)
The <a href="/en/developer-guide#term-locktime" title="Part of a transaction which indicates the earliest time or earliest block when that transaction can be added to the block chain" class="auto-link">locktime</a> indicates the earliest time a transaction can be added to
the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>.  </p>

  <p><a href="/en/developer-guide#term-locktime" title="Part of a transaction which indicates the earliest time or earliest block when that transaction can be added to the block chain" class="auto-link">Locktime</a> allows signers to create time-locked transactions which will
only become valid in the future, giving the signers a chance to change
their minds.</p>

  <p>If any of the signers change their mind, they can create a new
non-<a href="/en/developer-guide#term-locktime" title="Part of a transaction which indicates the earliest time or earliest block when that transaction can be added to the block chain" class="auto-link">locktime</a> transaction. The new transaction will use, as one of
its <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">inputs</a>, one of the same <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a> which was used as an <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> to
the <a href="/en/developer-guide#term-locktime" title="Part of a transaction which indicates the earliest time or earliest block when that transaction can be added to the block chain" class="auto-link">locktime</a> transaction. This makes the <a href="/en/developer-guide#term-locktime" title="Part of a transaction which indicates the earliest time or earliest block when that transaction can be added to the block chain" class="auto-link">locktime</a> transaction
invalid if the new transaction is added to the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> before
the time lock expires.</p>

  <p>Care must be taken near the expiry time of a time lock. The <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">peer-to-peer
network</a> allows <a href="/en/developer-reference#term-block-time" title="The time field in the block header" class="auto-link">block time</a> to be up to two hours ahead of
real time, so a <a href="/en/developer-guide#term-locktime" title="Part of a transaction which indicates the earliest time or earliest block when that transaction can be added to the block chain" class="auto-link">locktime</a> transaction can be added to the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> up
to two hours before its time lock officially expires. Also, <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> are
not created at guaranteed intervals, so any attempt to cancel a valuable
transaction should be made a few hours before the time lock expires.</p>

  <p>Previous versions of Bitcoin Core provided a feature which prevented
transaction signers from using the method described above to cancel a
time-locked transaction, but a necessary part of this feature was
disabled to prevent denial of service attacks. A legacy of this system are four-byte
<a href="/en/developer-guide#term-sequence-number" title="A number intended to allow time locked transactions to be updated before being finalized; not currently used except to disable locktime in a transaction" id="term-sequence-number" class="term">sequence numbers</a> in every <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a>. <a href="/en/developer-guide#term-sequence-number" title="A number intended to allow time locked transactions to be updated before being finalized; not currently used except to disable locktime in a transaction" class="auto-link">Sequence numbers</a> were meant to allow
multiple signers to agree to update a transaction; when they finished
updating the transaction, they could agree to set every <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input’s</a>
<a href="/en/developer-guide#term-sequence-number" title="A number intended to allow time locked transactions to be updated before being finalized; not currently used except to disable locktime in a transaction" class="auto-link">sequence number</a> to the four-byte unsigned maximum (0xffffffff),
allowing the transaction to be added to a <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> even if its time lock
had not expired.</p>

  <p>Even today, setting all <a href="/en/developer-guide#term-sequence-number" title="A number intended to allow time locked transactions to be updated before being finalized; not currently used except to disable locktime in a transaction" class="auto-link">sequence numbers</a> to 0xffffffff (the default in
Bitcoin Core) can still disable the time lock, so if you want to use
<a href="/en/developer-guide#term-locktime" title="Part of a transaction which indicates the earliest time or earliest block when that transaction can be added to the block chain" class="auto-link">locktime</a>, at least one <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> must have a <a href="/en/developer-guide#term-sequence-number" title="A number intended to allow time locked transactions to be updated before being finalized; not currently used except to disable locktime in a transaction" class="auto-link">sequence number</a> below the
maximum. Since <a href="/en/developer-guide#term-sequence-number" title="A number intended to allow time locked transactions to be updated before being finalized; not currently used except to disable locktime in a transaction" class="auto-link">sequence numbers</a> are not used by the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> for any
other purpose, setting any <a href="/en/developer-guide#term-sequence-number" title="A number intended to allow time locked transactions to be updated before being finalized; not currently used except to disable locktime in a transaction" class="auto-link">sequence number</a> to zero is sufficient to
enable <a href="/en/developer-guide#term-locktime" title="Part of a transaction which indicates the earliest time or earliest block when that transaction can be added to the block chain" class="auto-link">locktime</a>.</p>

  <p><a href="/en/developer-guide#term-locktime" title="Part of a transaction which indicates the earliest time or earliest block when that transaction can be added to the block chain" class="auto-link">Locktime</a> itself is an unsigned 4-byte number which can be parsed two ways:</p>

  <ul>
    <li>
      <p>If less than 500 million, <a href="/en/developer-guide#term-locktime" title="Part of a transaction which indicates the earliest time or earliest block when that transaction can be added to the block chain" class="auto-link">locktime</a> is parsed as a <a href="/en/developer-guide#term-block-height" title="The number of chained blocks preceding this block" class="auto-link">block height</a>. The
transaction can be added to any <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> which has this height or higher.</p>
    </li>
    <li>
      <p>If greater than or equal to 500 million, <a href="/en/developer-guide#term-locktime" title="Part of a transaction which indicates the earliest time or earliest block when that transaction can be added to the block chain" class="auto-link">locktime</a> is parsed using the
Unix epoch time format (the number of seconds elapsed since
1970-01-01T00:00 UTC—currently over 1.395 billion). The transaction
can be added to any <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> whose <a href="/en/developer-reference#term-block-time" title="The time field in the block header" class="auto-link">block time</a> is greater
than the <a href="/en/developer-guide#term-locktime" title="Part of a transaction which indicates the earliest time or earliest block when that transaction can be added to the block chain" class="auto-link">locktime</a>.</p>
    </li>
  </ul>

  <h3 id="transaction-fees-and-change">Transaction Fees And Change</h3>

  <p>Transactions typically pay <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fees</a> based on the total byte size
of the signed transaction.  The <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fee</a> is given to the
Bitcoin <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miner</a>, as explained in the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain">block chain section</a>, and so it is
ultimately up to each <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miner</a> to choose the minimum <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fee</a> they
will accept.</p>

  <p>By default, <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> reserve 50 KB of each <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> for <a href="/en/developer-guide#term-high-priority-transactions" title="Transactions which don't pay a transaction fee; only transactions spending long-idle outputs are eligible" id="term-high-priority-transactions" class="term">high-priority
transactions</a> which spend <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> that haven’t been spent for a long
time.  The remaining space in each <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> is typically allocated to transactions
based on their fee per byte, with higher-paying transactions being added
in sequence until all of the available space is filled.</p>

  <p>As of Bitcoin Core 0.9, transactions which do not count as <a href="/en/developer-guide#term-high-priority-transactions" title="Transactions which don't pay a transaction fee; only transactions spending long-idle outputs are eligible" class="auto-link">high-priority transactions</a>
need to pay a <a href="/en/developer-guide#term-minimum-fee" title="The minimum fee a transaction must pay in must circumstances to be mined or broadcast by peers across the network" id="term-minimum-fee" class="term">minimum fee</a> (currently 1,000 <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>) to be
<a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcast</a> across the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a>. Any transaction paying only the <a href="/en/developer-guide#term-minimum-fee" title="The minimum fee a transaction must pay in must circumstances to be mined or broadcast by peers across the network" class="auto-link">minimum fee</a>
should be prepared to wait a long time before there’s enough spare space
in a <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> to include it. Please see the <a href="/en/developer-guide#verifying-payment">verifying payment section</a>
for why this could be important.</p>

  <p>Since each transaction spends Unspent Transaction <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">Outputs</a> (<a href="/en/developer-guide#term-utxo" title="Unspent Transaction Output (UTXO) holding satoshis which have not yet been spent" class="auto-link">UTXOs</a>) and
because a <a href="/en/developer-guide#term-utxo" title="Unspent Transaction Output (UTXO) holding satoshis which have not yet been spent" class="auto-link">UTXO</a> can only be spent once, the full value of the included
<a href="/en/developer-guide#term-utxo" title="Unspent Transaction Output (UTXO) holding satoshis which have not yet been spent" class="auto-link">UTXOs</a> must be spent or given to a <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miner</a> as a <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fee</a>.  Few
people will have <a href="/en/developer-guide#term-utxo" title="Unspent Transaction Output (UTXO) holding satoshis which have not yet been spent" class="auto-link">UTXOs</a> that exactly match the amount they want to pay,
so most transactions include a <a href="/en/developer-guide#term-change-output" title="An output used by a spender to send back to himself some of the satoshis from the inputs" class="auto-link">change output</a>.</p>

  <p><a href="/en/developer-guide#term-change-output" title="An output used by a spender to send back to himself some of the satoshis from the inputs" id="term-change-output" class="term">Change outputs</a> are regular <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a> which spend the surplus <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>
from the <a href="/en/developer-guide#term-utxo" title="Unspent Transaction Output (UTXO) holding satoshis which have not yet been spent" class="auto-link">UTXOs</a> back to the spender.  They can reuse the same <a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a> <a href="/en/developer-guide#term-pubkey-hash" title="The hash of a public key which can be included in a P2PKH output" class="auto-link">pubkey hash</a>
or <a href="/en/developer-guide#term-p2sh" title="A script which Pays To Script Hashes (P2SH), allowing convenient spending of satoshis to an address referencing a script" class="auto-link">P2SH</a> <a href="/en/developer-guide#term-script-hash" title="The hash of a redeemScript used to create a P2SH output" class="auto-link">script hash</a> as was used in the <a href="/en/developer-guide#term-utxo" title="Unspent Transaction Output (UTXO) holding satoshis which have not yet been spent" class="auto-link">UTXO</a>, but for the reasons
described in the <a href="#avoiding-key-reuse">next subsection</a>, it is highly recommended that <a href="/en/developer-guide#term-change-output" title="An output used by a spender to send back to himself some of the satoshis from the inputs" class="auto-link">change
outputs</a> be sent to a new <a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a> or <a href="/en/developer-guide#term-p2sh" title="A script which Pays To Script Hashes (P2SH), allowing convenient spending of satoshis to an address referencing a script" class="auto-link">P2SH</a> <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a>.</p>

  <h3 id="avoiding-key-reuse">Avoiding Key Reuse</h3>

  <p>In a transaction, the spender and receiver each reveal to each other all
<a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> or <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a> used in the transaction. This allows either
person to use the public <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> to track past and future
transactions involving the other person’s same <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> or <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a>.</p>

  <p>If the same <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> is reused often, as happens when people use
Bitcoin <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a> (hashed <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a>) as static payment <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a>,
other people can easily track the receiving and spending habits of that
person, including how many <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> they control in known <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a>.</p>

  <p>It doesn’t have to be that way. If each <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> is used exactly
twice—once to receive a payment and once to spend that payment—the
user can gain a significant amount of financial privacy.</p>

  <p>Even better, using new <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> or <a href="/en/developer-guide#term-unique-address" title="Address which are only used once to protect privacy and increase security" id="term-unique-address" class="term">unique
addresses</a> when accepting payments or creating
<a href="/en/developer-guide#term-change-output" title="An output used by a spender to send back to himself some of the satoshis from the inputs" class="auto-link">change outputs</a> can be combined with other techniques discussed later,
such as CoinJoin or <a href="/en/developer-guide#term-merge-avoidance" title="A strategy for selecting which outputs to spend that avoids merging outputs with different histories that could leak private information" class="auto-link">merge avoidance</a>, to make it extremely difficult to
use the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> by itself to reliably track how users receive and
spend their <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>.</p>

  <p>Avoiding key reuse can also provide security against attacks which might
allow reconstruction of <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a> from <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> (hypothesized) or
from <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signature</a> comparisons (possible today under certain circumstances
described below, with more general attacks hypothesized).</p>

  <ol>
    <li>
      <p>Unique (non-reused) <a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a> and <a href="/en/developer-guide#term-p2sh" title="A script which Pays To Script Hashes (P2SH), allowing convenient spending of satoshis to an address referencing a script" class="auto-link">P2SH</a> <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a> protect against the first
type of attack by keeping <a href="https://en.wikipedia.org/wiki/Elliptic_Curve_DSA" class="auto-link">ECDSA</a> <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> hidden (hashed) until the
first time <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> sent to those <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a> are spent, so attacks
are effectively useless unless they can reconstruct <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a> in
less than the hour or two it takes for a transaction to be well
protected by the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>.</p>
    </li>
    <li>
      <p>Unique (non-reused) <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a> protect against the second type of
attack by only generating one <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signature</a> per <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a>, so attackers
never get a subsequent <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signature</a> to use in comparison-based attacks.
Existing comparison-based attacks are only practical today when 
insufficient entropy is used in signing or when the entropy used
is exposed by some means, such as a
<a href="https://en.wikipedia.org/wiki/Side_channel_attack">side-channel attack</a>.</p>
    </li>
  </ol>

  <p>So, for both privacy and security, we encourage you to build your
applications to avoid <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> reuse and, when possible, to discourage
users from reusing <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a>. If your application needs to provide a
fixed URI to which payments should be sent, please see the
<a href="/en/developer-guide#bitcoin-uri"><code>bitcoin:</code> URI section</a> below.</p>

  <h3 id="transaction-malleability">Transaction Malleability</h3>

  <p>None of Bitcoin’s <a href="/en/developer-guide#term-signature-hash" title="A byte appended onto signatures generated in Bitcoin which allows the signer to specify what data was signed, allowing modification of the unsigned data" class="auto-link">signature hash</a> types protect the <a href="/en/developer-guide#term-scriptsig" title="Data generated by a spender which is almost always used as variables to satisfy an output script" class="auto-link">scriptSig</a>, leaving
the door open for a limited denial of service attack called <a href="/en/developer-guide#transaction-malleability" title="The ability of an attacker to change the transaction identifier (txid) of unconfirmed transactions, making dependent transactions invalid" class="term" id="term-transaction-malleability">transaction
malleability</a>. The <a href="/en/developer-guide#term-scriptsig" title="Data generated by a spender which is almost always used as variables to satisfy an output script" class="auto-link">scriptSig</a>
contains the <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signature</a>, which can’t sign itself, allowing attackers to
make non-functional modifications to a transaction without rendering it
invalid. For example, an attacker can add some data to the <a href="/en/developer-guide#term-scriptsig" title="Data generated by a spender which is almost always used as variables to satisfy an output script" class="auto-link">scriptSig</a>
which will be dropped before the previous <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> is processed.</p>

  <p>Although the modifications are non-functional—so they do not change
what <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">inputs</a> the transaction uses nor what <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a> it pays—they do
change the computed hash of the transaction. Since each transaction
links to previous transactions using hashes as a transaction
identifier (<a href="/en/developer-guide#term-txid" title="A hash of a completed transaction which allows other transactions to spend its outputs" class="auto-link">txid</a>), a modified transaction will not have the <a href="/en/developer-guide#term-txid" title="A hash of a completed transaction which allows other transactions to spend its outputs" class="auto-link">txid</a> its
creator expected.</p>

  <p>This isn’t a problem for most Bitcoin transactions which are designed to
be added to the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> immediately. But it does become a problem
when the <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> from a transaction is spent before that transaction is
added to the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>.</p>

  <p>Bitcoin developers have been working to reduce <a href="/en/developer-guide#transaction-malleability" title="The ability of an attacker to change the transaction identifier (txid) of unconfirmed transactions, making dependent transactions invalid" class="auto-link">transaction malleability</a>
among <a href="/en/developer-guide#standard-transactions" title="An output script which matches the isStandard() patterns specified in Bitcoin Core---or a transaction containing only standard outputs. Only standard transactions are mined or broadcast by peers running the default Bitcoin Core software" class="auto-link">standard transaction</a> types, but a complete fix is still only in
the planning stages. At present, new transactions should not depend on
previous transactions which have not been added to the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> yet,
especially if large amounts of <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> are at stake.</p>

  <p><a href="/en/developer-guide#transaction-malleability" title="The ability of an attacker to change the transaction identifier (txid) of unconfirmed transactions, making dependent transactions invalid" class="auto-link">Transaction malleability</a> also affects payment tracking.  Bitcoin Core’s
<a href="/en/developer-reference#remote-procedure-calls-rpcs" class="auto-link">RPC</a> interface lets you track transactions by their <a href="/en/developer-guide#term-txid" title="A hash of a completed transaction which allows other transactions to spend its outputs" class="auto-link">txid</a>—but if that
<a href="/en/developer-guide#term-txid" title="A hash of a completed transaction which allows other transactions to spend its outputs" class="auto-link">txid</a> changes because the transaction was modified, it may appear that
the transaction has disappeared from the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a>.</p>

  <p>Current best practices for transaction tracking dictate that a
transaction should be tracked by the transaction <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a> (<a href="/en/developer-guide#term-utxo" title="Unspent Transaction Output (UTXO) holding satoshis which have not yet been spent" class="auto-link">UTXOs</a>) it
spends as <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">inputs</a>, as they cannot be changed without invalidating the
transaction.</p>

  <p>Best practices further dictate that if a transaction does seem to
disappear from the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> and needs to be reissued, that it be reissued
in a way that invalidates the lost transaction. One method which will
always work is to ensure the reissued payment spends all of the same
<a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a> that the lost transaction used as <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">inputs</a>.</p>

  <h2 id="contracts">Contracts</h2>

  <p>Contracts are
transactions which use the decentralized Bitcoin system to enforce financial
agreements.
Bitcoin contracts can often be crafted to minimize dependency on outside
agents, such as the court system, which significantly decreases the risk
of dealing with unknown entities in financial transactions. </p>

  <p>The following subsections will describe a variety of Bitcoin contracts
already in use. Because contracts deal with real people, not just
transactions, they are framed below in story format.</p>

  <p>Besides the contract types described below, many other contract types
have been proposed. Several of them are collected on the <a href="https://en.bitcoin.it/wiki/Contracts">Contracts
page</a> of the Bitcoin Wiki.</p>

  <h3 id="escrow-and-arbitration">Escrow And Arbitration</h3>

  <p>Charlie-the-customer wants to buy a product from Bob-the-businessman,
but neither of them trusts the other person, so they use a contract to
help ensure Charlie gets his merchandise and Bob gets his payment.</p>

  <p>A simple contract could say that Charlie will spend <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> to an
<a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> which can only be spent if Charlie and Bob both sign the <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a>
spending it. That means Bob won’t get paid unless Charlie gets his
merchandise, but Charlie can’t get the merchandise and keep his payment.</p>

  <p>This simple contract isn’t much help if there’s a dispute, so Bob and
Charlie enlist the help of Alice-the-arbitrator to create an <a href="/en/developer-guide#term-escrow-contract" title="A contract in which the spender and receiver store satoshis in a multisig output until both parties agree to release the satoshis" id="term-escrow-contract" class="term">escrow
contract</a>. Charlie spends his <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>
to an <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> which can only be spent if two of the three people sign the
<a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a>. Now Charlie can pay Bob if everything is ok, Bob can <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a>
Charlie’s money if there’s a problem, or Alice can arbitrate and decide
who should get the <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> if there’s a dispute.</p>

  <p>To create a multiple-<a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signature</a> (<a href="/en/developer-guide#term-multisig" title="An output script using OP_CHECKMULTISIG to check for multiple signatures" id="term-multisig" class="term">multisig</a>)
<a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a>, they each give the others a <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a>. Then Bob creates the
following <a href="/en/developer-guide#term-p2sh-multisig" title="A multisig script embedded in the redeemScript of a pay-to-script-hash (P2SH) transaction" id="term-p2sh-multisig" class="term">P2SH multisig</a> <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a>:</p>

  <pre><code>OP_2 [A's pubkey] [B's pubkey] [C's pubkey] OP_3 OP_CHECKMULTISIG
</code></pre>

  <p>(<a href="/en/developer-reference#op-codes" title="Operation codes which run functions within a script" class="auto-link">Op codes</a> to push the <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> onto the <a href="/en/developer-guide#term-stack" title="An evaluation stack used in Bitcoin's script language" class="auto-link">stack</a> are not shown.)</p>

  <p><code>OP_2</code> and <code>OP_3</code> push the actual numbers 2 and 3 onto the
<a href="/en/developer-guide#term-stack" title="An evaluation stack used in Bitcoin's script language" class="auto-link">stack</a>. <code>OP_2</code>
specifies that 2 <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signatures</a> are required to sign; <code>OP_3</code> specifies that
3 <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> (unhashed) are being provided. This is a 2-of-3 <a href="/en/developer-guide#term-multisig" title="An output script using OP_CHECKMULTISIG to check for multiple signatures" class="auto-link">multisig</a>
<a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a>, more generically called a m-of-n <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> (where <em>m</em> is the
<em>minimum</em> matching <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signatures</a> required and <em>n</em> in the <em>number</em> of <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public
keys</a> provided).</p>

  <p>Bob gives the <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a> to Charlie, who checks to make sure his
<a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> and Alice’s <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> are included. Then he hashes the
<a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a>, puts it in a <a href="/en/developer-guide#term-p2sh" title="A script which Pays To Script Hashes (P2SH), allowing convenient spending of satoshis to an address referencing a script" class="auto-link">P2SH</a> <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a>, and pays the <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> to it. Bob
sees the payment get added to the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> and ships the merchandise.</p>

  <p>Unfortunately, the merchandise gets slightly damaged in transit. Charlie
wants a full <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a>, but Bob thinks a 10% <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a> is sufficient. They
turn to Alice to resolve the issue. Alice asks for photo evidence from
Charlie along with a copy of the unhashed <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a> Bob created and
Charlie checked. </p>

  <p>After looking at the evidence, Alice thinks a 40% <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a> is sufficient,
so she creates and signs a transaction with two <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a>, one that spends 60%
of the <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> to Bob’s <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> and one that spends the remaining
40% to Charlie’s <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a>.</p>

  <p>In the <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> section of the <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a>, Alice puts her <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signature</a>
and a copy of the unhashed serialized <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a>
that Bob created.  She gives a copy of the incomplete transaction to
both Bob and Charlie.  Either one of them can complete it by adding
his <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signature</a> to create the following <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a>
<a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a>:</p>

  <pre><code>OP_0 [A's signature] [B's or C's signature] [serialized redeemScript]
</code></pre>

  <p>(<a href="/en/developer-reference#op-codes" title="Operation codes which run functions within a script" class="auto-link">Op codes</a> to push the <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signatures</a> and <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a> onto the <a href="/en/developer-guide#term-stack" title="An evaluation stack used in Bitcoin's script language" class="auto-link">stack</a> are
not shown. <code>OP_0</code> is a workaround for an off-by-one error in the original
implementation which must be preserved for compatibility.)</p>

  <p>When the transaction is <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcast</a> to the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a>, each <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a> checks the
<a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> against the <a href="/en/developer-guide#term-p2sh" title="A script which Pays To Script Hashes (P2SH), allowing convenient spending of satoshis to an address referencing a script" class="auto-link">P2SH</a> <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> Charlie previously paid,
ensuring that the <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a> matches the <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a> hash previously
provided. Then the <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a> is evaluated, with the two <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signatures</a>
being used as input data. Assuming the <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a>
validates, the two transaction <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a> show up in Bob’s and Charlie’s
<a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a> as spendable balances.</p>

  <p>However, if Alice created and signed a transaction neither of them would
agree to, such as spending all the <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> to herself, Bob and Charlie
can find a new arbitrator and sign a transaction spending the <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>
to another 2-of-3 <a href="/en/developer-guide#term-multisig" title="An output script using OP_CHECKMULTISIG to check for multiple signatures" class="auto-link">multisig</a> <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a> hash, this one including a <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public
key</a> from that second arbitrator. This means that Bob and Charlie never
need to worry about their arbitrator stealing their money.</p>

  <p><strong>Resource:</strong> <a href="https://www.bitrated.com/">BitRated</a> provides a <a href="/en/developer-guide#term-multisig" title="An output script using OP_CHECKMULTISIG to check for multiple signatures" class="auto-link">multisig</a> arbitration
service interface using HTML/JavaScript on a GNU AGPL-licensed website.</p>

  <h3 id="micropayment-channel">Micropayment Channel</h3>

  <p>Alice also works part-time moderating forum posts for Bob. Every time
someone posts to Bob’s busy forum, Alice skims the post to make sure it
isn’t offensive or spam. Alas, Bob often forgets to pay her, so Alice
demands to be paid immediately after each post she approves or rejects.
Bob says he can’t do that because hundreds of small payments will cost
him thousands of <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> in <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fees</a>, so Alice suggests they use a
<a href="/en/developer-guide#term-micropayment-channel" id="term-micropayment-channel" class="term">micropayment channel</a>.</p>

  <p>Bob asks Alice for her <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> and then creates two transactions.
The first transaction pays 100 <a href="/en/developer-guide#term-millibits" title="0.001 bitcoins (100,000 satoshis)" class="auto-link">millibits</a> to a <a href="/en/developer-guide#term-p2sh" title="A script which Pays To Script Hashes (P2SH), allowing convenient spending of satoshis to an address referencing a script" class="auto-link">P2SH</a> <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> whose
2-of-2 <a href="/en/developer-guide#term-multisig" title="An output script using OP_CHECKMULTISIG to check for multiple signatures" class="auto-link">multisig</a> <a href="/en/developer-guide#term-redeemscript" title="A script created by the recipient, hashed, and given to the spender for use in a P2SH output" class="auto-link">redeemScript</a> requires <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signatures</a> from both Alice and Bob.
This is the bond transaction.
<a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner)" class="auto-link">Broadcasting</a> this transaction would let Alice hold the <a href="/en/developer-guide#term-millibits" title="0.001 bitcoins (100,000 satoshis)" class="auto-link">millibits</a>
hostage, so Bob keeps this transaction private for now and creates a
second transaction.</p>

  <p>The second transaction spends all of the first transaction’s <a href="/en/developer-guide#term-millibits" title="0.001 bitcoins (100,000 satoshis)" class="auto-link">millibits</a>
(minus a <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fee</a>) back to Bob after a 24 hour delay enforced
by <a href="/en/developer-guide#term-locktime" title="Part of a transaction which indicates the earliest time or earliest block when that transaction can be added to the block chain" class="auto-link">locktime</a>. This is the <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a> transaction. Bob can’t sign the <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a> transaction by himself, so he gives
it to Alice to sign, as shown in the
illustration below.</p>

  <p><img src="/img/dev/en-micropayment-channel.svg" alt="Micropayment Channel Example" /></p>

  <p>Alice checks that the <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a> transaction’s <a href="/en/developer-guide#term-locktime" title="Part of a transaction which indicates the earliest time or earliest block when that transaction can be added to the block chain" class="auto-link">locktime</a> is 24 hours in the
future, signs it, and gives a copy of it back to Bob. She then asks Bob
for the bond transaction and checks that the <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a> transaction spends
the <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> of the bond transaction. She can now <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcast</a> the bond
transaction to the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> to ensure Bob has to wait for the time lock
to expire before further spending his <a href="/en/developer-guide#term-millibits" title="0.001 bitcoins (100,000 satoshis)" class="auto-link">millibits</a>. Bob hasn’t actually
spent anything so far, except possibly a small <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fee</a>, and
he’ll be able to <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcast</a> the <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a> transaction in 24 hours for a
full <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a>.</p>

  <p>Now, when Alice does some work worth 1 <a href="/en/developer-guide#term-millibits" title="0.001 bitcoins (100,000 satoshis)" class="auto-link">millibit</a>, she asks Bob to create
and sign a new version of the <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a> transaction.  Version two of the
transaction spends 1 <a href="/en/developer-guide#term-millibits" title="0.001 bitcoins (100,000 satoshis)" class="auto-link">millibit</a> to Alice and the other 99 back to Bob; it does
not have a <a href="/en/developer-guide#term-locktime" title="Part of a transaction which indicates the earliest time or earliest block when that transaction can be added to the block chain" class="auto-link">locktime</a>, so Alice can sign it and spend it whenever she
wants.  (But she doesn’t do that immediately.)</p>

  <p>Alice and Bob repeat these work-and-pay steps until Alice finishes for
the day, or until the time lock is about to expire.  Alice signs the
final version of the <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a> transaction and <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcasts</a> it, paying
herself and refunding any remaining balance to Bob.  The next day, when
Alice starts work, they create a new <a href="/en/developer-guide#term-micropayment-channel" class="auto-link">micropayment channel</a>.</p>

  <p>If Alice fails to <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcast</a> a version of the <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a> transaction before
its time lock expires, Bob can <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcast</a> the first version and receive a
full <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a>. This is one reason <a href="/en/developer-guide#term-micropayment-channel" class="auto-link">micropayment channels</a> are best suited to
small payments—if Alice’s Internet service goes out for a few hours
near the time lock expiry, she could be cheated out of her payment.</p>

  <p><a href="/en/developer-guide#transaction-malleability" title="The ability of an attacker to change the transaction identifier (txid) of unconfirmed transactions, making dependent transactions invalid" class="auto-link">Transaction malleability</a>, discussed above in the Transactions section,
is another reason to limit the value of <a href="/en/developer-guide#term-micropayment-channel" class="auto-link">micropayment channels</a>.
If someone uses <a href="/en/developer-guide#transaction-malleability" title="The ability of an attacker to change the transaction identifier (txid) of unconfirmed transactions, making dependent transactions invalid" class="auto-link">transaction malleability</a> to break the link between the
two transactions, Alice could hold Bob’s 100 <a href="/en/developer-guide#term-millibits" title="0.001 bitcoins (100,000 satoshis)" class="auto-link">millibits</a> hostage even if she
hadn’t done any work.</p>

  <p>For larger payments, Bitcoin <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fees</a> are very low as a
percentage of the total transaction value, so it makes more sense to
protect payments with immediately-<a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcast</a> separate transactions.</p>

  <p><strong>Resource:</strong> The <a href="http://bitcoinj.org">bitcoinj</a> Java library
provides a complete set of micropayment functions, an example
implementation, and <a href="https://bitcoinj.github.io/working-with-micropayments">a
tutorial</a>
all under an Apache license.</p>

  <h3 id="coinjoin">CoinJoin</h3>

  <p>Alice is concerned about her privacy.  She knows every transaction gets
added to the public <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>, so when Bob and Charlie pay her, they
can each easily track those <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> to learn what Bitcoin
<a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a> she pays, how much she pays them, and possibly how many
<a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> she has left.</p>

  <p>Alice isn’t a criminal, she just wants plausible deniability about
where she has spent her <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> and how many she has left, so she
starts up the Tor anonymity service on her computer and logs into an
IRC chatroom as “AnonGirl.”</p>

  <p>Also in the chatroom are “Nemo” and “Neminem.”  They collectively
agree to transfer <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> between each other so no one besides them
can reliably determine who controls which <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>.  But they’re faced
with a dilemma: who transfers their <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> to one of the other two
pseudonymous persons first? The CoinJoin-style contract, shown in the
illustration below, makes this decision easy: they create a single
transaction which does all of the spending simultaneously, ensuring none
of them can steal the others’ <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>.</p>

  <p><img src="/img/dev/en-coinjoin.svg" alt="Example CoinJoin Transaction" /></p>

  <p>Each contributor looks through their collection of Unspent Transaction
<a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">Outputs</a> (<a href="/en/developer-guide#term-utxo" title="Unspent Transaction Output (UTXO) holding satoshis which have not yet been spent" class="auto-link">UTXOs</a>) for 100 <a href="/en/developer-guide#term-millibits" title="0.001 bitcoins (100,000 satoshis)" class="auto-link">millibits</a> they can spend. They then each generate
a brand new <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> and give <a href="/en/developer-guide#term-utxo" title="Unspent Transaction Output (UTXO) holding satoshis which have not yet been spent" class="auto-link">UTXO</a> details and <a href="/en/developer-guide#term-pubkey-hash" title="The hash of a public key which can be included in a P2PKH output" class="auto-link">pubkey hashes</a> to the
facilitator.  In this case, the facilitator is AnonGirl; she creates
a transaction spending each of the <a href="/en/developer-guide#term-utxo" title="Unspent Transaction Output (UTXO) holding satoshis which have not yet been spent" class="auto-link">UTXOs</a> to three equally-sized <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a>.
One <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> goes to each of the contributors’ <a href="/en/developer-guide#term-pubkey-hash" title="The hash of a public key which can be included in a P2PKH output" class="auto-link">pubkey hashes</a>.</p>

  <p>AnonGirl then signs her <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">inputs</a> using <a href="/en/developer-guide#term-sighash-all" title="Default signature hash type which signs the entire transaction except any scriptSigs, preventing modification of the signed parts" class="auto-link"><code>SIGHASH_ALL</code></a> to ensure nobody can
change the <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> or <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> details.  She gives the partially-signed
transaction to Nemo who signs his <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">inputs</a> the same way and passes it
to Neminem, who also signs it the same way.  Neminem then <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcasts</a>
the transaction to the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">peer-to-peer network</a>, mixing all of the <a href="/en/developer-guide#term-millibits" title="0.001 bitcoins (100,000 satoshis)" class="auto-link">millibits</a> in
a single transaction.</p>

  <p>As you can see in the illustration, there’s no way for anyone besides
AnonGirl, Nemo, and Neminem to confidently determine who received
which <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a>, so they can each spend their <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> with plausible
deniability.</p>

  <p>Now when Bob or Charlie try to track Alice’s transactions through the
<a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>, they’ll also see transactions made by Nemo and
Neminem.  If Alice does a few more CoinJoins, Bob and Charlie might
have to guess which transactions made by dozens or hundreds of people
were actually made by Alice.</p>

  <p>The complete history of Alice’s <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> is still in the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>,
so a determined investigator could talk to the people AnonGirl
CoinJoined with to find out the ultimate origin of her <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> and
possibly reveal AnonGirl as Alice. But against anyone casually browsing
<a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> history, Alice gains plausible deniability.</p>

  <p>The CoinJoin technique described above costs the participants a small
amount of <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> to pay the <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fee</a>.  An alternative
technique, purchaser CoinJoin, can actually save them <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> and
improve their privacy at the same time.</p>

  <p>AnonGirl waits in the IRC chatroom until she wants to make a purchase.
She announces her intention to spend <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> and waits until someone
else wants to make a purchase, likely from a different merchant. Then
they combine their <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">inputs</a> the same way as before but set the <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a>
to the separate merchant <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a> so nobody will be able to figure
out solely from <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> history which one of them bought what from
the merchants.</p>

  <p>Since they would’ve had to pay a <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fee</a> to make their purchases
anyway, AnonGirl and her co-spenders don’t pay anything extra—but
because they reduced overhead by combining multiple transactions, saving
bytes, they may be able to pay a smaller aggregate <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fee</a>,
saving each one of them a tiny amount of <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>.</p>

  <p><strong>Resource:</strong> An alpha-quality (as of this writing) implementation of decentralized
CoinJoin is <a href="http://coinmux.com/">CoinMux</a>, available under the Apache
license.</p>

  <h2 id="wallets">Wallets</h2>

  <p>A Bitcoin <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> can refer to either a <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> program or a <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> file.
<a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">Wallet</a> programs create <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> to receive <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> and use the
corresponding <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a> to spend those <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>. <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">Wallet</a> files
store <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a> and (optionally) other information related to
transactions for the <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> program.</p>

  <p><a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">Wallet</a> programs and <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> files are addressed below in separate
subsections, and this document attempts to always make it clear whether
we’re talking about <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> programs or <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> files.</p>

  <h3 id="wallet-programs">Wallet Programs</h3>

  <p>Permitting receiving and spending of <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> is the only essential
feature of <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> software—but a particular <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> program doesn’t
need to do both things.  Two <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> programs can work together, one
program distributing <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> in order to receive <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> and
another program signing transactions spending those <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>.</p>

  <p><a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">Wallet</a> programs also need to interact with the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">peer-to-peer network</a> to
get information from the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> and to <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcast</a> new transactions.
However, the programs which distribute <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> or sign transactions
don’t need to interact with the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">peer-to-peer network</a> themselves.</p>

  <p>This leaves us with three necessary, but separable, parts of a <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>
system: a <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> distribution program, a signing program, and a
networked program.  In the subsections below, we will describe common
combinations of these parts.</p>

  <p>Note: we speak about distributing <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> generically. In many
cases, <a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a> or <a href="/en/developer-guide#term-p2sh" title="A script which Pays To Script Hashes (P2SH), allowing convenient spending of satoshis to an address referencing a script" class="auto-link">P2SH</a> hashes will be distributed instead of <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a>,
with the actual <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> only being distributed when the <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a>
they control are spent.</p>

  <h4 id="full-service-wallets">Full-Service Wallets</h4>

  <p>The simplest <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> is a program which performs all three functions: it
generates <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a>, derives the corresponding <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a>, helps
distribute those <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> as necessary, monitors for <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a> spent to
those <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a>, creates and signs transactions spending those
<a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a>, and <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcasts</a> the signed transactions.</p>

  <p><img src="/img/dev/en-wallets-full-service.svg" alt="Full-Service Wallets" /></p>

  <p>As of this writing, almost all popular <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a> can be used as
full-service <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a>.</p>

  <p>The main advantage of full-service <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a> is that they are easy to use.
A single program does everything the user needs to receive and spend
<a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>.</p>

  <p>The main disadvantage of full-service <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a> is that they store the
<a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a> on a device connected to the Internet.  The compromise of
such devices is a common occurrence, and an Internet connection makes it
easy to transmit <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a> from a compromised device to an attacker.</p>

  <p>To help protect against theft, many <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> programs offer users the
option of encrypting the <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> files which contain the <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a>.
This protects the <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a> when they aren’t being used, but it
cannot protect against an attack designed to capture the encryption
key or to read the decrypted keys from memory.</p>

  <h4 id="signing-only-wallets">Signing-Only Wallets</h4>

  <p>To increase security, <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a> can be generated and stored by a
separate <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> program operating in a more secure environment. These
signing-only <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a> work in conjunction with a networked <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> which
interacts with the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">peer-to-peer network</a>. </p>

  <p>Signing-only <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a> programs typically use deterministic key creation
(described in a later subsection) to create <a href="/en/developer-guide#term-parent-key" title="In HD wallets, a key capable of deriving child keys" class="auto-link">parent private and public
keys</a> which can create <a href="/en/developer-guide#term-child-key" title="In HD wallets, a key derived from a parent key" class="auto-link">child private and public keys</a>.</p>

  <p><img src="/img/dev/en-wallets-signing-only.svg" alt="Signing-Only Wallets" /></p>

  <p>When first run, the signing-only <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> creates a <a href="/en/developer-guide#term-parent-private-key" title="A private key which has created child private keys" class="auto-link">parent private key</a> and
transfers the corresponding <a href="/en/developer-guide#term-parent-public-key" title="A public key corresponding to a parent private key which has child private keys" class="auto-link">parent public key</a> to the networked <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>.</p>

  <p>The networked <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> uses the <a href="/en/developer-guide#term-parent-public-key" title="A public key corresponding to a parent private key which has child private keys" class="auto-link">parent public key</a> to derive <a href="/en/developer-guide#term-child-public-key" title="In HD wallets, a public key derived from a parent public key or a corresponding child private key" class="auto-link">child public
keys</a>, optionally helps distribute them, monitors for <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a> spent to
those <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a>, creates unsigned transactions spending those <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a>,
and transfers the unsigned transactions to the signing-only <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>.</p>

  <p>Often, users are given a chance to review the unsigned transactions’ details
(particularly the <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> details) using the signing-only <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>.  </p>

  <p>After the optional review step, the offline <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> uses the <a href="/en/developer-guide#term-parent-private-key" title="A private key which has created child private keys" class="auto-link">parent
private key</a> to derive the appropriate child <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a> and signs the
transactions, giving the signed transactions back to the networked <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>.</p>

  <p>The networked <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> then <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcasts</a> the signed transactions to the
<a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">peer-to-peer network</a>.</p>

  <p>The following subsections describe the two most common variants of
signing-only <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a>: offline <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a> and hardware <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a>.</p>

  <h5 id="offline-wallets">Offline Wallets</h5>

  <p>Several full-service <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a> programs will also operate as two separate
<a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a>: one program instance acting as a signing-only <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> (often called an
“offline <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>”) and the other program instance acting as the networked
<a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> (often called an “online <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>” or “watching-only <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>”).</p>

  <p>The offline <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> is so named because it is intended to be run on a
device which does not connect to any <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a>, greatly reducing the
number of attack vectors. If this is the case, it is usually up to the
user to handle all data transfer using removable media such as USB
drives.  The user’s workflow is something like:</p>

  <ol>
    <li>
      <p>(Offline) Disable all <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> connections on a device and install the <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>
software. Start the <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> software in offline mode to create the
<a href="/en/developer-guide#term-parent-key" title="In HD wallets, a key capable of deriving child keys" class="auto-link">parent private and public keys</a>.  Copy the <a href="/en/developer-guide#term-parent-public-key" title="A public key corresponding to a parent private key which has child private keys" class="auto-link">parent public key</a> to
removable media.</p>
    </li>
    <li>
      <p>(Online) Install the <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> software on another device, this one
connected to the Internet, and import the <a href="/en/developer-guide#term-parent-public-key" title="A public key corresponding to a parent private key which has child private keys" class="auto-link">parent public key</a> from the
removable media. As you would with a full-service <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>, distribute
<a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> to receive payment. When ready to spend <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>, fill in
the <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> details and save the unsigned transaction generated by the
<a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> to removable media.</p>
    </li>
    <li>
      <p>(Offline) Open the unsigned transaction in the offline instance,
review the <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> details to make sure they spend the correct
amount to the correct <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a>. This prevents malware on the online
<a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> from tricking the user into signing a transaction which pays
an attacker. After review, sign the transaction and save it to
removable media.</p>
    </li>
    <li>
      <p>(Online) Open the signed transaction in the online instance so it can
<a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcast</a> it to the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">peer-to-peer network</a>.</p>
    </li>
  </ol>

  <p>The primary advantage of offline <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a> is their possibility for
greatly improved security over full-service <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a>.  As long as the
offline <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> is not compromised (or flawed) and the user reviews all outgoing
transactions before signing, the user’s <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> are safe even if the
online <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> is compromised.</p>

  <p>The primary disadvantage of offline <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a> is hassle. For maximum
security, they require the user dedicate a device to only offline tasks.
The offline device must be booted up whenever funds are to be spent, and
the user must physically copy data from the online device to the offline
device and back.</p>

  <h5 id="hardware-wallets">Hardware Wallets</h5>

  <p>Hardware <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a> are devices dedicated to running a signing-only <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>.
Their dedication lets them eliminate many of the vulnerabilities
present in operating systems designed for general use, allowing them
to safely communicate directly with other devices so users don’t need to
transfer data manually.  The user’s workflow is something like:</p>

  <ol>
    <li>
      <p>(Hardware) Create <a href="/en/developer-guide#term-parent-key" title="In HD wallets, a key capable of deriving child keys" class="auto-link">parent private and public keys</a>. Connect hardware
<a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> to a networked device so it can get the <a href="/en/developer-guide#term-parent-public-key" title="A public key corresponding to a parent private key which has child private keys" class="auto-link">parent public key</a>.</p>
    </li>
    <li>
      <p>(Networked) As you would with a full-service <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>, distribute
<a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> to receive payment. When ready to spend <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>, fill in
the transaction details, connect the hardware <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>, and click
Spend.  The networked <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> will automatically send the transaction
details to the hardware <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>.</p>
    </li>
    <li>
      <p>(Hardware) Review the transaction details on the hardware <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet’s</a>
screen. Some hardware <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a> may prompt for a passphrase or PIN
number. The hardware <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> signs the transaction and uploads it to
the networked <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>.</p>
    </li>
    <li>
      <p>(Networked) The networked <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> receives the signed transaction from
the hardware <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> and <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcasts</a> it to the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a>.</p>
    </li>
  </ol>

  <p>The primary advantage of hardware <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a> is their possibility for
greatly improved security over full-service <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a> with much less
hassle than offline <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a>.</p>

  <p>The primary disadvantage of hardware <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a> is their hassle. Even
though the hassle is less than that of offline <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a>, the user must
still purchase a hardware <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> device and carry it with them whenever
they need to make a transaction using the signing-only <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>.</p>

  <p>An additional (hopefully temporary) disadvantage is that, as of this
writing, very few popular <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> programs support hardware
<a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a>—although almost all popular <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> programs have announced
their intention to support at least one model of hardware <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>.</p>

  <h4 id="distributing-only-wallets">Distributing-Only Wallets</h4>

  <p><a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">Wallet</a> programs which run in difficult-to-secure environments, such as
webservers, can be designed to distribute <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> (including <a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a>
or <a href="/en/developer-guide#term-p2sh" title="A script which Pays To Script Hashes (P2SH), allowing convenient spending of satoshis to an address referencing a script" class="auto-link">P2SH</a> <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a>) and nothing more.  There are two common ways to
design these minimalist <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a>:</p>

  <p><img src="/img/dev/en-wallets-distributing-only.svg" alt="Distributing-Only Wallets" /></p>

  <ul>
    <li>
      <p>Pre-populate a database with a number of <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> or <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a>, and
then distribute on request an <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> or <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a> using one of
the database entries. To <a href="/en/developer-guide#avoiding-key-reuse">avoid key reuse</a>, webservers should keep track
of used keys and never run out of <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a>. This can be made easier
by using parent <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> as suggested in the next method.</p>
    </li>
    <li>
      <p>Use a <a href="/en/developer-guide#term-parent-public-key" title="A public key corresponding to a parent private key which has child private keys" class="auto-link">parent public key</a> to create <a href="/en/developer-guide#term-child-public-key" title="In HD wallets, a public key derived from a parent public key or a corresponding child private key" class="auto-link">child public keys</a>. To avoid key
reuse, a method must be used to ensure the same <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> isn’t
distributed twice. This can be a database entry for each key
distributed or an incrementing pointer to the current child <a href="/en/developer-guide#term-key-index" title="An index number used in the HD wallet formula to generate child keys from a parent key" class="auto-link">key
index</a> number.</p>
    </li>
  </ul>

  <p>Neither method adds a significant amount of overhead, especially if a
database is used anyway to associate each incoming payment with a
separate <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> for payment tracking. See the <a href="/en/developer-guide#payment-processing">Payment
Processing</a> section for details.</p>

  <h3 id="wallet-files">Wallet Files</h3>

  <p>Bitcoin <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a> at their core are a collection of <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a>. These
collections are stored digitally in a file, or can even be physically
stored on pieces of paper.</p>

  <h4 id="private-key-formats">Private Key Formats</h4>

  <p><a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">Private keys</a> are what are used to unlock <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> from a particular <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a>. In Bitcoin, a <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a> in standard format is simply a 256-bit number, between the values:</p>

  <p>0x1 and 0xFFFF FFFF FFFF FFFF FFFF FFFF FFFF FFFE BAAE DCE6 AF48 A03B BFD2 5E8C D036 4141, representing nearly the entire range of 2<sup>256</sup>-1 values. The range is governed by the <a href="http://www.secg.org/index.php?action=secg,docs_secg" class="auto-link">secp256k1</a> <a href="https://en.wikipedia.org/wiki/Elliptic_Curve_DSA" class="auto-link">ECDSA</a> encryption standard used by Bitcoin. </p>

  <h5 id="wallet-import-format-wif">Wallet Import Format (WIF)</h5>

  <p>In order to make copying of <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a> less prone to error, <a href="/en/developer-guide#term-wallet-import-format" title="A private key specially formatted to allow easy import into a wallet" id="term-wallet-import-format" class="term">Wallet Import Format</a> may be utilized. WIF uses <a href="/en/developer-reference#term-base58check" title="The method used in Bitcoin for converting 160-bit hashes into Bitcoin addresses" class="auto-link">base58Check</a> encoding on an <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a>, greatly decreasing the chance of copying error, much like standard Bitcoin <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a>.</p>

  <ol>
    <li>
      <p>Take a <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a>.</p>
    </li>
    <li>
      <p>Add a 0x80 byte in front of it for <a href="/en/developer-examples#term-mainnet" title="The Bitcoin main network used to transfer satoshis (compare to testnet, the test network)" class="auto-link">mainnet</a> <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a> or 0xef for <a href="/en/developer-examples#testnet" title="A Bitcoin-like network where the satoshis have no real-world value to allow risk-free testing" class="auto-link">testnet</a> <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a>.</p>
    </li>
    <li>
      <p>Append a 0x01 byte after it if it should be used with compressed
<a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> (described in a later subsection). Nothing is appended if
it is used with uncompressed <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a>.</p>
    </li>
    <li>
      <p>Perform a SHA-256 hash on the extended key.</p>
    </li>
    <li>
      <p>Perform a SHA-256 hash on result of SHA-256 hash.</p>
    </li>
    <li>
      <p>Take the first four bytes of the second SHA-256 hash; this is the checksum.</p>
    </li>
    <li>
      <p>Add the four checksum bytes from point 5 at the end of the extended key from point 2.</p>
    </li>
    <li>
      <p>Convert the result from a byte string into a <a href="/en/developer-reference#term-base58check" title="The method used in Bitcoin for converting 160-bit hashes into Bitcoin addresses" class="auto-link">Base58</a> string using <a href="/en/developer-reference#term-base58check" title="The method used in Bitcoin for converting 160-bit hashes into Bitcoin addresses" class="auto-link">Base58Check</a> encoding.</p>
    </li>
  </ol>

  <p>The process is easily reversible, using the <a href="/en/developer-reference#term-base58check" title="The method used in Bitcoin for converting 160-bit hashes into Bitcoin addresses" class="auto-link">Base58</a> decoding function, and removing the padding.</p>

  <h5 id="mini-private-key-format">Mini Private Key Format</h5>

  <p>Mini <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a> format is a method for encoding a <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a> in under 30 characters, enabling keys to be embedded in a small physical space, such as physical bitcoin tokens, and more damage-resistant QR codes. </p>

  <ol>
    <li>
      <p>The first character of mini keys is ‘S’. </p>
    </li>
    <li>
      <p>In order to determine if a mini <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a> is well-formatted, a question mark is added to the <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a>.</p>
    </li>
    <li>
      <p>The SHA256 hash is calculated. If the first byte produced is a `00’, it is well-formatted. This key restriction acts as a typo-checking mechanism. A user brute forces the process using random numbers until a well-formatted mini <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a> is produced. </p>
    </li>
    <li>
      <p>In order to derive the full <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a>, the user simply takes a single SHA256 hash of the original mini <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a>. This process is one-way: it is intractable to compute the mini <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a> format from the derived key.</p>
    </li>
  </ol>

  <p>Many implementations disallow the character ‘1’ in the mini <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a> due to its visual similarity to ‘l’.</p>

  <p><strong>Resource:</strong> A common tool to create and redeem these keys is the <a href="https://github.com/casascius/Bitcoin-Address-Utility">Casascius Bitcoin Address Utility</a>.</p>

  <h4 id="public-key-formats">Public Key Formats</h4>

  <p>Bitcoin <a href="https://en.wikipedia.org/wiki/Elliptic_Curve_DSA" class="auto-link">ECDSA</a> <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> represent a point on a particular Elliptic
Curve (EC) defined in <a href="http://www.secg.org/index.php?action=secg,docs_secg" class="auto-link">secp256k1</a>. In their traditional uncompressed form,
<a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> contain an identification byte, a 32-byte X coordinate, and
a 32-byte Y coordinate. The extremely simplified illustration below
shows such a point on the elliptic curve used by Bitcoin,
x<sup>2</sup> = y<sup>3</sup> + 7, over a field of
contiguous numbers.</p>

  <p><img src="/img/dev/en-ecdsa-compressed-public-key.svg" alt="Point On ECDSA Curve" /></p>

  <p>(<a href="http://www.secg.org/index.php?action=secg,docs_secg" class="auto-link">Secp256k1</a> actually modulos coordinates by a large prime, which produces a
field of non-contiguous integers and a significantly less clear plot,
although the principles are the same.)</p>

  <p>An almost 50% reduction in <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> size can be realized without
changing any fundamentals by dropping the Y coordinate. This is possible
because only two points along the curve share any particular X
coordinate, so the 32-byte Y coordinate can be replaced with a single
bit indicating whether the point is on what appears in the illustration
as the “top” side or the “bottom” side.</p>

  <p>No data is lost by creating these compressed <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a>—only a small
amount of CPU is necessary to reconstruct the Y coordinate and access
the uncompressed <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a>. Both uncompressed and compressed <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public
keys</a> are described in official <a href="http://www.secg.org/index.php?action=secg,docs_secg" class="auto-link">secp256k1</a> documentation and supported by
default in the widely-used OpenSSL library.</p>

  <p>Because they’re easy to use, and because they reduce almost by half
the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> space used to store <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> for every spent <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a>,
compressed <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> are the default in Bitcoin Core and are the
recommended default for all Bitcoin software.</p>

  <p>However, Bitcoin Core prior to 0.6 used uncompressed keys.  This creates
a few complications, as the hashed form of an uncompressed key is
different than the hashed form of a compressed key, so the same key
works with two different <a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a> <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a>.   This also means that the key
must be submitted in the correct format in the <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> <a href="/en/developer-guide#term-scriptsig" title="Data generated by a spender which is almost always used as variables to satisfy an output script" class="auto-link">scriptSig</a> so it
matches the hash in the previous <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a>.</p>

  <p>For this reason, Bitcoin Core uses several different identifier bytes to
help programs identify how keys should be used:</p>

  <ul>
    <li>
      <p><a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">Private keys</a> meant to be used with compressed <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> have 0x01
appended to them before being <a href="/en/developer-reference#term-base58check" title="The method used in Bitcoin for converting 160-bit hashes into Bitcoin addresses" class="auto-link">Base-58</a> encoded. (See the <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a>
encoding section above.)</p>
    </li>
    <li>
      <p>Uncompressed <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> start with 0x04; compressed <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> begin
with 0x03 or 0x02 depending on whether they’re greater or less than
the midpoint of the curve.  These prefix bytes are all used in
official <a href="http://www.secg.org/index.php?action=secg,docs_secg" class="auto-link">secp256k1</a> documentation.</p>
    </li>
  </ul>

  <h4 id="hierarchical-deterministic-key-creation">Hierarchical Deterministic Key Creation</h4>

  <!-- 
For consistent word ordering:
[normal|hardened|] [master|parent|child|grandchild] [extended|non-extended|] [private|public|chain] [key|code]
-->

  <p>The hierarchical deterministic key creation and transfer protocol (<a href="/en/developer-guide#term-hd-protocol" title="The Hierarchical Deterministic (HD) key creation and transfer protocol" id="term-hd-protocol" class="term">HD
protocol</a>) greatly simplifies <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>
backups, eliminates the need for repeated communication between multiple
programs using the same <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>, permits creation of child accounts which
can operate independently, gives each parent account the ability to
monitor or control its children even if the child account is
compromised, and divides each account into full-access and
restricted-access parts so untrusted users or programs can be allowed to
receive or monitor payments without being able to spend them.</p>

  <p>The <a href="/en/developer-guide#term-hd-protocol" title="The Hierarchical Deterministic (HD) key creation and transfer protocol" class="auto-link">HD protocol</a> takes advantage of the <a href="https://en.wikipedia.org/wiki/Elliptic_Curve_DSA" class="auto-link">ECDSA</a> <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> creation
function, <a href="/en/developer-guide#term-point-function" title="The ECDSA function used to create a public key from a private key" id="term-point-function" class="term"><code>point()</code></a>,
which takes a large integer (the <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a>) and turns it into a graph
point (the <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a>):</p>

  <pre><code>point(private_key) == public_key
</code></pre>

  <p>Because of the way <a href="/en/developer-guide#term-point-function" title="The ECDSA function used to create a public key from a private key" class="auto-link"><code>point()</code></a> functions, it’s possible to create a <a href="/en/developer-guide#term-child-public-key" title="In HD wallets, a public key derived from a parent public key or a corresponding child private key" id="term-child-public-key" class="term">child
public key</a> by combining an
existing <a href="/en/developer-guide#term-parent-public-key" title="A public key corresponding to a parent private key which has child private keys" id="term-parent-public-key" class="term">(parent) public key</a> with another <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> created from any
integer (<em>i</em>) value. This <a href="/en/developer-guide#term-child-public-key" title="In HD wallets, a public key derived from a parent public key or a corresponding child private key" class="auto-link">child public key</a> is the same <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> which
would be created by the <a href="/en/developer-guide#term-point-function" title="The ECDSA function used to create a public key from a private key" class="auto-link"><code>point()</code></a> function if you added the <em>i</em> value to
the original (parent) <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a> and then found the remainder of that
sum divided by a global constant used by all Bitcoin software (<em>G</em>):</p>

  <pre><code>point( (parent_private_key + i) % G ) == parent_public_key + point(i)
</code></pre>

  <p>This means that two or more independent programs which agree on a
sequence of integers can create a series of unique <a href="/en/developer-guide#term-child-key" title="In HD wallets, a key derived from a parent key" id="term-child-key" class="term">child key</a> pairs from
a single <a href="/en/developer-guide#term-parent-key" title="In HD wallets, a key capable of deriving child keys" id="term-parent-key" class="term">parent key</a> pair without any further communication.
Moreover, the program which distributes new <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> for receiving
payment can do so without any access to the <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a>, allowing the
<a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> distribution program to run on a possibly-insecure platform such as
a public web server.</p>

  <p><a href="/en/developer-guide#term-child-public-key" title="In HD wallets, a public key derived from a parent public key or a corresponding child private key" class="auto-link">Child public keys</a> can also create their own <a href="/en/developer-guide#term-child-public-key" title="In HD wallets, a public key derived from a parent public key or a corresponding child private key" class="auto-link">child public keys</a>
(grandchild <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a>) by repeating the <a href="/en/developer-guide#term-child-key" title="In HD wallets, a key derived from a parent key" class="auto-link">child key</a> derivation
operations:</p>

  <pre><code>point( (child_private_key + i) % G ) == child_public_key + point(i)
</code></pre>

  <p>Whether creating <a href="/en/developer-guide#term-child-public-key" title="In HD wallets, a public key derived from a parent public key or a corresponding child private key" class="auto-link">child public keys</a> or further-descended <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a>, a
predictable sequence of integer values would be no better than using a
single <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> for all transactions, as anyone who knew one <a href="/en/developer-guide#term-child-public-key" title="In HD wallets, a public key derived from a parent public key or a corresponding child private key" class="auto-link">child
public key</a> could find all of the other <a href="/en/developer-guide#term-child-public-key" title="In HD wallets, a public key derived from a parent public key or a corresponding child private key" class="auto-link">child public keys</a> created from
the same <a href="/en/developer-guide#term-parent-public-key" title="A public key corresponding to a parent private key which has child private keys" class="auto-link">parent public key</a>. Instead, a random seed can be used to
deterministically generate the sequence of integer values so that the
relationship between the <a href="/en/developer-guide#term-child-public-key" title="In HD wallets, a public key derived from a parent public key or a corresponding child private key" class="auto-link">child public keys</a> is invisible to anyone
without that seed.</p>

  <p>The <a href="/en/developer-guide#term-hd-protocol" title="The Hierarchical Deterministic (HD) key creation and transfer protocol" class="auto-link">HD protocol</a> uses a single <a href="/en/developer-guide#term-root-seed" title="A potentially-short value used as a seed to generate a master private key and master chain code for an HD wallet" class="auto-link">root seed</a> to create a hierarchy of
child, grandchild, and other descended keys with unlinkable
deterministically-generated integer values. Each <a href="/en/developer-guide#term-child-key" title="In HD wallets, a key derived from a parent key" class="auto-link">child key</a> also gets
a deterministically-generated seed from its parent, called a <a href="/en/developer-guide#term-chain-code" title="In HD wallets, 256 bits of entropy added to the master public and private keys to help them generate secure child keys; the chain code is usually derived from a seed along with the master private key" id="term-chain-code" class="term">chain
code</a>, so the compromising of one <a href="/en/developer-guide#term-chain-code" title="In HD wallets, 256 bits of entropy added to the master public and private keys to help them generate secure child keys; the chain code is usually derived from a seed along with the master private key" class="auto-link">chain
code</a> doesn’t necessary compromise the integer sequence for the whole
hierarchy, allowing the <a href="/en/developer-guide#term-master-chain-code" title="The chain code derived from the root seed" id="term-master-chain-code" class="term">master chain
code</a> to continue being useful
even if, for example, a web-based <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> distribution program
gets hacked.</p>

  <p><img src="/img/dev/en-hd-overview.svg" alt="Overview Of Hierarchical Deterministic Key Derivation" /></p>

  <p>As illustrated above, HD key derivation takes four inputs:</p>

  <ul>
    <li>
      <p>The <em><a href="/en/developer-guide#term-parent-private-key" title="A private key which has created child private keys" id="term-parent-private-key" class="term">parent private key</a></em> and
<em><a href="/en/developer-guide#term-parent-public-key" title="A public key corresponding to a parent private key which has child private keys" class="auto-link">parent public key</a></em> are regular uncompressed 256-bit <a href="https://en.wikipedia.org/wiki/Elliptic_Curve_DSA" class="auto-link">ECDSA</a> keys.</p>
    </li>
    <li>
      <p>The <a href="/en/developer-guide#term-parent-chain-code" title="A chain code which has helped create child public or private keys" id="term-parent-chain-code" class="term">parent chain code</a> is 256
bits of seemingly-random data.</p>
    </li>
    <li>
      <p>The <a href="/en/developer-guide#term-key-index" title="An index number used in the HD wallet formula to generate child keys from a parent key" id="term-key-index" class="term">index</a> number is a 32-bit integer specified by the program.</p>
    </li>
  </ul>

  <p>In the normal form shown in the above illustration, the <a href="/en/developer-guide#term-parent-chain-code" title="A chain code which has helped create child public or private keys" class="auto-link">parent chain
code</a>, the <a href="/en/developer-guide#term-parent-public-key" title="A public key corresponding to a parent private key which has child private keys" class="auto-link">parent public key</a>, and the index number are fed into a one-way cryptographic hash
(<a href="https://en.wikipedia.org/wiki/HMAC">HMAC-SHA512</a>) to produce 512 bits of
deterministically-generated-but-seemingly-random data. The
seemingly-random 256 bits on the righthand side of the hash <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> are
used as a new child <a href="/en/developer-guide#term-chain-code" title="In HD wallets, 256 bits of entropy added to the master public and private keys to help them generate secure child keys; the chain code is usually derived from a seed along with the master private key" class="auto-link">chain code</a>. The seemingly-random 256 bits on the
lefthand side of the hash <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> are used as the integer value to be combined
with either the <a href="/en/developer-guide#term-parent-private-key" title="A private key which has created child private keys" class="auto-link">parent private key</a> or <a href="/en/developer-guide#term-parent-public-key" title="A public key corresponding to a parent private key which has child private keys" class="auto-link">parent public key</a> to,
respectively, create either a child <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a> or <a href="/en/developer-guide#term-child-public-key" title="In HD wallets, a public key derived from a parent public key or a corresponding child private key" class="auto-link">child public key</a>:</p>

  <pre><code>point( (parent_private_key + lefthand_hash_output) % G ) == child_public_key
point(child_private_key) == parent_public_key + point(lefthand_hash_output)
</code></pre>

  <p>Specifying different index numbers will create different unlinkable
<a href="/en/developer-guide#term-child-key" title="In HD wallets, a key derived from a parent key" class="auto-link">child keys</a> from the same parent keys.  Repeating the procedure for the
<a href="/en/developer-guide#term-child-key" title="In HD wallets, a key derived from a parent key" class="auto-link">child keys</a> using the child <a href="/en/developer-guide#term-chain-code" title="In HD wallets, 256 bits of entropy added to the master public and private keys to help them generate secure child keys; the chain code is usually derived from a seed along with the master private key" class="auto-link">chain code</a> will create unlinkable grandchild keys.</p>

  <p>Because creating <a href="/en/developer-guide#term-child-key" title="In HD wallets, a key derived from a parent key" class="auto-link">child keys</a> requires both a key and a <a href="/en/developer-guide#term-chain-code" title="In HD wallets, 256 bits of entropy added to the master public and private keys to help them generate secure child keys; the chain code is usually derived from a seed along with the master private key" class="auto-link">chain code</a>, the
key and <a href="/en/developer-guide#term-chain-code" title="In HD wallets, 256 bits of entropy added to the master public and private keys to help them generate secure child keys; the chain code is usually derived from a seed along with the master private key" class="auto-link">chain code</a> together are called the <a href="/en/developer-guide#term-extended-key" title="A public or private key extended with the chain code to allow them to derive child keys" id="term-extended-key" class="term">extended
key</a>. An <a href="/en/developer-guide#term-extended-private-key" title="A private key extended with the chain code so that it can derive child private keys" id="term-extended-private-key" class="term">extended private
key</a> and its corresponding
<a href="/en/developer-guide#term-extended-public-key" title="A public key extended with the chain code so that it can derive child public keys" id="term-extended-public-key" class="term">extended public key</a> have the
same <a href="/en/developer-guide#term-chain-code" title="In HD wallets, 256 bits of entropy added to the master public and private keys to help them generate secure child keys; the chain code is usually derived from a seed along with the master private key" class="auto-link">chain code</a>. The (top-level parent) <a href="/en/developer-guide#term-master-private-key" title="A private key derived from the root seed" id="term-master-private-key" class="term">master private
key</a> and <a href="/en/developer-guide#term-master-chain-code" title="The chain code derived from the root seed" class="auto-link">master chain
code</a> are derived from random data,
as illustrated below.</p>

  <p><img src="/img/dev/en-hd-root-keys.svg" alt="Creating A Root Extended Key Pair" /></p>

  <p>A <a href="/en/developer-guide#term-root-seed" title="A potentially-short value used as a seed to generate a master private key and master chain code for an HD wallet" id="term-root-seed" class="term">root seed</a> is created from either 128
bits, 256 bits, or 512 bits of random data. This <a href="/en/developer-guide#term-root-seed" title="A potentially-short value used as a seed to generate a master private key and master chain code for an HD wallet" class="auto-link">root seed</a> of as little
as 128 bits is the the only data the user needs to backup in order to
derive every key created by a particular <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> program using
particular settings.</p>

  <p><img src="/img/icon_warning.svg" alt="Warning icon" />
 <strong>Warning:</strong> As of this writing, HD <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> programs are not expected to
be fully compatible, so users must only use the same HD <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> program
with the same HD-related settings for a particular <a href="/en/developer-guide#term-root-seed" title="A potentially-short value used as a seed to generate a master private key and master chain code for an HD wallet" class="auto-link">root seed</a>.</p>

  <p>The <a href="/en/developer-guide#term-root-seed" title="A potentially-short value used as a seed to generate a master private key and master chain code for an HD wallet" class="auto-link">root seed</a> is hashed to create 512 bits of seemingly-random data,
from which the <a href="/en/developer-guide#term-master-private-key" title="A private key derived from the root seed" class="auto-link">master private key</a> and <a href="/en/developer-guide#term-master-chain-code" title="The chain code derived from the root seed" class="auto-link">master chain code</a> are created
(together, the master <a href="/en/developer-guide#term-extended-private-key" title="A private key extended with the chain code so that it can derive child private keys" class="auto-link">extended private key</a>). The master <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> is
derived from the <a href="/en/developer-guide#term-master-private-key" title="A private key derived from the root seed" class="auto-link">master private key</a> using <a href="/en/developer-guide#term-point-function" title="The ECDSA function used to create a public key from a private key" class="auto-link"><code>point()</code></a>, which, together
with the <a href="/en/developer-guide#term-master-chain-code" title="The chain code derived from the root seed" class="auto-link">master chain code</a>, is the master <a href="/en/developer-guide#term-extended-public-key" title="A public key extended with the chain code so that it can derive child public keys" class="auto-link">extended public
key</a>. The master <a href="/en/developer-guide#term-extended-key" title="A public or private key extended with the chain code to allow them to derive child keys" class="auto-link">extended keys</a> are functionally equivalent to other
<a href="/en/developer-guide#term-extended-key" title="A public or private key extended with the chain code to allow them to derive child keys" class="auto-link">extended keys</a>; it is only their location at the top of the hierarchy
which makes them special.</p>

  <h5 id="hardened-keys">Hardened Keys</h5>

  <p>Hardened <a href="/en/developer-guide#term-extended-key" title="A public or private key extended with the chain code to allow them to derive child keys" class="auto-link">extended keys</a> fix a potential problem with normal <a href="/en/developer-guide#term-extended-key" title="A public or private key extended with the chain code to allow them to derive child keys" class="auto-link">extended keys</a>.
If an attacker gets a normal <a href="/en/developer-guide#term-parent-chain-code" title="A chain code which has helped create child public or private keys" class="auto-link">parent
chain code</a> and <a href="/en/developer-guide#term-parent-public-key" title="A public key corresponding to a parent private key which has child private keys" class="auto-link">parent public key</a>, he can brute-force all chain
codes deriving from it. If the attacker also obtains a child, grandchild, or
further-descended <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a>, he can use the <a href="/en/developer-guide#term-chain-code" title="In HD wallets, 256 bits of entropy added to the master public and private keys to help them generate secure child keys; the chain code is usually derived from a seed along with the master private key" class="auto-link">chain code</a> to generate all
of the extended <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a> descending from that <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a>, as
shown in the grandchild and great-grandchild generations of the illustration below.</p>

  <p><img src="/img/dev/en-hd-cross-generational-key-compromise.svg" alt="Cross-Generational Key Compromise" /></p>

  <p>Perhaps worse, the attacker can reverse the normal child <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a>
derivation formula and subtract a <a href="/en/developer-guide#term-parent-chain-code" title="A chain code which has helped create child public or private keys" class="auto-link">parent chain code</a> from a child <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private
key</a> to recover the <a href="/en/developer-guide#term-parent-private-key" title="A private key which has created child private keys" class="auto-link">parent private key</a>, as shown in the child and
parent generations of the illustration above.  This means an attacker
who acquires an <a href="/en/developer-guide#term-extended-public-key" title="A public key extended with the chain code so that it can derive child public keys" class="auto-link">extended public key</a> and any <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a> descended from
it can recover that <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key’s</a> <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a> and all keys descended from
it.</p>

  <p>For this reason, the <a href="/en/developer-guide#term-chain-code" title="In HD wallets, 256 bits of entropy added to the master public and private keys to help them generate secure child keys; the chain code is usually derived from a seed along with the master private key" class="auto-link">chain code</a> part of an <a href="/en/developer-guide#term-extended-public-key" title="A public key extended with the chain code so that it can derive child public keys" class="auto-link">extended public key</a> should be
better secured than standard <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> and users should be advised
against exporting even non-extended <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a> to
possibly-untrustworthy environments.</p>

  <p>This can be fixed, with some tradeoffs, by replacing the the normal
key derivation formula with a hardened key derivation formula.</p>

  <p>The normal key derivation formula, described in the section above, combines
together the index number, the <a href="/en/developer-guide#term-parent-chain-code" title="A chain code which has helped create child public or private keys" class="auto-link">parent chain code</a>, and the <a href="/en/developer-guide#term-parent-public-key" title="A public key corresponding to a parent private key which has child private keys" class="auto-link">parent public key</a> to create the
child <a href="/en/developer-guide#term-chain-code" title="In HD wallets, 256 bits of entropy added to the master public and private keys to help them generate secure child keys; the chain code is usually derived from a seed along with the master private key" class="auto-link">chain code</a> and the integer value which is combined with the <a href="/en/developer-guide#term-parent-private-key" title="A private key which has created child private keys" class="auto-link">parent
private key</a> to create the child <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a>.</p>

  <p><img src="/img/dev/en-hd-private-parent-to-private-child.svg" alt="Creating Child Public Keys From An Extended Private Key" /></p>

  <p>The hardened formula, illustrated above, combines together the index
number, the <a href="/en/developer-guide#term-parent-chain-code" title="A chain code which has helped create child public or private keys" class="auto-link">parent chain code</a>, and the <a href="/en/developer-guide#term-parent-private-key" title="A private key which has created child private keys" class="auto-link">parent private key</a> to create
the data used to generate the child <a href="/en/developer-guide#term-chain-code" title="In HD wallets, 256 bits of entropy added to the master public and private keys to help them generate secure child keys; the chain code is usually derived from a seed along with the master private key" class="auto-link">chain code</a> and child <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a>.
This formula makes it impossible to create <a href="/en/developer-guide#term-child-public-key" title="In HD wallets, a public key derived from a parent public key or a corresponding child private key" class="auto-link">child public keys</a> without
knowing the <a href="/en/developer-guide#term-parent-private-key" title="A private key which has created child private keys" class="auto-link">parent private key</a>. In other words, parent extended <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public
keys</a> can’t create hardened <a href="/en/developer-guide#term-child-public-key" title="In HD wallets, a public key derived from a parent public key or a corresponding child private key" class="auto-link">child public keys</a>.</p>

  <p>Because of that, a <a href="/en/developer-guide#term-hardened-extended-private-key" title="A private key whose corresponding public key cannot derive child keys" id="term-hardened-extended-private-key" class="term">hardened extended private
key</a> is much less
useful than a normal <a href="/en/developer-guide#term-extended-private-key" title="A private key extended with the chain code so that it can derive child private keys" class="auto-link">extended private key</a>—however, 
hardened extended <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a> create a firewall through which
multi-level key derivation compromises cannot happen. Because hardened
child extended <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> cannot generate grandchild chain codes on
their own, the compromise of a parent <a href="/en/developer-guide#term-extended-public-key" title="A public key extended with the chain code so that it can derive child public keys" class="auto-link">extended public key</a> cannot be
combined with the compromise of a grandchild <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a> to create
great-grandchild extended <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a>.</p>

  <p>The <a href="/en/developer-guide#term-hd-protocol" title="The Hierarchical Deterministic (HD) key creation and transfer protocol" class="auto-link">HD protocol</a> uses different index numbers to indicate
whether a normal or hardened key should be generated. Index numbers from
0x00 to 0x7fffffff (0 to 2<sup>31</sup>-1) will generate a normal key; index
numbers from 0x80000000 to 0xffffffff will generate a hardened key. To
make descriptions easy, many developers use the <a href="https://en.wikipedia.org/wiki/Prime_%28symbol%29">prime symbol</a> to indicate
hardened keys, so the first normal key (0x00) is 0 and the first hardened
key (0x80000000) is 0´.</p>

  <p>(Bitcoin developers typically use the ASCII apostrophe rather than
the unicode prime symbol, a convention we will henceforth follow.)</p>

  <p>This compact description is further combined with slashes prefixed by
<em>m</em> or <em>M</em> to indicate hierarchy and key type, with <em>m</em> being a <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private
key</a> and <em>M</em> being a <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a>. For example, m/0’/0/122’ refers to the
123rd hardened private child (by index number) of the first normal child
(by index) of the first hardened child (by index) of the <a href="/en/developer-guide#term-master-private-key" title="A private key derived from the root seed" class="auto-link">master private
key</a>. The following hierarchy illustrates prime notation and hardened key
firewalls.</p>

  <p><img src="/img/dev/en-hd-tree.svg" alt="Example HD Wallet Tree Using Prime Notation" /></p>

  <p><a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">Wallets</a> following the <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" class="auto-link">BIP32</a> <a href="/en/developer-guide#term-hd-protocol" title="The Hierarchical Deterministic (HD) key creation and transfer protocol" class="auto-link">HD protocol</a> only create hardened children of
the <a href="/en/developer-guide#term-master-private-key" title="A private key derived from the root seed" class="auto-link">master private key</a> (<em>m</em>) to prevent a compromised <a href="/en/developer-guide#term-child-key" title="In HD wallets, a key derived from a parent key" class="auto-link">child key</a> from
compromising the master key. As there are no normal children for the
master keys, the master <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> is not used in HD <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a>. All other
keys can have normal children, so the corresponding extended <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a>
may be used instead.</p>

  <p>The <a href="/en/developer-guide#term-hd-protocol" title="The Hierarchical Deterministic (HD) key creation and transfer protocol" class="auto-link">HD protocol</a> also describes a serialization format for extended
<a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a> and extended <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a>.  For details, please see the
<a href="/en/developer-reference#wallets">wallet section in the developer reference</a> or <a href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki" class="auto-link">BIP32</a>
for the full <a href="/en/developer-guide#term-hd-protocol" title="The Hierarchical Deterministic (HD) key creation and transfer protocol" class="auto-link">HD protocol</a> specification.</p>

  <h5 id="storing-root-seeds">Storing Root Seeds</h5>

  <p>Root seeds in the <a href="/en/developer-guide#term-hd-protocol" title="The Hierarchical Deterministic (HD) key creation and transfer protocol" class="auto-link">HD protocol</a> are 128, 256, or 512 bits of random data
which must be backed up precisely. To make it more convenient to use
non-digital backup methods, such as memorization or hand-copying, <a href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki" class="auto-link">BIP39</a>
defines a method for creating a 512-bit <a href="/en/developer-guide#term-root-seed" title="A potentially-short value used as a seed to generate a master private key and master chain code for an HD wallet" class="auto-link">root seed</a> from a pseudo-sentence
(mnemonic) of common natural-language words which was itself created
from 128 to 256 bits of entropy and optionally protected by a password.</p>

  <p>The number of words generated correlates to the amount of entropy used:</p>

  <table>
    <thead>
      <tr>
        <th>Entropy Bits</th>
        <th>Words</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>128</td>
        <td>12</td>
      </tr>
      <tr>
        <td>160</td>
        <td>15</td>
      </tr>
      <tr>
        <td>192</td>
        <td>18</td>
      </tr>
      <tr>
        <td>224</td>
        <td>21</td>
      </tr>
      <tr>
        <td>256</td>
        <td>24</td>
      </tr>
    </tbody>
  </table>

  <p>The passphrase can be of any length.  It is simply appended to the mnemonic
pseudo-sentence, and then both the mnemonic and password are hashed
2,048 times using HMAC-SHA512, resulting in a seemingly-random 512-bit seed.  Because any
input to the hash function creates a seemingly-random 512-bit seed,
there is no fundamental way to prove the user entered the correct
password, possibly allowing the user to protect a seed even when under
duress.</p>

  <p>For implementation details, please see <a href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki" class="auto-link">BIP39</a>.</p>

  <h4 id="loose-key-wallets">Loose-Key Wallets</h4>

  <p>Loose-Key <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a>, also called “Just a Bunch Of Keys (JBOK)”, are a deprecated form of <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> that originated from the Bitcoin Core client <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>. The Bitcoin Core client <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> would create 100 <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a>/<a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> pairs automatically via a Pseudo-Random-Number Generator (PRNG) for later use.</p>

  <p>These unused <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a> are stored in a virtual “key pool”, with new
keys being generated whenever a previously-generated key was used,
ensuring the pool maintained 100 unused keys. (If the <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> is
encrypted, new keys are only generated while the <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> is unlocked.)</p>

  <p>This created considerable difficulty in backing up one’s keys, considering backups have to be run manually to save the newly-generated <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a>. If a new <a href="/en/developer-guide#term-key-pair" title="A private key and its derived public key" class="auto-link">key pair</a> set is generated, used, and then lost prior to a backup, the stored <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> are likely lost forever. Many older-style mobile <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a> followed a similar format, but only generated a new <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a> upon user demand.</p>

  <p>This <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> type is being actively phased out and discouraged from being used due to the backup hassle.</p>

  <h2 id="payment-processing">Payment Processing</h2>

  <p>Payment processing encompasses the steps spenders and receivers perform
to make and accept payments in exchange for products or services. The
basic steps have not changed since the dawn of commerce, but the
technology has. This section will explain how how receivers and spenders
can, respectively, request and make payments using Bitcoin—and how
they can deal with complications such as <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refunds</a> and <a href="/en/developer-guide#rebilling-recurring-payments" title="Billing a spender on a regular schedule" class="auto-link">recurrent
rebilling</a>.</p>

  <p>Bitcoin payment processing is being actively developed at the moment, so
each subsection below attempts to describe what’s widely deployed now,
what’s new, and what might be coming before the end of 2014.</p>

  <p><img src="/img/dev/en-payment-processing.svg" alt="Bitcoin Payment Processing" /></p>

  <p>The figure above illustrates payment processing using Bitcoin from a
receiver’s perspective, starting with a new order. The following
subsections will each address the three common steps and the three
occasional or optional steps.</p>

  <p>It is worth mentioning that each of these steps can be outsourced by
using third party APIs and services.</p>

  <h3 id="pricing-orders">Pricing Orders</h3>

  <p>Because of exchange rate variability between <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> and national
currencies (<a href="/en/developer-guide#term-fiat" title="National currencies such as the dollar or euro" id="term-fiat" class="term">fiat</a>), many Bitcoin orders are priced in <a href="/en/developer-guide#term-fiat" title="National currencies such as the dollar or euro" class="auto-link">fiat</a> but paid
in <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>, necessitating a price conversion.</p>

  <p>Exchange rate data is widely available through HTTP-based APIs provided
by currency exchanges. Several organizations also aggregate data from
multiple exchanges to create index prices, which are also available using
HTTP-based APIs.</p>

  <p>Any applications which automatically calculate order totals using exchange
rate data must take steps to ensure the price quoted reflects the
current general market value of <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>, or the applications could
accept too few <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> for the product or service being sold.
Alternatively, they could ask for too many <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>, driving away potential
spenders.</p>

  <p>To minimize problems, your applications may want to collect data from at
least two separate sources and compare them to see how much they differ.
If the difference is substantial, your applications can enter a safe mode
until a human is able to evaluate the situation.</p>

  <p>You may also want to program your applications to enter a safe mode if
exchange rates are rapidly increasing or decreasing, indicating a
possible problem in the Bitcoin market which could make it difficult to
spend any <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> received today.</p>

  <p>Exchange rates lie outside the control of Bitcoin and related
technologies, so there are no new or planned technologies which
will make it significantly easier for your program to correctly convert
order totals from <a href="/en/developer-guide#term-fiat" title="National currencies such as the dollar or euro" class="auto-link">fiat</a> into <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>.</p>

  <p>Because the exchange rate fluctuates over time, order totals pegged to
<a href="/en/developer-guide#term-fiat" title="National currencies such as the dollar or euro" class="auto-link">fiat</a> must expire to prevent spenders from delaying payment in the hope
that <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> will drop in price. Most widely-used payment processing
systems currently expire their invoices after 10 to 20 minutes.</p>

  <p>Shorter expiration periods increase the chance the invoice will expire
before payment is received, possibly necessitating manual intervention
to request an additional payment or to issue a <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a>.   Longer
expiration periods increase the chance that the exchange rate will
fluctuate a significant amount before payment is received.</p>

  <h3 id="requesting-payments">Requesting Payments</h3>

  <p>Before requesting payment, your application must create a Bitcoin
<a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a>, or acquire an <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a> from another program such as
Bitcoin Core.  Bitcoin <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a> are described in detail in the
<a href="#transactions">Transactions</a> section. Also described in that section
are two important reasons to <a href="#avoiding-key-reuse">avoid using an address more than
once</a>—but a third reason applies especially to
payment requests:</p>

  <p>Using a separate <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a> for each incoming payment makes it trivial to
determine which customers have paid their payment requests.  Your
applications need only track the association between a particular payment
request and the <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a> used in it, and then scan the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> for
transactions matching that <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a>.</p>

  <p>The next subsections will describe in detail the following four
compatible ways to give the spender the <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a> and amount to be paid.
For increased convenience and compatibility, providing all of these options in your
payment requests is recommended.</p>

  <ol>
    <li>
      <p>All <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> software lets its users paste in or manually enter an
<a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a> and amount into a payment screen. This is, of course,
inconvenient—but it makes an effective fallback option.</p>
    </li>
    <li>
      <p>Almost all desktop <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a> can associate with <a href="/en/developer-guide#term-bitcoin-uri" title="A URI which allows receivers to encode payment details so spenders don't have to manually enter addresses and other details" class="auto-link"><code>bitcoin:</code> URIs</a>, so
spenders can click a link to pre-fill the payment screen. This also
works with many mobile <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a>, but it generally does not work with
web-based <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a> unless the spender installs a browser extension or
manually configures a URI handler.</p>
    </li>
    <li>
      <p>Most mobile <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a> support scanning <a href="/en/developer-guide#term-bitcoin-uri" title="A URI which allows receivers to encode payment details so spenders don't have to manually enter addresses and other details" class="auto-link"><code>bitcoin:</code> URIs</a> encoded in a
QR code, and almost all <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a> can display them for
accepting payment. While also handy for online orders, QR Codes are
especially useful for in-person purchases.</p>
    </li>
    <li>
      <p>Recent <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> updates add support for the new <a href="/en/developer-guide#term-payment-protocol" title="The protocol defined in BIP70 which lets spenders get signed payment details from receivers" class="auto-link">payment protocol</a> providing
increased security, authentication of a receiver’s identity using <a href="https://en.wikipedia.org/wiki/X.509" class="auto-link">X.509</a> certificates,
and other important features such as <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refunds</a>.</p>
    </li>
  </ol>

  <p><img src="/img/icon_warning.svg" alt="Warning icon" />
 <strong>Warning:</strong> Special care must be taken to avoid the theft of incoming
payments. In particular, <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private keys</a> should not be stored on web servers,
and payment requests should be sent over HTTPS or other secure methods
to prevent man-in-the-middle attacks from replacing your Bitcoin <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a>
with the attacker’s <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a>.</p>

  <h4 id="plain-text">Plain Text</h4>

  <p>To specify an amount directly for copying and pasting, you must provide
the <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a>, the amount, and the <a href="/en/developer-guide#term-denomination" title="bitcoins (BTC), bitcents (cBTC), millibits (mBTC), microbits (uBTC), or satoshis" class="auto-link">denomination</a>. An expiration time for
the offer may also be specified.  For example:</p>

  <p>(Note: all examples in this section use <a href="/en/developer-examples#testnet" title="A Bitcoin-like network where the satoshis have no real-world value to allow risk-free testing" class="auto-link">Testnet</a> <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a>.)</p>

  <pre><code>Pay: mjSk1Ny9spzU2fouzYgLqGUD8U41iR35QN
Amount: 100 BTC
You must pay by: 2014-04-01 at 23:00 UTC
</code></pre>

  <p>Indicating the <a href="/en/developer-guide#term-denomination" title="bitcoins (BTC), bitcents (cBTC), millibits (mBTC), microbits (uBTC), or satoshis" id="term-denomination" class="term">denomination</a> is critical. As of this writing, all popular
Bitcoin <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> software defaults to denominating amounts in either <a href="/en/developer-guide#term-bitcoins" title="A primary accounting unit used in Bitcoin; 100 million satoshis" id="term-bitcoins" class="term">bitcoins</a> (BTC)
or <a href="/en/developer-guide#term-millibits" title="0.001 bitcoins (100,000 satoshis)" id="term-millibits" class="term">millibits</a> (mBTC). Choosing between BTC and mBTC is widely supported,
but other software also lets its users select <a href="/en/developer-guide#term-denomination" title="bitcoins (BTC), bitcents (cBTC), millibits (mBTC), microbits (uBTC), or satoshis" class="auto-link">denomination</a> amounts from
some or all of the following options:</p>

  <table>
    <thead>
      <tr>
        <th><a href="/en/developer-guide#term-bitcoins" title="A primary accounting unit used in Bitcoin; 100 million satoshis" class="auto-link">Bitcoins</a></th>
        <th>Unit (Abbreviation)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>1.0</td>
        <td>bitcoin (BTC)</td>
      </tr>
      <tr>
        <td>0.01</td>
        <td>bitcent (cBTC)</td>
      </tr>
      <tr>
        <td>0.001</td>
        <td><a href="/en/developer-guide#term-millibits" title="0.001 bitcoins (100,000 satoshis)" class="auto-link">millibit</a> (mBTC)</td>
      </tr>
      <tr>
        <td>0.000001</td>
        <td>microbit (uBTC)</td>
      </tr>
      <tr>
        <td>0.00000001</td>
        <td><a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" id="term-satoshi" class="term">satoshi</a></td>
      </tr>
    </tbody>
  </table>

  <h4 id="bitcoin-uri">bitcoin: URI</h4>

  <p>The <a href="/en/developer-guide#term-bitcoin-uri" title="A URI which allows receivers to encode payment details so spenders don't have to manually enter addresses and other details" id="term-bitcoin-uri" class="term"><code>bitcoin:</code> URI</a> scheme defined in <a href="https://github.com/bitcoin/bips/blob/master/bip-0021.mediawiki" class="auto-link">BIP21</a> eliminates <a href="/en/developer-guide#term-denomination" title="bitcoins (BTC), bitcents (cBTC), millibits (mBTC), microbits (uBTC), or satoshis" class="auto-link">denomination</a>
confusion and saves the spender from copying and pasting two separate
values. It also lets the payment request provide some additional
information to the spender. An example:</p>

  <pre><code>bitcoin:mjSk1Ny9spzU2fouzYgLqGUD8U41iR35QN?amount=100
</code></pre>

  <p>Only the <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a> is required, and if it is the only thing
specified, <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a> will pre-fill a payment request with it and let
the spender enter an amount. The amount specified is always in
decimal <a href="/en/developer-guide#term-bitcoins" title="A primary accounting unit used in Bitcoin; 100 million satoshis" class="auto-link">bitcoins</a> (BTC).</p>

  <p>Two other parameters are widely supported. The
<a href="/en/developer-guide#term-label" title="The label parameter of a bitcoin: URI which provides the spender with the receiver's name (unauthenticated)" id="term-label" class="term"><code>label</code></a> parameter is generally used to
provide <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> software with the recipient’s name. The
<a href="/en/developer-guide#term-message" title="A parameter of bitcoin: URIs which allows the receiver to optionally specify a message to the spender" id="term-message" class="term"><code>message</code></a> parameter is generally used
to describe the payment request to the spender. Both the label and the
message are commonly stored by the spender’s <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> software—but they
are never added to the actual transaction, so other Bitcoin users cannot
see them. Both the label and the message must be <a href="https://tools.ietf.org/html/rfc3986">URI encoded</a>.</p>

  <p>All four parameters used together, with appropriate URI encoding, can be
seen in the line-wrapped example below.</p>

  <pre><code>bitcoin:mjSk1Ny9spzU2fouzYgLqGUD8U41iR35QN\
?amount=0.10\
&amp;label=Example+Merchant\
&amp;message=Order+of+flowers+%26+chocolates
</code></pre>

  <p>The URI scheme can be extended, as will be seen in the <a href="/en/developer-guide#term-payment-protocol" title="The protocol defined in BIP70 which lets spenders get signed payment details from receivers" class="auto-link">payment protocol</a>
section below, with both new optional and required parameters. As of this
writing, the only widely-used parameter besides the four described above
is the <a href="/en/developer-guide#term-payment-protocol" title="The protocol defined in BIP70 which lets spenders get signed payment details from receivers" class="auto-link">payment protocol’s</a> <a href="/en/developer-guide#term-r-parameter" title="The payment request parameter in a bitcoin: URI" class="auto-link"><code>r</code></a> parameter.</p>

  <p>Programs accepting URIs in any form must ask the user for permission
before paying unless the user has explicitly disabled prompting (as
might be the case for micropayments).</p>

  <h4 id="qr-codes">QR Codes</h4>

  <p>QR codes are a popular way to exchange <a href="/en/developer-guide#term-bitcoin-uri" title="A URI which allows receivers to encode payment details so spenders don't have to manually enter addresses and other details" class="auto-link"><code>bitcoin:</code> URIs</a> in person, in
images, or in videos. Most mobile Bitcoin <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> apps, and some desktop
<a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a>, support scanning QR codes to pre-fill their payment screens.</p>

  <p>The figure below shows the same <a href="/en/developer-guide#term-bitcoin-uri" title="A URI which allows receivers to encode payment details so spenders don't have to manually enter addresses and other details" class="auto-link"><code>bitcoin:</code> URI</a> code encoded as four
different <a href="/en/developer-guide#term-uri-qr-code" title="A QR code containing a bitcoin: URI" id="term-uri-qr-code" class="term">Bitcoin QR codes</a> at four
different error correction levels. The QR code can include the <a href="/en/developer-guide#term-label" title="The label parameter of a bitcoin: URI which provides the spender with the receiver's name (unauthenticated)" class="auto-link"><code>label</code></a> and <a href="/en/developer-guide#term-message" title="A parameter of bitcoin: URIs which allows the receiver to optionally specify a message to the spender" class="auto-link"><code>message</code></a>
parameters—and any other optional parameters—but they were
omitted here to keep the QR code small and easy to scan with unsteady
or low-resolution mobile cameras.</p>

  <p><img src="/img/dev/en-qr-code.svg" alt="Bitcoin QR Codes" /></p>

  <p>The error correction is combined with a checksum to ensure the <a href="/en/developer-guide#term-uri-qr-code" title="A QR code containing a bitcoin: URI" class="auto-link">Bitcoin QR code</a>
cannot be successfully decoded with data missing or accidentally altered,
so your applications should choose the appropriate level of error
correction based on the space you have available to display the code.
Low-level damage correction works well when space is limited, and
quartile-level damage correction helps ensure fast scanning when
displayed on high-resolution screens.</p>

  <h4 id="payment-protocol">Payment Protocol</h4>

  <p>Bitcoin Core 0.9 supports the new <a href="/en/developer-guide#term-payment-protocol" title="The protocol defined in BIP70 which lets spenders get signed payment details from receivers" id="term-payment-protocol" class="term">payment protocol</a>. The <a href="/en/developer-guide#term-payment-protocol" title="The protocol defined in BIP70 which lets spenders get signed payment details from receivers" class="auto-link">payment protocol</a>
adds many important features to payment requests:</p>

  <ul>
    <li>
      <p>Supports <a href="https://en.wikipedia.org/wiki/X.509" class="auto-link">X.509</a> certificates and SSL encryption to verify receivers’ identity
and help prevent man-in-the-middle attacks.</p>
    </li>
    <li>
      <p>Provides more detail about the requested payment to spenders.</p>
    </li>
    <li>
      <p>Allows spenders to submit transactions directly to receivers without going
through the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">peer-to-peer network</a>. This can speed up payment processing and
work with planned features such as child-pays-for-parent <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fees</a>
and offline NFC or Bluetooth-based payments.</p>
    </li>
  </ul>

  <p>Instead of being asked to pay a meaningless <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a>, such as
“mjSk1Ny9spzU2fouzYgLqGUD8U41iR35QN”, spenders are asked to pay the
Common Name (CN) description from the receiver’s <a href="https://en.wikipedia.org/wiki/X.509" class="auto-link">X.509</a> certificate, such
as “www.bitcoin.org”.</p>

  <p>To request payment using the <a href="/en/developer-guide#term-payment-protocol" title="The protocol defined in BIP70 which lets spenders get signed payment details from receivers" class="auto-link">payment protocol</a>, you use an extended (but
backwards-compatible) <a href="/en/developer-guide#term-bitcoin-uri" title="A URI which allows receivers to encode payment details so spenders don't have to manually enter addresses and other details" class="auto-link"><code>bitcoin:</code> URI</a>.  For example:</p>

  <pre><code>bitcoin:mjSk1Ny9spzU2fouzYgLqGUD8U41iR35QN\
?amount=0.10\
&amp;label=Example+Merchant\
&amp;message=Order+of+flowers+%26+chocolates\
&amp;r=https://example.com/pay/mjSk1Ny9spzU2fouzYgLqGUD8U41iR35QN
</code></pre>

  <p>None of the parameters provided above, except <a href="/en/developer-guide#term-r-parameter" title="The payment request parameter in a bitcoin: URI" class="auto-link"><code>r</code></a>, are required for the
<a href="/en/developer-guide#term-payment-protocol" title="The protocol defined in BIP70 which lets spenders get signed payment details from receivers" class="auto-link">payment protocol</a>—but your applications may include them for backwards
compatibility with <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> programs which don’t yet handle the <a href="/en/developer-guide#term-payment-protocol" title="The protocol defined in BIP70 which lets spenders get signed payment details from receivers" class="auto-link">payment
protocol</a>. </p>

  <p>The <a href="/en/developer-guide#term-r-parameter" title="The payment request parameter in a bitcoin: URI" id="term-r-parameter" class="term"><code>r</code></a> parameter tells payment-protocol-aware <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> programs to ignore
the other parameters and fetch a <a href="/en/developer-examples#term-paymentrequest" title="The PaymentRequest of the payment protocol which contains and allows signing of the PaymentDetails" class="auto-link">PaymentRequest</a> from the URL provided.
The browser, QR code reader, or other program processing the URI opens
the spender’s Bitcoin <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> program on the URI. </p>

  <p><img src="/img/dev/en-payment-protocol.svg" alt="BIP70 Payment Protocol" /></p>

  <p>The <a href="/en/developer-guide#term-payment-protocol" title="The protocol defined in BIP70 which lets spenders get signed payment details from receivers" class="auto-link">Payment Protocol</a> is described in depth in <a href="https://github.com/bitcoin/bips/blob/master/bip-0070.mediawiki" class="auto-link">BIP70</a>, <a href="https://github.com/bitcoin/bips/blob/master/bip-0071.mediawiki" class="auto-link">BIP71</a>, and <a href="https://github.com/bitcoin/bips/blob/master/bip-0072.mediawiki" class="auto-link">BIP72</a>.
An example CGI program and description of all the parameters which can
be used in the <a href="/en/developer-guide#term-payment-protocol" title="The protocol defined in BIP70 which lets spenders get signed payment details from receivers" class="auto-link">Payment Protocol</a> is provided in the Developer Examples
<a href="/en/developer-examples#payment-protocol">Payment Protocol</a> subsection. In this
subsection, we will briefly describe in story format how the <a href="/en/developer-guide#term-payment-protocol" title="The protocol defined in BIP70 which lets spenders get signed payment details from receivers" class="auto-link">Payment
Protocol</a> is typically used.</p>

  <p>Charlie, the client, is shopping on a website run by Bob, the
businessman. Charlie adds a few items to his shopping cart and clicks
the “Checkout With Bitcoin” button.</p>

  <p>Bob’s server automatically adds the following information to its
invoice database:</p>

  <ul>
    <li>
      <p>The details of Charlie’s order, including items ordered and
shipping <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a>.</p>
    </li>
    <li>
      <p>An order total in <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>, perhaps created by converting prices in
<a href="/en/developer-guide#term-fiat" title="National currencies such as the dollar or euro" class="auto-link">fiat</a> to prices in <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>.</p>
    </li>
    <li>
      <p>An expiration time when that total will no longer be acceptable.</p>
    </li>
    <li>
      <p>An <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> to which Charlie should send payment. Typically this
will be a <a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a> or <a href="/en/developer-guide#term-p2sh" title="A script which Pays To Script Hashes (P2SH), allowing convenient spending of satoshis to an address referencing a script" class="auto-link">P2SH</a> <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> containing a unique (never
before used) <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a>.</p>
    </li>
  </ul>

  <p>After adding all that information to the database, Bob’s server displays
a <a href="/en/developer-guide#term-bitcoin-uri" title="A URI which allows receivers to encode payment details so spenders don't have to manually enter addresses and other details" class="auto-link"><code>bitcoin:</code> URI</a> for Charlie to click to pay. </p>

  <p>Charlie clicks on the <a href="/en/developer-guide#term-bitcoin-uri" title="A URI which allows receivers to encode payment details so spenders don't have to manually enter addresses and other details" class="auto-link"><code>bitcoin:</code> URI</a> in his browser. His browser’s URI
handler sends the URI to his <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> program. The <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> is aware of the
<a href="/en/developer-guide#term-payment-protocol" title="The protocol defined in BIP70 which lets spenders get signed payment details from receivers" class="auto-link">Payment Protocol</a>, so it parses the <a href="/en/developer-guide#term-r-parameter" title="The payment request parameter in a bitcoin: URI" class="auto-link"><code>r</code></a> parameter and sends an HTTP GET
to that URL looking for a <a href="/en/developer-examples#term-paymentrequest" title="The PaymentRequest of the payment protocol which contains and allows signing of the PaymentDetails" class="auto-link">PaymentRequest</a> message.</p>

  <p>The <a href="/en/developer-examples#term-paymentrequest" title="The PaymentRequest of the payment protocol which contains and allows signing of the PaymentDetails" class="auto-link">PaymentRequest</a> message returned may include private information, such as Charlie’s
mailing <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a>, but the <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> must be able to access it without using prior
authentication, such as HTTP cookies, so a publicly-accessible HTTPS URL
with a guess-resistant part is typically used. The
unique <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> created for the payment request can be used to create
a unique identifier. This is why, in the example URI above, the <a href="/en/developer-examples#term-paymentrequest" title="The PaymentRequest of the payment protocol which contains and allows signing of the PaymentDetails" class="auto-link">PaymentRequest</a>
URL contains the <a href="/en/developer-guide#term-p2pkh" title="A script which Pays To Pubkey Hashes (P2PKH), allowing spending of satoshis to anyone with a Bitcoin address" class="auto-link">P2PKH</a> <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a>:
<code>https://example.com/pay/mjSk1Ny9spzU2fouzYgLqGUD8U41iR35QN</code></p>

  <p>After receiving the HTTP GET to the URL above, the
<a href="/en/developer-examples#term-paymentrequest" title="The PaymentRequest of the payment protocol which contains and allows signing of the PaymentDetails" class="auto-link">PaymentRequest</a>-generating CGI program on Bob’s webserver takes the
unique identifier from the URL and looks up the corresponding details in
the database. It then creates a <a href="/en/developer-examples#term-paymentdetails" title="The PaymentDetails of the payment protocol which allows the receiver to specify the payment details to the spender" class="auto-link">PaymentDetails</a> message with the
following information:</p>

  <ul>
    <li>
      <p>The amount of the order in <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> and the <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> to be paid.</p>
    </li>
    <li>
      <p>A memo containing the list of items ordered, so Charlie knows what
he’s paying for.  It may also include Charlie’s mailing <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a> so he can
double-check it.</p>
    </li>
    <li>
      <p>The time the <a href="/en/developer-examples#term-paymentdetails" title="The PaymentDetails of the payment protocol which allows the receiver to specify the payment details to the spender" class="auto-link">PaymentDetails</a> message was created plus the time
it expires.</p>
    </li>
    <li>
      <p>A URL to which Charlie’s <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> should send its completed transaction.</p>
    </li>
  </ul>

  <p>That <a href="/en/developer-examples#term-paymentdetails" title="The PaymentDetails of the payment protocol which allows the receiver to specify the payment details to the spender" class="auto-link">PaymentDetails</a> message is put inside a <a href="/en/developer-examples#term-paymentrequest" title="The PaymentRequest of the payment protocol which contains and allows signing of the PaymentDetails" class="auto-link">PaymentRequest</a> message.
The payment request lets Bob’s server sign the entire Request with the
server’s <a href="https://en.wikipedia.org/wiki/X.509" class="auto-link">X.509</a> SSL certificate.  (The <a href="/en/developer-guide#term-payment-protocol" title="The protocol defined in BIP70 which lets spenders get signed payment details from receivers" class="auto-link">Payment Protocol</a> has been designed
to allow other signing methods in the future.)  Bob’s server sends the
payment request to Charlie’s <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> in the reply to the HTTP GET.</p>

  <p><img src="/img/dev/en-btcc-payment-request.png" alt="Bitcoin Core Showing Validated Payment Request" /></p>

  <p>Charlie’s <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> receives the <a href="/en/developer-examples#term-paymentrequest" title="The PaymentRequest of the payment protocol which contains and allows signing of the PaymentDetails" class="auto-link">PaymentRequest</a> message, checks its <a href="/en/developer-guide#term-signature" title="The result of combining a private key and some data in an ECDSA signature operation which allows anyone with the corresponding public key to verify the signature" class="auto-link">signature</a>, and
then displays the details from the <a href="/en/developer-examples#term-paymentdetails" title="The PaymentDetails of the payment protocol which allows the receiver to specify the payment details to the spender" class="auto-link">PaymentDetails</a> message to Charlie. Charlie
agrees to pay, so the <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> constructs a payment to the <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a>
Bob’s server provided. Unlike a traditional Bitcoin payment, Charlie’s
<a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> doesn’t necessarily automatically <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcast</a> this payment to the
<a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a>. Instead, the <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> constructs a Payment message and sends it to
the URL provided in the <a href="/en/developer-examples#term-paymentdetails" title="The PaymentDetails of the payment protocol which allows the receiver to specify the payment details to the spender" class="auto-link">PaymentDetails</a> message as an HTTP POST. Among
other things, the Payment message contains:</p>

  <ul>
    <li>
      <p>The signed transaction in which Charlie pays Bob.</p>
    </li>
    <li>
      <p>An optional memo Charlie can send to Bob. (There’s no guarantee that
Bob will read it.)</p>
    </li>
    <li>
      <p>A <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a> <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a> (<a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a>) which Bob can pay if he needs to
return some or all of Charlie’s <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>.</p>
    </li>
  </ul>

  <p>Bob’s server receives the Payment message, verifies the transaction pays
the requested amount to the <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a> provided, and then <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcasts</a> the
transaction to the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a>. It also replies to the HTTP POSTed Payment
message with a PaymentACK message, which includes an optional memo
from Bob’s server thanking Charlie for his patronage and providing other
information about the order, such as the expected arrival date.</p>

  <p>Charlie’s <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> sees the PaymentACK and tells Charlie that the payment
has been sent. The PaymentACK doesn’t mean that Bob has verified
Charlie’s payment—see the Verifying Payment subsection below—but it does mean
that Charlie can go do something else while the transaction gets <a href="/en/developer-guide#term-confirmation" title="A transaction included in a block currently on the block chain" class="auto-link">confirmed</a>.
After Bob’s server verifies from the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> that Charlie’s
transaction has been suitably <a href="/en/developer-guide#term-confirmation" title="A transaction included in a block currently on the block chain" class="auto-link">confirmed</a>, it authorizes shipping
Charlie’s order.</p>

  <p>In the case of a dispute, Charlie can generate a cryptographically-proven
<a href="/en/developer-guide#term-receipt" title="A cryptographically-verifiable receipt created using parts of a payment request and a confirmed transaction" id="term-receipt" class="term">receipt</a> out of the various signed or
otherwise-proven information.</p>

  <ul>
    <li>
      <p>The <a href="/en/developer-examples#term-paymentdetails" title="The PaymentDetails of the payment protocol which allows the receiver to specify the payment details to the spender" class="auto-link">PaymentDetails</a> message signed by Bob’s webserver proves Charlie
received an invoice to pay a specified <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> for a specified
number of <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> for goods specified in the memo field.</p>
    </li>
    <li>
      <p>The Bitcoin <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> can prove that the <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> specified by
Bob was paid the specified number of <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>.</p>
    </li>
  </ul>

  <p>If a <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a> needs to be issued, Bob’s server can safely pay the
<a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a>-to <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> provided by Charlie. (Note: a proposal has been
discussed to give <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a>-to <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a> an implicit expiration date so
users and software don’t need to worry about payments being sent to
<a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a> which are no longer monitored.)  See the <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">Refunds</a> section below
for more details.</p>

  <h3 id="verifying-payment">Verifying Payment</h3>

  <p>As explained in the <a href="/en/developer-guide#transactions" title="A transaction spending satoshis">Transactions</a> and <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain">Block Chain</a> sections, <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner)" class="auto-link">broadcasting</a>
a transaction to the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> doesn’t ensure that the receiver gets
paid. A malicious spender can create one transaction that pays the
receiver and a second one that pays the same <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> back to himself. Only
one of these transactions will be added to the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>, and nobody
can say for sure which one it will be.</p>

  <p>Two or more transactions spending the same <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> are commonly referred
to as a <a href="/en/developer-guide#term-double-spend" title="Attempting to spend the same satoshis which were spent in a previous transaction" id="term-double-spend" class="term">double spend</a>.</p>

  <p>Once the transaction is included in a <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>, double spends are
impossible without modifying <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> history to replace the
transaction, which is quite difficult. Using this system,
the Bitcoin protocol can give each of your transactions an updating confidence 
score based on the number of <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> which would need to be modified to replace 
a transaction. For each <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>, the transaction gains one <a href="/en/developer-guide#term-confirmation" title="The number of blocks which would need to be modified to remove or modify a transaction" id="term-confirmation" class="term">confirmation</a>. Since 
modifying <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> is quite difficult, higher <a href="/en/developer-guide#term-confirmation" title="The number of blocks which would need to be modified to remove or modify a transaction" class="auto-link">confirmation</a> scores indicate 
greater protection.</p>

  <p><strong>0 <a href="/en/developer-guide#term-confirmation" title="The number of blocks which would need to be modified to remove or modify a transaction" class="auto-link">confirmations</a></strong>: The transaction has been <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcast</a> but is still not 
included in any <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>. Zero <a href="/en/developer-guide#term-confirmation" title="The number of blocks which would need to be modified to remove or modify a transaction" class="auto-link">confirmation</a> transactions (<a href="/en/developer-guide#term-unconfirmed-transactions" title="A transaction which has not yet been added to the block chain" id="term-unconfirmed-transactions" class="term">unconfirmed
transactions</a>) should generally not be 
trusted without risk analysis. Although <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> usually <a href="/en/developer-guide#term-confirmation" title="A transaction included in a block currently on the block chain" class="auto-link">confirm</a> the first 
transaction they receive, fraudsters may be able to manipulate the
<a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> into including their version of a transaction.</p>

  <p><strong>1 <a href="/en/developer-guide#term-confirmation" title="The number of blocks which would need to be modified to remove or modify a transaction" class="auto-link">confirmation</a></strong>: The transaction is included in the latest <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> and 
<a href="/en/developer-guide#term-double-spend" title="Attempting to spend the same satoshis which were spent in a previous transaction" class="auto-link">double-spend</a> risk decreases dramatically. Transactions which pay
sufficient <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fees</a> need 10 minutes on average to receive one
<a href="/en/developer-guide#term-confirmation" title="The number of blocks which would need to be modified to remove or modify a transaction" class="auto-link">confirmation</a>. However, the most recent <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> gets replaced fairly often by
accident, so a <a href="/en/developer-guide#term-double-spend" title="Attempting to spend the same satoshis which were spent in a previous transaction" class="auto-link">double spend</a> is still a real possibility.</p>

  <p><strong>2 <a href="/en/developer-guide#term-confirmation" title="The number of blocks which would need to be modified to remove or modify a transaction" class="auto-link">confirmations</a></strong>: The most recent <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> was chained to the <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> which 
includes the transaction. As of March 2014, two <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> replacements were 
exceedingly rare, and a two <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> replacement attack was impractical without 
expensive <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> equipment.</p>

  <p><strong>6 <a href="/en/developer-guide#term-confirmation" title="The number of blocks which would need to be modified to remove or modify a transaction" class="auto-link">confirmations</a></strong>: The <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> has spent about an hour working to protect 
the transaction against double spends and the transaction is buried under six 
<a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>. Even a reasonably lucky attacker would require a large percentage of 
the total <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> hashing power to replace six <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>. Although this number is 
somewhat arbitrary, software handling high-value transactions, or otherwise at 
risk for fraud, should wait for at least six <a href="/en/developer-guide#term-confirmation" title="The number of blocks which would need to be modified to remove or modify a transaction" class="auto-link">confirmations</a> before treating a 
payment as accepted.</p>

  <p>Bitcoin Core provides several <a href="/en/developer-reference#remote-procedure-calls-rpcs" class="auto-link">RPCs</a> which can provide your program with the 
<a href="/en/developer-guide#term-confirmation" title="The number of blocks which would need to be modified to remove or modify a transaction" class="auto-link">confirmation</a> score for transactions in your <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> or arbitrary transactions. 
For example, the <a href="/en/developer-reference#listunspent" class="auto-link"><code>listunspent</code></a> <a href="/en/developer-reference#remote-procedure-calls-rpcs" class="auto-link">RPC</a> provides an array of every <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshi</a> you can 
spend along with its <a href="/en/developer-guide#term-confirmation" title="The number of blocks which would need to be modified to remove or modify a transaction" class="auto-link">confirmation</a> score.</p>

  <p>Although <a href="/en/developer-guide#term-confirmation" title="The number of blocks which would need to be modified to remove or modify a transaction" class="auto-link">confirmations</a> provide excellent <a href="/en/developer-guide#term-double-spend" title="Attempting to spend the same satoshis which were spent in a previous transaction" class="auto-link">double-spend</a> protection most of the 
time, there are at least three cases where <a href="/en/developer-guide#term-double-spend" title="Attempting to spend the same satoshis which were spent in a previous transaction" class="auto-link">double-spend</a> risk analysis can be 
required:</p>

  <ol>
    <li>
      <p>In the case when the program or its user cannot wait for a <a href="/en/developer-guide#term-confirmation" title="The number of blocks which would need to be modified to remove or modify a transaction" class="auto-link">confirmation</a> and 
wants to accept <a href="/en/developer-guide#term-unconfirmed-transactions" title="A transaction which has not yet been added to the block chain" class="auto-link">unconfirmed</a> payments.</p>
    </li>
    <li>
      <p>In the case when the program or its user is accepting high value 
transactions and cannot wait for at least six <a href="/en/developer-guide#term-confirmation" title="The number of blocks which would need to be modified to remove or modify a transaction" class="auto-link">confirmations</a> or more.</p>
    </li>
    <li>
      <p>In the case of an implementation bug or prolonged attack against Bitcoin 
which makes the system less reliable than expected.</p>
    </li>
  </ol>

  <p>An interesting source of <a href="/en/developer-guide#term-double-spend" title="Attempting to spend the same satoshis which were spent in a previous transaction" class="auto-link">double-spend</a> risk analysis can be acquired by 
connecting to large numbers of Bitcoin <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peers</a> to track how transactions and 
<a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> differ from each other. Some third-party APIs can provide you with this 
type of service.</p>

  <p>For example, <a href="/en/developer-guide#term-unconfirmed-transactions" title="A transaction which has not yet been added to the block chain" class="auto-link">unconfirmed transactions</a> can be compared among all connected <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peers</a> 
to see if any <a href="/en/developer-guide#term-utxo" title="Unspent Transaction Output (UTXO) holding satoshis which have not yet been spent" class="auto-link">UTXO</a> is used in multiple <a href="/en/developer-guide#term-unconfirmed-transactions" title="A transaction which has not yet been added to the block chain" class="auto-link">unconfirmed transactions</a>, indicating a 
<a href="/en/developer-guide#term-double-spend" title="Attempting to spend the same satoshis which were spent in a previous transaction" class="auto-link">double-spend</a> attempt, in which case the payment can be refused until it is 
<a href="/en/developer-guide#term-confirmation" title="A transaction included in a block currently on the block chain" class="auto-link">confirmed</a>. Transactions can also be ranked by their <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fee</a> to
estimate the amount of time until they’re added to a <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>.</p>

  <p>Another example could be to detect a <a href="/en/developer-guide#term-accidental-fork" title="When two or more blocks have the same block height, forking the block chain.  Happens occasionally by accident" class="auto-link">fork</a> when multiple <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peers</a> report differing 
<a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a> hashes at the same <a href="/en/developer-guide#term-block-height" title="The number of chained blocks preceding this block" class="auto-link">block height</a>. Your program can go into a safe mode if the 
<a href="/en/developer-guide#term-accidental-fork" title="When two or more blocks have the same block height, forking the block chain.  Happens occasionally by accident" class="auto-link">fork</a> extends for more than two <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>, indicating a possible problem with the 
<a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>.</p>

  <p>Another good source of <a href="/en/developer-guide#term-double-spend" title="Attempting to spend the same satoshis which were spent in a previous transaction" class="auto-link">double-spend</a> protection can be human intelligence. For 
example, fraudsters may act differently from legitimate customers, letting 
savvy merchants manually flag them as high risk. Your program can provide a 
safe mode which stops automatic payment acceptance on a global or per-customer 
basis.</p>

  <h3 id="issuing-refunds">Issuing Refunds</h3>

  <p>Occasionally receivers using your applications will need to issue
<a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refunds</a>. The obvious way to do that, which is very unsafe, is simply
to return the <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> to the <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">script</a> from which they came.
For example:</p>

  <ul>
    <li>
      <p>Alice wants to buy a widget from Bob, so Bob gives Alice a price and
Bitcoin <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a>. </p>
    </li>
    <li>
      <p>Alice opens her <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> program and sends some <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> to that
<a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a>. Her <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> program automatically chooses to spend those
<a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> from one of its unspent <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a>, an <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> corresponding to
the Bitcoin <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a> mjSk1Ny9spzU2fouzYgLqGUD8U41iR35QN.</p>
    </li>
    <li>
      <p>Bob discovers Alice paid too many <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>. Being an honest fellow,
Bob <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refunds</a> the extra <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> to the mjSk… <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a>.</p>
    </li>
  </ul>

  <p>This seems like it should work, but Alice is using a centralized
multi-user web <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> which doesn’t give <a href="/en/developer-guide#term-unique-address" title="Address which are only used once to protect privacy and increase security" class="auto-link">unique addresses</a> to each user,
so it has no way to know that Bob’s <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a> is meant for Alice.  Now the
<a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a> is a unintentional donation to the company behind the centralized
<a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>, unless Alice opens a support ticket and proves those <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>
were meant for her.</p>

  <p>This leaves receivers only two correct ways to issue <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refunds</a>:</p>

  <ul>
    <li>
      <p>If an <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a> was copy-and-pasted or a basic <a href="/en/developer-guide#term-bitcoin-uri" title="A URI which allows receivers to encode payment details so spenders don't have to manually enter addresses and other details" class="auto-link"><code>bitcoin:</code> URI</a> was used,
contact the spender directly and ask them to provide a <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a> <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">address</a>.</p>
    </li>
    <li>
      <p>If the <a href="/en/developer-guide#term-payment-protocol" title="The protocol defined in BIP70 which lets spenders get signed payment details from receivers" class="auto-link">payment protocol</a> was used, send the <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a> to the <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a>
listed in the <code>refund_to</code> field of the Payment message.</p>
    </li>
  </ul>

  <p>As discussed in the Payment section, <code>refund_to</code> <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a> may come with
implicit expiration dates, so you may need to revert to contacting the
spender directly if the <a href="/en/developer-guide#issuing-refunds" title="A transaction which refunds some or all satoshis received in a previous transaction" class="auto-link">refund</a> is being issued a long time after the
original payment was made.</p>

  <h3 id="disbursing-income-limiting-forex-risk">Disbursing Income (Limiting Forex Risk)</h3>

  <p>Many receivers worry that their <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> will be less valuable in the
future than they are now, called foreign exchange (forex) risk. To limit
forex risk, many receivers choose to disburse newly-acquired payments
soon after they’re received.</p>

  <p>If your application provides this business logic, it will need to choose
which <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a> to spend first.  There are a few different algorithms
which can lead to different results.</p>

  <ul>
    <li>
      <p>A <a href="/en/developer-guide#term-merge-avoidance" title="A strategy for selecting which outputs to spend that avoids merging outputs with different histories that could leak private information" class="auto-link">merge avoidance</a> algorithm makes it harder for outsiders looking
at <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> data to figure out how many <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> the receiver has
earned, spent, and saved.</p>
    </li>
    <li>
      <p>A last-in-first-out (LIFO) algorithm spends newly acquired <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>
while there’s still <a href="/en/developer-guide#term-double-spend" title="Attempting to spend the same satoshis which were spent in a previous transaction" class="auto-link">double spend</a> risk, possibly pushing that risk on
to others. This can be good for the receiver’s balance sheet but
possibly bad for their reputation.</p>
    </li>
    <li>
      <p>A first-in-first-out (FIFO) algorithm spends the oldest <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>
first, which can help ensure that the receiver’s payments always
<a href="/en/developer-guide#term-confirmation" title="A transaction included in a block currently on the block chain" class="auto-link">confirm</a>, although this has utility only in a few edge cases.</p>
    </li>
  </ul>

  <h4 id="merge-avoidance">Merge Avoidance</h4>

  <p>When a receiver receives <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> in an <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a>, the spender can track
(in a crude way) how the receiver spends those <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>. But the spender
can’t automatically see other <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> paid to the receiver by other
spenders as long as the receiver uses <a href="/en/developer-guide#term-unique-address" title="Address which are only used once to protect privacy and increase security" class="auto-link">unique addresses</a> for each
transaction.</p>

  <p>However, if the receiver spends <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> from two different spenders in
the same transaction, each of those spenders can see the other spender’s
payment.  This is called a <a href="/en/developer-guide#term-merge" title="Spending, in the same transaction, multiple outputs which can be traced back to different previous spenders, leaking information about how many satoshis you control" id="term-merge" class="term">merge</a>, and the more a receiver merges
<a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a>, the easier it is for an outsider to track how many <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> the
receiver has earned, spent, and saved.</p>

  <p><a href="/en/developer-guide#term-merge-avoidance" title="A strategy for selecting which outputs to spend that avoids merging outputs with different histories that could leak private information" id="term-merge-avoidance" class="term">Merge avoidance</a> means trying to avoid spending unrelated <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a> in the
same transaction. For persons and businesses which want to keep their
transaction data secret from other people, it can be an important strategy.</p>

  <p>A crude <a href="/en/developer-guide#term-merge-avoidance" title="A strategy for selecting which outputs to spend that avoids merging outputs with different histories that could leak private information" class="auto-link">merge avoidance</a> strategy is to try to always pay with the
smallest <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> you have which is larger than the amount being
requested. For example, if you have four <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a> holding, respectively,
100, 200, 500, and 900 <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>, you would pay a bill for 300 <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a>
with the 500-<a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshi</a> <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a>. This way, as long as you have <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a>
larger than your bills, you avoid merging.</p>

  <p>More advanced <a href="/en/developer-guide#term-merge-avoidance" title="A strategy for selecting which outputs to spend that avoids merging outputs with different histories that could leak private information" class="auto-link">merge avoidance</a> strategies largely depend on enhancements
to the <a href="/en/developer-guide#term-payment-protocol" title="The protocol defined in BIP70 which lets spenders get signed payment details from receivers" class="auto-link">payment protocol</a> which will allow payers to avoid merging by
intelligently distributing their payments among multiple <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a>
provided by the receiver.</p>

  <h4 id="last-in-first-out-lifo">Last In, First Out (LIFO)</h4>

  <p><a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">Outputs</a> can be spent as soon as they’re received—even before they’re
<a href="/en/developer-guide#term-confirmation" title="A transaction included in a block currently on the block chain" class="auto-link">confirmed</a>. Since recent <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a> are at the greatest risk of being
<a href="/en/developer-guide#term-double-spend" title="Attempting to spend the same satoshis which were spent in a previous transaction" class="auto-link">double-spent</a>, spending them before older <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a> allows the spender to
hold on to older <a href="/en/developer-guide#term-confirmation" title="A transaction included in a block currently on the block chain" class="auto-link">confirmed</a> <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a> which are much less likely to be
<a href="/en/developer-guide#term-double-spend" title="Attempting to spend the same satoshis which were spent in a previous transaction" class="auto-link">double-spent</a>.</p>

  <p>There are two closely-related downsides to LIFO:</p>

  <ul>
    <li>
      <p>If you spend an <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> from one <a href="/en/developer-guide#term-unconfirmed-transactions" title="A transaction which has not yet been added to the block chain" class="auto-link">unconfirmed</a> transaction in a second
transaction, the second transaction becomes invalid if <a href="/en/developer-guide#transaction-malleability" title="The ability of an attacker to change the transaction identifier (txid) of unconfirmed transactions, making dependent transactions invalid" class="auto-link">transaction
malleability</a> changes the first transaction. </p>
    </li>
    <li>
      <p>If you spend an <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> from one <a href="/en/developer-guide#term-unconfirmed-transactions" title="A transaction which has not yet been added to the block chain" class="auto-link">unconfirmed</a> transaction in a second
transaction and the first transaction’s <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a> is successfully double
spent to another <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">output</a>, the second transaction becomes invalid.</p>
    </li>
  </ul>

  <p>In either of the above cases, the receiver of the second transaction
will see the incoming transaction notification disappear or turn into an
error message.</p>

  <p>Because LIFO puts the recipient of secondary transactions in as much
<a href="/en/developer-guide#term-double-spend" title="Attempting to spend the same satoshis which were spent in a previous transaction" class="auto-link">double-spend</a> risk as the recipient of the primary transaction, they’re
best used when the secondary recipient doesn’t care about the
risk—such as an exchange or other service which is going to wait for
six <a href="/en/developer-guide#term-confirmation" title="The number of blocks which would need to be modified to remove or modify a transaction" class="auto-link">confirmations</a> whether you spend old <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a> or new <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a>.</p>

  <p>LIFO should not be used when the primary transaction recipient’s
reputation might be at stake, such as when paying employees. In these
cases, it’s better to wait for transactions to be fully verified (see
the <a href="/en/developer-guide#verifying-payment">Verification subsection</a> above) before using them to make payments.</p>

  <h4 id="first-in-first-out-fifo">First In, First Out (FIFO)</h4>

  <p>The oldest <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a> are the most reliable, as the longer it’s been since
they were received, the more <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> would need to be modified to <a href="/en/developer-guide#term-double-spend" title="Attempting to spend the same satoshis which were spent in a previous transaction" class="auto-link">double
spend</a> them. However, after just a few <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>, a point of rapidly
diminishing returns is reached. The <a href="https://bitcoin.org/bitcoin.pdf">original Bitcoin paper</a>
predicts the chance of an attacker being able to modify old <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>,
assuming the attacker has 30% of the total <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> hashing power:</p>

  <table>
    <thead>
      <tr>
        <th><a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">Blocks</a></th>
        <th>Chance of successful modification</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>5</td>
        <td>17.73523%</td>
      </tr>
      <tr>
        <td>10</td>
        <td>4.16605%</td>
      </tr>
      <tr>
        <td>15</td>
        <td>1.01008%</td>
      </tr>
      <tr>
        <td>20</td>
        <td>0.24804%</td>
      </tr>
      <tr>
        <td>25</td>
        <td>0.06132%</td>
      </tr>
      <tr>
        <td>30</td>
        <td>0.01522%</td>
      </tr>
      <tr>
        <td>35</td>
        <td>0.00379%</td>
      </tr>
      <tr>
        <td>40</td>
        <td>0.00095%</td>
      </tr>
      <tr>
        <td>45</td>
        <td>0.00024%</td>
      </tr>
      <tr>
        <td>50</td>
        <td>0.00006%</td>
      </tr>
    </tbody>
  </table>

  <p>FIFO does have a small advantage when it comes to <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fees</a>, as
older <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a> may be eligible for inclusion in the 50,000 bytes set
aside for no-fee-required <a href="/en/developer-guide#term-high-priority-transactions" title="Transactions which don't pay a transaction fee; only transactions spending long-idle outputs are eligible" class="auto-link">high-priority transactions</a> by <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> running the default Bitcoin Core
codebase.  However, with <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fees</a> being so low, this is not a
significant advantage.</p>

  <p>The only practical use of FIFO is by receivers who spend all or most
of their income within a few <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>, and who want to reduce the
chance of their payments becoming accidentally invalid. For example,
a receiver who holds each payment for six <a href="/en/developer-guide#term-confirmation" title="The number of blocks which would need to be modified to remove or modify a transaction" class="auto-link">confirmations</a>, and then
spends 100% of <a href="/en/developer-guide#verifying-payment" title="Payments which the receiver believes won't be double spent" class="auto-link">verified payments</a> to vendors and a savings account on
a bi-hourly schedule.</p>

  <h3 id="rebilling-recurring-payments">Rebilling Recurring Payments</h3>

  <p>Automated recurring payments are not possible with decentralized Bitcoin
<a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a>. Even if a <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> supported automatically sending non-reversible
payments on a regular schedule, the user would still need to start the
program at the appointed time, or leave it running all the time
unprotected by encryption.</p>

  <p>This means automated recurring Bitcoin payments can only be made from a
centralized server which handles <a href="/en/developer-guide#term-satoshi" title="The smallest unit of Bitcoin value; 0.00000001 bitcoins.  Also used generically for any value of bitcoins" class="auto-link">satoshis</a> on behalf of its spenders. In
practice, receivers who want to set prices in <a href="/en/developer-guide#term-fiat" title="National currencies such as the dollar or euro" class="auto-link">fiat</a> terms must also let
the same centralized server choose the appropriate exchange rate.</p>

  <p>Non-automated rebilling can be managed by the same mechanism used before
credit-card recurring payments became common: contact the spender and
ask them to pay again—for example, by sending them a <a href="/en/developer-examples#term-paymentrequest" title="The PaymentRequest of the payment protocol which contains and allows signing of the PaymentDetails" class="auto-link">PaymentRequest</a>
<a href="/en/developer-guide#term-bitcoin-uri" title="A URI which allows receivers to encode payment details so spenders don't have to manually enter addresses and other details" class="auto-link"><code>bitcoin:</code> URI</a> in an HTML email.</p>

  <p>In the future, extensions to the <a href="/en/developer-guide#term-payment-protocol" title="The protocol defined in BIP70 which lets spenders get signed payment details from receivers" class="auto-link">payment protocol</a> and new <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>
features may allow some <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a> programs to manage a list of recurring
transactions. The spender will still need to start the program on a
regular basis and authorize payment—but it should be easier and more
secure for the spender than clicking an emailed invoice, increasing the
chance receivers get paid on time.</p>

  <h2 id="operating-modes">Operating Modes</h2>

  <p>Currently there are two primary methods of validating the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> as a client: Full nodes and <a href="/en/developer-guide#simplified-payment-verification-spv" title="A method for verifying particular transactions were included in blocks without downloading the entire contents of the block chain" class="auto-link">SPV</a> clients. Other methods, such as server-trusting methods, are not discussed as they are not recommended.</p>

  <h3 id="full-node">Full Node</h3>

  <p>The first and most secure model is the one followed by Bitcoin Core, also known as a “thick” or “full chain” client. This security model assures the validity of the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> by downloading and validating <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> from the <a href="/en/developer-guide#term-genesis-block" title="The first block created; also called block 0" class="auto-link">genesis block</a> all the way to the most recently discovered <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>. This is known as using the <em>height</em> of a particular <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> to verify the client’s view of the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a>. </p>

  <p>For a client to be fooled, an adversary would need to give a complete alternative <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> history that is of greater <a href="/en/developer-guide#term-difficulty" title="A number corresponding to the target threshold which indicates how difficult it will be to find the next block" class="auto-link">difficulty</a> than the current “true” chain, which is impossible due to the fact that the longest chain is by definition the true chain. After the suggested six <a href="/en/developer-guide#term-confirmation" title="The number of blocks which would need to be modified to remove or modify a transaction" class="auto-link">confirmations</a>, the ability to fool the client become intractable, as only a single honest <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> node is needed to have the complete state of the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>. </p>

  <p><img src="/img/dev/en-block-height-vs-depth.svg" alt="Block Height Compared To Block Depth" /></p>

  <h3 id="simplified-payment-verification-spv">Simplified Payment Verification (SPV)</h3>

  <p>An alternative approach detailed in the <a href="https://bitcoin.org/bitcoin.pdf">original Bitcoin paper</a> is a client that only downloads the headers of <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> during the initial syncing process and then requests transactions from full nodes as needed. This scales linearly with the height of the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> at only 80 bytes per <a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a>, or up to 4.2MB per year, regardless of total <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> size. </p>

  <p>As described in the white paper, the <a href="/en/developer-guide#term-merkle-root" title="The root node of a Merkle tree descended from all the hashed pairs in the tree" class="auto-link">Merkle root</a> in the <a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a> along with a Merkle branch can prove to the <a href="/en/developer-guide#simplified-payment-verification-spv" title="A method for verifying particular transactions were included in blocks without downloading the entire contents of the block chain" class="auto-link">SPV</a> client that the transaction in question is embedded in a <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> in the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>. This does not guarantee validity of the transactions that are embedded. Instead it demonstrates the amount of work required to perform a <a href="/en/developer-guide#term-double-spend" title="Attempting to spend the same satoshis which were spent in a previous transaction" class="auto-link">double-spend</a> attack. </p>

  <p>The <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block’s</a> depth in the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> corresponds to the cumulative <a href="/en/developer-guide#term-difficulty" title="A number corresponding to the target threshold which indicates how difficult it will be to find the next block" class="auto-link">difficulty</a> that has been performed to build on top of that particular <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>. The <a href="/en/developer-guide#simplified-payment-verification-spv" title="A method for verifying particular transactions were included in blocks without downloading the entire contents of the block chain" class="auto-link">SPV</a> client knows the <a href="/en/developer-guide#term-merkle-root" title="The root node of a Merkle tree descended from all the hashed pairs in the tree" class="auto-link">Merkle root</a> and associated transaction information, and requests the respective Merkle branch from a full node. Once the Merkle branch has been retrieved, proving the existence of the transaction in the <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>, the <a href="/en/developer-guide#simplified-payment-verification-spv" title="A method for verifying particular transactions were included in blocks without downloading the entire contents of the block chain" class="auto-link">SPV</a> client can then look to <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> <em>depth</em> as a proxy for transaction validity and security. The cost of an attack on a user by a malicious node who inserts an invalid transaction grows with the cumulative <a href="/en/developer-guide#term-difficulty" title="A number corresponding to the target threshold which indicates how difficult it will be to find the next block" class="auto-link">difficulty</a> built on top of that <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>, since the malicious node alone will be <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> this forged chain. </p>

  <h4 id="potential-spv-weaknesses">Potential SPV Weaknesses</h4>

  <p>If implemented naively, an <a href="/en/developer-guide#simplified-payment-verification-spv" title="A method for verifying particular transactions were included in blocks without downloading the entire contents of the block chain" class="auto-link">SPV</a> client has a few important weaknesses. </p>

  <p>First, while the <a href="/en/developer-guide#simplified-payment-verification-spv" title="A method for verifying particular transactions were included in blocks without downloading the entire contents of the block chain" class="auto-link">SPV</a> client can not be easily fooled into thinking a transaction is in a <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> when it is not, the reverse is not true. A full node can simply lie by omission, leading an <a href="/en/developer-guide#simplified-payment-verification-spv" title="A method for verifying particular transactions were included in blocks without downloading the entire contents of the block chain" class="auto-link">SPV</a> client to believe a transaction has not occurred. This can be considered a form of Denial of Service. One mitigation strategy is to connect to a number of full nodes, and send the requests to each node. However this can be defeated by <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> partitioning or Sybil attacks, since identities are essentially free, and can be bandwidth intensive. Care must be taken to ensure the client is not cut off from honest nodes.</p>

  <p>Second, the <a href="/en/developer-guide#simplified-payment-verification-spv" title="A method for verifying particular transactions were included in blocks without downloading the entire contents of the block chain" class="auto-link">SPV</a> client only requests transactions from full nodes corresponding to keys it owns. If the <a href="/en/developer-guide#simplified-payment-verification-spv" title="A method for verifying particular transactions were included in blocks without downloading the entire contents of the block chain" class="auto-link">SPV</a> client downloads all <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> and then discards unneeded ones, this can be extremely bandwidth intensive. If they simply ask full nodes for <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> with specific transactions, this allows full nodes a complete view of the public <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a> that correspond to the user. This is a large privacy leak, and allows for tactics such as denial of service for clients, users, or <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a> that are disfavored by those running full nodes, as well as trivial linking of funds. A client could simply spam many fake transaction requests, but this creates a large strain on the <a href="/en/developer-guide#simplified-payment-verification-spv" title="A method for verifying particular transactions were included in blocks without downloading the entire contents of the block chain" class="auto-link">SPV</a> client, and can end up defeating the purpose of thin clients altogether. </p>

  <p>To mitigate the latter issue, Bloom filters have been implemented as a method of obfuscation and compression of <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> data requests. </p>

  <h4 id="bloom-filters">Bloom Filters</h4>

  <p>A Bloom filter is a space-efficient probabilistic data structure that is used to test membership of an element. The data structure achieves great data compression at the expense of a prescribed false positive rate. </p>

  <p>A Bloom filter starts out as an array of n bits all set to 0. A set of k random hash functions are chosen, each of which output a single integer between the range of 1 and n.</p>

  <p>When adding an element to the Bloom filter, the element is hashed k times separately, and for each of the k outputs, the corresponding Bloom filter bit at that index is set to 1. </p>

  <p>Querying of the Bloom filter is done by using the same hash functions as before. If all k bits accessed in the bloom filter are set to 1, this demonstrates with high probability that the element lies in the set. Clearly, the k indices could have been set to 1 by the addition of a combination of other elements in the domain, but the parameters allow the user to choose the acceptable false positive rate. </p>

  <p>Removal of elements can only be done by scrapping the bloom filter and re-creating it from scratch.</p>

  <h4 id="application-of-bloom-filters">Application Of Bloom Filters</h4>

  <p>Rather than viewing the false positive rates as a liability, it is used to create a tunable parameter that represents the desired privacy level and bandwidth trade-off. A <a href="/en/developer-guide#simplified-payment-verification-spv" title="A method for verifying particular transactions were included in blocks without downloading the entire contents of the block chain" class="auto-link">SPV</a> client creates their Bloom filter and sends it to a full node using the message <code>filterload</code>, which sets the filter for which transactions are desired. The command <code>filteradd</code> allows addition of desired data to the filter without needing to send a totally new Bloom filter, and <code>filterclear</code> allows the connection to revert to standard <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> discovery mechanisms. If the filter has been loaded, then full nodes will send a modified form of <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>, called a merkleblock. The merkleblock is simply the <a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a> with the merkle branch associated with the set Bloom filter. </p>

  <p>An <a href="/en/developer-guide#simplified-payment-verification-spv" title="A method for verifying particular transactions were included in blocks without downloading the entire contents of the block chain" class="auto-link">SPV</a> client can not only add transactions as elements to the filter, but also <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public keys</a>, data from <a href="/en/developer-guide#term-input" title="The input to a transaction linking to the output of a previous transaction which permits spending of satoshis" class="auto-link">input</a> and <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">outputs</a> <a href="/en/developer-guide#term-script" title="The part of an output which sets the conditions for spending of the satoshis in that output" class="auto-link">scripts</a>, and more. This enables <a href="/en/developer-guide#term-p2sh" title="A script which Pays To Script Hashes (P2SH), allowing convenient spending of satoshis to an address referencing a script" class="auto-link">P2SH</a> transaction finding.</p>

  <p>If a user is more privacy-conscious, he can set the Bloom filter to include more false positives, at the expense of extra bandwidth used for transaction discovery. If a user is on a tight bandwidth budget, he can set the false-positive rate to low, knowing that this will allow full nodes a clear view of what transactions are associated with his client. </p>

  <p><strong>Resources:</strong> <a href="http://bitcoinj.org">BitcoinJ</a>, a Java implementation of Bitcoin that is based on the <a href="/en/developer-guide#simplified-payment-verification-spv" title="A method for verifying particular transactions were included in blocks without downloading the entire contents of the block chain" class="auto-link">SPV</a> security model and Bloom filters. Used in most Android <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallets</a>.</p>

  <p>Bloom filters were standardized for use via <a href="https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki">BIP37</a>. Review the BIP for implementation details.</p>

  <h3 id="future-proposals">Future Proposals</h3>

  <p>There are future proposals such as Unused <a href="/en/developer-guide#term-output" title="The output of a transaction which transfers value to a script" class="auto-link">Output</a> Tree (UOT) in the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a> to find a more satisfactory middle-ground for clients between needing a complete copy of the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>, or trusting that a majority of your connected <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peers</a> are not lying. UOT would enable a very secure client using a finite amount of storage using a data structure that is authenticated in the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>. These type of proposals are, however, in very early stages, and will require soft forks in the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a>. </p>

  <p>Until these types of operating modes are implemented, modes should be chosen based on the likely threat model, computing and bandwidth constraints, and liability in bitcoin value.</p>

  <p><strong>Resources:</strong> <a href="https://bitcointalk.org/index.php?topic=88208.0">Original Thread on UOT</a>, <a href="https://github.com/maaku/bips/blob/master/drafts/auth-trie.mediawiki">UOT Prefix Tree BIP Proposal</a></p>

  <h2 id="p2p-network">P2P Network</h2>

  <p>The Bitcoin <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" id="term-network" class="term">network</a> uses simple methods to perform <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a> discovery and communicate between nodes. The following section applies to both full nodes and <a href="/en/developer-guide#simplified-payment-verification-spv" title="A method for verifying particular transactions were included in blocks without downloading the entire contents of the block chain" class="auto-link">SPV</a> clients, with the exception that <a href="/en/developer-guide#simplified-payment-verification-spv" title="A method for verifying particular transactions were included in blocks without downloading the entire contents of the block chain" class="auto-link">SPV’s</a> Bloom filters take the role of <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> discovery.</p>

  <h3 id="peer-discovery">Peer Discovery</h3>

  <p>Bitcoin Core maintains a list of <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" id="term-peer" class="term">peers</a> to connect to on startup. When a full node is started for the first time, it must be bootstrapped to the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a>. This is done automatically today in Bitcoin Core by a short list of trusted DNS seeds. The option <code>-dnsseed</code> can be set to define this behavior, though the default is <code>1</code>. DNS requests return a list of IP <a href="/en/developer-guide#term-address" title="A 20-byte hash formatted as a P2PKH or P2SH Bitcoin Address" class="auto-link">addresses</a> that can be connected to. From there, the client can start connecting the Bitcoin <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a>.</p>

  <p>Alternatively, bootstrapping can be done by using the option <code>-seednode=&lt;ip&gt;</code>, allowing the user to predefine what seed server to connect to, then disconnect after building a <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a> list. Another method is starting Bitcoin Core with <code>-connect=&lt;ip&gt;</code> which disallows the node from connecting to any <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peers</a> except those specified. Lastly, the argument <code>-addnode=&lt;ip&gt;</code> simply allows the user to add a single node to his <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a> list.</p>

  <p>After bootstrapping, nodes send out a <code>addr</code> message containing their own IP to <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peers</a>. Each <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a> of that node then forwards this message to a couple of their own <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peers</a> to expand the pool of possible connections.  </p>

  <p>To see which <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peers</a> one is connected with (and associated data), use the <a href="/en/developer-reference#getpeerinfo" class="auto-link"><code>getpeerinfo</code></a> <a href="/en/developer-reference#remote-procedure-calls-rpcs" class="auto-link">RPC</a>.</p>

  <h3 id="connecting-to-peers">Connecting To Peers</h3>

  <p>Connecting to a <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a> is done by sending a <code>version</code> message, which contains your version number, <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>, and current time to the remote node. Once the message is received by the remote node, it must respond with a <code>verack</code> message, which may be followed by its own <code>version</code> message if the node desires to <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a>. </p>

  <p>Once connected, the client can send to the remote node <code>getaddr</code> and <code>addr</code> messages to gather additional <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peers</a>.</p>

  <p>In order to maintain a connection with a <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a>, nodes by default will send a message to <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peers</a> before 30 minutes of inactivity. If 90 minutes pass without a message being received by a <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a>, the client will assume that connection has closed.</p>

  <h3 id="block-broadcasting">Block Broadcasting</h3>

  <p>At the start of a connection with a <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a>, both nodes send <code>getblocks</code> messages containing the hash of the latest known <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>. If a <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a> believes they have newer <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> or a longer chain, that <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a> will send an <code>inv</code> message which includes a list of up to 500 hashes of newer <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>, stating that it has the longer chain. The receiving node would then request these <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> using the command <code>getdata</code>, and the remote <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a> would reply via <code>block</code> messages. After all 500 <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> have been processed, the node can request another set with <code>getblocks</code>, until the node is caught up with the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a>. <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">Blocks</a> are only accepted when validated by the receiving node.</p>

  <p>New <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> are also discovered as <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> publish their found <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>, and these messages are propagated in a similar manner. Through previously established connections, an <code>inv</code> message is sent with the new <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> hashed, and the receiving node requests the <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> via the <code>getdata</code> message. </p>

  <h3 id="transaction-broadcasting">Transaction Broadcasting</h3>

  <p>In order to send a transaction to a <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a>, an <code>inv</code> message is sent. If a <code>getdata</code> response message is received, the transaction is sent using <code>tx</code>. The <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a> receiving this transaction also forwards the transaction in the same manner, given that it is a valid transaction.</p>

  <h4 id="memory-pool">Memory Pool</h4>

  <p>Full <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peers</a> may keep track of <a href="/en/developer-guide#term-unconfirmed-transactions" title="A transaction which has not yet been added to the block chain" class="auto-link">unconfirmed transactions</a> which are eligible to
be included in the next <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>. This is essential for <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> who will
actually <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mine</a> some or all of those transactions, but it’s also useful
for any <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a> who wants to keep track of <a href="/en/developer-guide#term-unconfirmed-transactions" title="A transaction which has not yet been added to the block chain" class="auto-link">unconfirmed transactions</a>, such
as <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peers</a> serving <a href="/en/developer-guide#term-unconfirmed-transactions" title="A transaction which has not yet been added to the block chain" class="auto-link">unconfirmed</a> transaction information to <a href="/en/developer-guide#simplified-payment-verification-spv" title="A method for verifying particular transactions were included in blocks without downloading the entire contents of the block chain" class="auto-link">SPV</a> clients.</p>

  <p>Because <a href="/en/developer-guide#term-unconfirmed-transactions" title="A transaction which has not yet been added to the block chain" class="auto-link">unconfirmed transactions</a> have no permanent status in Bitcoin,
Bitcoin Core stores them in non-persistent memory, calling them a memory
pool or mempool. When a <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a> shuts down, its memory pool is lost except
for any transactions stored by its <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>. This means that never-mined
<a href="/en/developer-guide#term-unconfirmed-transactions" title="A transaction which has not yet been added to the block chain" class="auto-link">unconfirmed transactions</a> tend to slowly disappear from the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> as
<a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peers</a> restart or as they purge some transactions to make room in memory
for others.</p>

  <p>Transactions which are mined into <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> that are later <a href="/en/developer-guide#term-orphan" title="Blocks which were successfully mined but which aren't included on the current valid block chain" class="auto-link">orphaned</a> may be
added back into the memory pool. These re-added transactions may be
re-removed from the pool almost immediately if the replacement <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a>
include them. This is the case in Bitcoin Core, which removes <a href="/en/developer-guide#term-orphan" title="Blocks which were successfully mined but which aren't included on the current valid block chain" class="auto-link">orphaned</a>
<a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> from the chain one by one, starting with the tip (highest <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>).
As each <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> is removed, its transactions are added back to the memory
pool. After all of the <a href="/en/developer-guide#term-orphan" title="Blocks which were successfully mined but which aren't included on the current valid block chain" class="auto-link">orphaned</a> <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> are removed, the replacement
<a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> are added to the chain one by one, ending with the new tip. As
each <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> is added, any transactions it confirms are removed from the
memory pool.</p>

  <p><a href="/en/developer-guide#simplified-payment-verification-spv" title="A method for verifying particular transactions were included in blocks without downloading the entire contents of the block chain" class="auto-link">SPV</a> clients don’t have a memory pool for the same reason they don’t
relay transactions. They can’t independently verify that a transaction
hasn’t yet been included in a <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> and that it only spends <a href="/en/developer-guide#term-utxo" title="Unspent Transaction Output (UTXO) holding satoshis which have not yet been spent" class="auto-link">UTXOs</a>, so
they can’t know which transactions are eligible to be included in the
next <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>.</p>

  <h3 id="misbehaving-nodes">Misbehaving Nodes</h3>

  <p>Take note that for both types of <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner)" class="auto-link">broadcasting</a>, mechanisms are in place to punish misbehaving <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peers</a> who take up bandwidth and computing resources by sending false information. If a <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a> gets a banscore above the <code>-banscore=&lt;n&gt;</code> threshold, he will be banned for the number of seconds defined by <code>-bantime=&lt;n&gt;</code>, which is 86,400 by default (24 hours).</p>

  <h3 id="alerts">Alerts</h3>

  <p>In case of a bug or attack,
the Bitcoin Core developers provide a
<a href="https://bitcoin.org/en/alerts">Bitcoin alert service</a> with an RSS feed
and users of Bitcoin Core can check the error field of the <a href="/en/developer-reference#getinfo" class="auto-link"><code>getinfo</code></a> <a href="/en/developer-reference#remote-procedure-calls-rpcs" class="auto-link">RPC</a>
results to get currently active alerts for their specific version of
Bitcoin Core.</p>

  <p>These messages are aggressively <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcast</a> using the <code>alert</code> message, being sent to each <a href="/en/developer-guide#term-peer" title="Peer on the P2P network who receives and broadcasts transactions and blocks" class="auto-link">peer</a> upon connect for the duration of the alert. </p>

  <p>These messages are signed by a specific <a href="https://en.wikipedia.org/wiki/Elliptic_Curve_DSA" class="auto-link">ECDSA</a> <a href="/en/developer-guide#term-private-key" title="The private portion of a keypair which can create signatures which other people can verify using the public key" class="auto-link">private key</a> that only a small number of developers control. </p>

  <p><strong>Resource:</strong> More details about the structure of messages and a complete list of message types can be found at the <a href="https://en.bitcoin.it/wiki/Protocol_specification">Protocol Specification</a> page of the Bitcoin Wiki.</p>

  <h2 id="mining">Mining</h2>

  <p><a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">Mining</a> adds new <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> to the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>, making transaction history
hard to modify.  <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">Mining</a> today takes on two forms:</p>

  <ul>
    <li>
      <p>Solo <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a>, where the <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miner</a> attempts to generate new <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> on his
own, with the proceeds from the <a href="/en/developer-reference#term-block-reward" title="New satoshis given to a miner for creating one of the first 6,929,999 blocks" class="auto-link">block reward</a> and <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fees</a>
going entirely to himself, allowing him to receive large payments with
a higher variance (longer time between payments)</p>
    </li>
    <li>
      <p>Pooled <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a>, where the <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miner</a> pools resources with other <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> to
find <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">blocks</a> more often, with the proceeds being shared among the pool
<a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> in rough correlation to the amount of hashing power
they each contributed, allowing the <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miner</a> to receive small
payments with a lower variance (shorter time between payments).</p>
    </li>
  </ul>

  <h3 id="solo-mining">Solo Mining</h3>

  <p>As illustrated below, solo <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> typically use <code>bitcoind</code> to get new
transactions from the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a>. Their <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> software periodically polls
<code>bitcoind</code> for new transactions using the <a href="/en/developer-reference#getblocktemplate" class="auto-link"><code>getblocktemplate</code></a> <a href="/en/developer-reference#remote-procedure-calls-rpcs" class="auto-link">RPC</a>, which
provides the list of new transactions plus the <a href="/en/developer-guide#term-public-key" title="The public portion of a keypair which can be safely distributed to other people so they can verify a signature created with the corresponding private key" class="auto-link">public key</a> to which the
<a href="/en/developer-reference#term-coinbase-tx" title="A special transaction which miners must create when they generate a block" class="auto-link">coinbase transaction</a> should be sent.</p>

  <p><img src="/img/dev/en-solo-mining-overview.svg" alt="Solo Bitcoin Mining" /></p>

  <p>The <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> software constructs a <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> using the template (described below) and creates a
<a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a>. It then sends the 80-byte <a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a> to its <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a>
hardware (an ASIC) along with a <a href="/en/developer-guide#term-target" title="The threshold below which a block header hash must be in order for the block to be added to the block chain" class="auto-link">target</a> threshold (<a href="/en/developer-guide#term-difficulty" title="A number corresponding to the target threshold which indicates how difficult it will be to find the next block" class="auto-link">difficulty</a> setting).
The <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> hardware iterates through every possible value for the <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>
<a href="/en/developer-reference#term-header-nonce" title="Four bytes of arbitrary data in a block header used to let miners create headers with different hashes for proof of work" class="auto-link">header nonce</a> and generates the corresponding hash.</p>

  <p>If none of the hashes are below the threshold, the <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> hardware gets
an updated <a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a> with a new <a href="/en/developer-guide#term-merkle-root" title="The root node of a Merkle tree descended from all the hashed pairs in the tree" class="auto-link">Merkle root</a> from the <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> software;
this new <a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a> is created by adding extra nonce data to the
<a href="/en/developer-reference#term-coinbase-field" title="A special input-like field for coinbase transactions" class="auto-link">coinbase field</a> of the <a href="/en/developer-reference#term-coinbase-tx" title="A special transaction which miners must create when they generate a block" class="auto-link">coinbase transaction</a>.</p>

  <p>On the other hand, if a hash is found below the <a href="/en/developer-guide#term-target" title="The threshold below which a block header hash must be in order for the block to be added to the block chain" class="auto-link">target</a> threshold, the
<a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> hardware returns the <a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a> with the successful nonce to
the <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> software. The <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> software combines the header with the
<a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> and sends the completed <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> to <code>bitcoind</code> to be <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcast</a> to the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> for addition to the
<a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>.</p>

  <h3 id="pool-mining">Pool Mining</h3>

  <p>Pool <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> follow a similar workflow, illustrated below, which allows
<a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> pool operators to pay <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> based on their share of the work
done. The <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> pool gets new transactions from the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> using
<code>bitcoind</code>. Using one of the methods discussed later, each <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miner’s</a> <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a>
software connects to the pool and requests the information it needs to
construct <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> headers.</p>

  <p><img src="/img/dev/en-pooled-mining-overview.svg" alt="Pooled Bitcoin Mining" /></p>

  <p>In pooled <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a>, the <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> pool sets the <a href="/en/developer-guide#term-target" title="The threshold below which a block header hash must be in order for the block to be added to the block chain" class="auto-link">target</a> threshold a few orders
of magnitude higher (less difficult) than the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a>
<a href="/en/developer-guide#term-difficulty" title="A number corresponding to the target threshold which indicates how difficult it will be to find the next block" class="auto-link">difficulty</a>. This causes the <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> hardware to return many <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> headers
which don’t hash to a value eligible for inclusion on the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>
but which do hash below the pool’s <a href="/en/developer-guide#term-target" title="The threshold below which a block header hash must be in order for the block to be added to the block chain" class="auto-link">target</a>, proving (on average) that the
<a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miner</a> checked a percentage of the possible hash values.</p>

  <p>The <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miner</a> then sends to the pool a copy of the information the pool
needs to validate that the header will hash below the <a href="/en/developer-guide#term-target" title="The threshold below which a block header hash must be in order for the block to be added to the block chain" class="auto-link">target</a> and that
the the <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> of transactions referred to by the header <a href="/en/developer-guide#term-merkle-root" title="The root node of a Merkle tree descended from all the hashed pairs in the tree" class="auto-link">Merkle root</a> field
is valid for the pool’s purposes. (This usually means that the <a href="/en/developer-reference#term-coinbase-tx" title="A special transaction which miners must create when they generate a block" class="auto-link">coinbase
transaction</a> must pay the pool.)</p>

  <p>The information the <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miner</a> sends to the pool is called a share because it
proves the <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miner</a> did a share of the work. By chance, some shares the
pool receives will also be below the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> <a href="/en/developer-guide#term-target" title="The threshold below which a block header hash must be in order for the block to be added to the block chain" class="auto-link">target</a>—the <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> pool
sends these to the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> to be added to the <a href="/en/developer-guide#block-chain" title="A chain of blocks with each block linking to the block that preceded; the most-difficult-to-recreate chain is The Block Chain" class="auto-link">block chain</a>.</p>

  <p>The <a href="/en/developer-reference#term-block-reward" title="New satoshis given to a miner for creating one of the first 6,929,999 blocks" class="auto-link">block reward</a> and <a href="/en/developer-guide#term-transaction-fee" title="The amount remaining when all outputs are subtracted from all inputs in a transaction; the fee is paid to the miner who includes that transaction in a block" class="auto-link">transaction fees</a> that come from <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> that <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>
are paid to the <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> pool. The <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> pool pays out a portion of
these proceeds to individual <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> based on how many shares they generated. For
example, if the <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> pool’s <a href="/en/developer-guide#term-target" title="The threshold below which a block header hash must be in order for the block to be added to the block chain" class="auto-link">target</a> threshold is 100 times lower than
the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> <a href="/en/developer-guide#term-target" title="The threshold below which a block header hash must be in order for the block to be added to the block chain" class="auto-link">target</a> threshold, 100 shares will need to be generated on
average to create a successful <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>, so the <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> pool can pay 1/100th
of its payout for each share received.  Different <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> pools use
different reward distribution systems based on this basic share system.</p>

  <h3 id="block-prototypes">Block Prototypes</h3>

  <p>In both solo and pool <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a>, the <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> software needs to get the
information necessary to construct <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> headers. This subsection
describes, in a linear way, how that information is transmitted and
used. However, in actual implementations, parallel threads and queuing
are used to keep ASIC hashers working at maximum capacity,</p>

  <h4 id="getwork-rpc">getwork RPC</h4>

  <p>The simplest and earliest method was the now-deprecated Bitcoin Core
<a href="/en/developer-reference#getwork" class="auto-link"><code>getwork</code></a> <a href="/en/developer-reference#remote-procedure-calls-rpcs" class="auto-link">RPC</a>, which constructs a header for the <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miner</a> directly. Since a
header only contains a single 4-byte nonce good for about 4 gigahashes,
many modern <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> need to make dozens or hundreds of <a href="/en/developer-reference#getwork" class="auto-link"><code>getwork</code></a> requests
a second. Solo <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> may still use <a href="/en/developer-reference#getwork" class="auto-link"><code>getwork</code></a>, but most pools today
discourage or disallow its use.</p>

  <h4 id="getblocktemplate-rpc">getblocktemplate RPC</h4>

  <p>An improved method is the Bitcoin Core <a href="/en/developer-reference#getblocktemplate" class="auto-link"><code>getblocktemplate</code></a> <a href="/en/developer-reference#remote-procedure-calls-rpcs" class="auto-link">RPC</a>. This
provides the <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> software with much more information:</p>

  <ol>
    <li>
      <p>The information necessary to construct a <a href="/en/developer-reference#term-coinbase-tx" title="A special transaction which miners must create when they generate a block" class="auto-link">coinbase transaction</a>
paying the pool or the solo <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miner’s</a> <code>bitcoind</code> <a href="/en/developer-guide#wallets" title="Software which stores private keys to allow users to spend and receive satoshis" class="auto-link">wallet</a>.</p>
    </li>
    <li>
      <p>A complete dump of the transactions <code>bitcoind</code> or the <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> pool
suggests including in the <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>, allowing the <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> software to
inspect the transactions, optionally add additional transactions, and
optionally remove non-required transactions.</p>
    </li>
    <li>
      <p>Other information necessary to construct a <a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a> for the next
<a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>: the <a href="/en/developer-reference#term-block-version" title="The version field in the block header" class="auto-link">block version</a>, previous <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> hash, and bits (<a href="/en/developer-guide#term-target" title="The threshold below which a block header hash must be in order for the block to be added to the block chain" class="auto-link">target</a>).</p>
    </li>
    <li>
      <p>The <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> pool’s current <a href="/en/developer-guide#term-target" title="The threshold below which a block header hash must be in order for the block to be added to the block chain" class="auto-link">target</a> threshold for accepting shares. (For
solo <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a>, this is the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">network</a> <a href="/en/developer-guide#term-target" title="The threshold below which a block header hash must be in order for the block to be added to the block chain" class="auto-link">target</a>.)</p>
    </li>
  </ol>

  <p>Using the transactions received, the <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> software adds a nonce to the
<a href="/en/developer-reference#term-coinbase-tx" title="A special transaction which miners must create when they generate a block" class="auto-link">coinbase</a> extra nonce field and then converts all the transactions into a
<a href="/en/developer-guide#term-merkle-tree" title="A tree constructed by hashing paired data, then pairing and hashing the results until a single hash remains, the Merkle root" class="auto-link">Merkle tree</a> to derive a <a href="/en/developer-guide#term-merkle-root" title="The root node of a Merkle tree descended from all the hashed pairs in the tree" class="auto-link">Merkle root</a> it can use in a <a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a>.
Whenever the extra nonce field needs to be changed, the <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> software
rebuilds the necessary parts of the <a href="/en/developer-guide#term-merkle-tree" title="A tree constructed by hashing paired data, then pairing and hashing the results until a single hash remains, the Merkle root" class="auto-link">Merkle tree</a> and updates the time and
<a href="/en/developer-guide#term-merkle-root" title="The root node of a Merkle tree descended from all the hashed pairs in the tree" class="auto-link">Merkle root</a> fields in the <a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a>.</p>

  <p>Like all <code>bitcoind</code> <a href="/en/developer-reference#remote-procedure-calls-rpcs" class="auto-link">RPCs</a>, <a href="/en/developer-reference#getblocktemplate" class="auto-link"><code>getblocktemplate</code></a> is sent over HTTP. To
ensure they get the most recent work, most <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> use <a href="https://en.wikipedia.org/wiki/Push_technology#Long_polling">HTTP longpoll</a> to
leave a <a href="/en/developer-reference#getblocktemplate" class="auto-link"><code>getblocktemplate</code></a> request open at all times. This allows the
<a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> pool to push a new <a href="/en/developer-reference#getblocktemplate" class="auto-link"><code>getblocktemplate</code></a> to the <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miner</a> as soon as any
<a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miner</a> on the <a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">peer-to-peer network</a> publishes a new <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> or the pool
wants to send more transactions to the <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> software.</p>

  <h4 id="stratum">Stratum</h4>

  <p>A widely used alternative to <a href="/en/developer-reference#getblocktemplate" class="auto-link"><code>getblocktemplate</code></a> is the <a href="http://mining.bitcoin.cz/stratum-mining">Stratum mining
protocol</a>. Stratum focuses on giving <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> the minimal information they
need to construct <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> headers on their own:</p>

  <ol>
    <li>
      <p>The information necessary to construct a <a href="/en/developer-reference#term-coinbase-tx" title="A special transaction which miners must create when they generate a block" class="auto-link">coinbase transaction</a>
paying the pool.</p>
    </li>
    <li>
      <p>The parts of the <a href="/en/developer-guide#term-merkle-tree" title="A tree constructed by hashing paired data, then pairing and hashing the results until a single hash remains, the Merkle root" class="auto-link">Merkle tree</a> which need to be re-hashed to
create a new <a href="/en/developer-guide#term-merkle-root" title="The root node of a Merkle tree descended from all the hashed pairs in the tree" class="auto-link">Merkle root</a> when the <a href="/en/developer-reference#term-coinbase-tx" title="A special transaction which miners must create when they generate a block" class="auto-link">coinbase transaction</a> is
updated with a new extra nonce. The other parts of the <a href="/en/developer-guide#term-merkle-tree" title="A tree constructed by hashing paired data, then pairing and hashing the results until a single hash remains, the Merkle root" class="auto-link">Merkle
tree</a>, if any, are not sent, effectively limiting the amount of data which needs
to be sent to (at most) about a kilobyte at current transaction
volume.</p>
    </li>
    <li>
      <p>All of the other non-<a href="/en/developer-guide#term-merkle-root" title="The root node of a Merkle tree descended from all the hashed pairs in the tree" class="auto-link">Merkle root</a> information necessary to construct a
<a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a> for the next <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a>.</p>
    </li>
    <li>
      <p>The <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> pool’s current <a href="/en/developer-guide#term-target" title="The threshold below which a block header hash must be in order for the block to be added to the block chain" class="auto-link">target</a> threshold for accepting shares.</p>
    </li>
  </ol>

  <p>Using the <a href="/en/developer-reference#term-coinbase-tx" title="A special transaction which miners must create when they generate a block" class="auto-link">coinbase transaction</a> received, the <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> software adds a
nonce to the <a href="/en/developer-reference#term-coinbase-tx" title="A special transaction which miners must create when they generate a block" class="auto-link">coinbase</a> extra nonce field, hashes the <a href="/en/developer-reference#term-coinbase-tx" title="A special transaction which miners must create when they generate a block" class="auto-link">coinbase
transaction</a>, and adds the hash to the received parts of the <a href="/en/developer-guide#term-merkle-tree" title="A tree constructed by hashing paired data, then pairing and hashing the results until a single hash remains, the Merkle root" class="auto-link">Merkle tree</a>.
The tree is hashed as necessary to create a <a href="/en/developer-guide#term-merkle-root" title="The root node of a Merkle tree descended from all the hashed pairs in the tree" class="auto-link">Merkle root</a>, which is added
to the <a href="/en/developer-reference#block-header" title="An 80-byte header belonging to a single block which is hashed repeatedly to create proof of work" class="auto-link">block header</a> information received. Whenever the extra nonce field
needs to be changed, the <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> software updates and re-hashes the
<a href="/en/developer-reference#term-coinbase-tx" title="A special transaction which miners must create when they generate a block" class="auto-link">coinbase transaction</a>, rebuilds the <a href="/en/developer-guide#term-merkle-root" title="The root node of a Merkle tree descended from all the hashed pairs in the tree" class="auto-link">Merkle root</a>, and updates the header
<a href="/en/developer-guide#term-merkle-root" title="The root node of a Merkle tree descended from all the hashed pairs in the tree" class="auto-link">Merkle root</a> field.</p>

  <p>Unlike <a href="/en/developer-reference#getblocktemplate" class="auto-link"><code>getblocktemplate</code></a>, <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> using Stratum cannot inspect or add
transactions to the <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> they’re currently <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a>. Also unlike
<a href="/en/developer-reference#getblocktemplate" class="auto-link"><code>getblocktemplate</code></a>, the Stratum protocol uses a two-way TCP socket directly,
so <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> don’t need to use HTTP longpoll to ensure they receive
immediate updates from <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> pools when a new <a href="/en/developer-guide#term-block" title="A block of transactions protected by proof of work" class="auto-link">block</a> is <a href="/en/developer-guide#transaction-broadcasting" title="Sending transactions or blocks to all other peers on the Bitcoin network (compare to privately transmitting to a single peer or partner" class="auto-link">broadcast</a> to the
<a href="/en/developer-guide#term-network" title="The Bitcoin P2P network which broadcasts transactions and blocks" class="auto-link">peer-to-peer network</a>.</p>

  <p><strong>Resources:</strong> The GPLv3 <a href="https://github.com/luke-jr/bfgminer">BFGMiner</a> <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> software and AGPLv3
<a href="https://gitorious.org/bitcoin/eloipool">Eloipool</a> <a href="/en/developer-guide#term-miner" title="Creating Bitcoin blocks which solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">mining</a> pool software are widely-used among <a href="/en/developer-guide#term-miner" title="Creators of Bitcoin blocks who solve proof-of-work puzzles in exchange for block rewards and transaction fees" class="auto-link">miners</a> and
pools. The <a href="https://gitorious.org/bitcoin/libblkmaker">libblkmaker</a> C library and <a href="https://gitorious.org/bitcoin/python-blkmaker">python-blkmaker</a> library,
both MIT licensed, can interpret GetBlockTemplate for your programs.</p>

</div>

<script>updateToc();</script>

<script>addAnchorLinks();</script>


    </div>
    <div class="footer">
    <div class="footermenu">
    <a href="/en/alerts">Network Status</a>
    
    <a href="/en/legal">Legal</a>
    
    
    <a href="/en/about-us">About bitcoin.org</a>
    
    </div>
    <span>© Bitcoin Project 2009-2014 Released under the <a href="http://opensource.org/licenses/mit-license.php" target="_blank">MIT license</a></span>
    </div>
  </div>
  <div class="sponsor-banner">
    
    <div><span>A community website sponsored by</span> <a href="https://bitcoinfoundation.org/"><img src="/img/brand/bitcoinfoundation.png" alt="Bitcoin Foundation"></a></div>
    
  </div>
  <script type="text/javascript">fallbackSVG();</script>
</body>

</html>
